import{b as Ps,h as Ts,s as ks,a as Is,i as Ms,$ as j,A as M,j as As,k as Cs,l as ns,m as Rs,o as Ls,n as os,u as e,g as is,I as as}from"./index-Db6xGWP3.js";import{d as m,A as p,y as _,T as Us,q as xs,k as Fs}from"./react-vendor-BYlzYzcd.js";import{H as Ns}from"./Helmet-B6HolPNi.js";import{M as Ds}from"./MovieCard-iltsSDRn.js";import{r as Ws,a as Os}from"./favorites-Cc2oSJV2.js";/* empty css                  */const Xs=ls=>{const[l,ae]=m(null),[Ie,Me]=m([]),[Ae,Ce]=m([]),[$,z]=m(""),[cs,le]=m(!0),[Vs,qs]=m(!1),B=p(null),[u,G]=m(null),[f,J]=m(null),[A,Re]=m("videasy"),[Le,ds]=m(["videasy","vidsrc","embedsu"]),[K,Ue]=m(null),[us,xe]=m(!1),[Q,ms]=m(!1),[U,V]=m(null),[Fe,Ne]=m(!1),[De,X]=m(!1),k=p(),[We,Hs]=m(null),{id:d,type:r,season:C,episode:R}=ls.matches,[I,q]=m(r==="anime"?null:d),[x,ce]=m(r==="anime"?"anime":r),[gs,de]=m(!1),[N,ue]=m(!1),[Oe,me]=m([]),ge=p(null),[hs,H]=m([]),[E,Z]=m(null),[D,ee]=m(!1),[W,Ys]=m(0),[he,se]=m(1),[fe,Ve]=m(1),[pe,qe]=m(!1),F=10,re=p(!1),ve=p(null),ye=p(!1),be=p(!1),fs=p(!1),ps=p(null),vs=p(!1),te=p(new Set),ys=p(0);p(0);const _e=p(null);p({});const ne=p(0),O=p(null),we=p({progress:0,duration:0}),{user:He,session:Ye}=Ps(),y=He?.id,oe="tv",{openMiniPlayer:$e,closeMiniPlayer:Se,isActive:L,isSupported:ie}=Ts();_(()=>{(async()=>{const{data:{session:n},error:i}=await ks.auth.getSession();i?console.error("ðŸ” Auth check error:",i):n?console.log("ðŸ” Auth status: Authenticated user",n.user.id):console.log("ðŸ” Auth status: No active session")})()},[]);const{setCurrentMediaItem:Ee,favoritesFetched:je,fetchContinueWatching:ze,isShowFavorited:bs}=Is();_(()=>{if(r==="tv"||r==="anime")if(C&&R&&!isNaN(parseInt(C))&&!isNaN(parseInt(R))){const n=parseInt(C,10),i=parseInt(R,10);G(n),J(i)}else G(1),J(1);else G(null),J(null)},[r,C,R]);const Be=Us(()=>r!=="movie"||!E||!E.progress_seconds||E.progress_seconds<=0?0:E.duration_seconds>0?Math.min(100,E.progress_seconds/E.duration_seconds*100):E.progress_seconds>30?5:2,[r,E]),Ge=xs((s,n)=>{if(!s||!n)return 1;const i=Math.ceil(s/F);return Math.max(1,Math.min(i,Math.ceil(n/F)))},[F]),Je=p(y);_(()=>{Je.current=y},[y]);const _s=()=>{Ie.find(n=>n.type==="Trailer"&&n.site==="YouTube")?de(!0):alert("No trailer available for this movie.")};_(()=>()=>{te.current.forEach(s=>clearTimeout(s)),te.current.clear()},[u,f]),_(()=>{const s=async()=>{document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement?console.log("ðŸ“± Entered fullscreen mode"):(console.log("ðŸ“± Exited fullscreen mode, syncing progress..."),[500,2e3,5e3].forEach((t,h)=>{setTimeout(()=>{y&&(console.log(`ðŸ”„ Sync attempt ${h+1} after fullscreen exit`),Ms(y).then(c=>{c&&(console.log(`âœ… Fullscreen sync attempt ${h+1} successful`),ze())}).catch(c=>{console.error(`âŒ Sync attempt ${h+1} failed:`,c)}))},t)}))};return document.addEventListener("fullscreenchange",s),document.addEventListener("webkitfullscreenchange",s),document.addEventListener("mozfullscreenchange",s),()=>{document.removeEventListener("fullscreenchange",s),document.removeEventListener("webkitfullscreenchange",s),document.removeEventListener("mozfullscreenchange",s)}},[y]),_(()=>(l&&Ee({...l,type:r}),()=>{Ee(null)}),[l,r,Ee]),_(()=>{L&&(console.log("ðŸ‘ï¸ Watch page mounted, closing mini-player"),Se());const s=()=>({iframe:document.querySelector('iframe[title="Video Player"]'),container:B.current});return()=>{console.log("ðŸšª Watch component unmounting - checking mini-player conditions");const{iframe:n,container:i}=s(),t=n&&$&&D;if(console.log("ðŸ” Mini-player pre-flight check:",{hasIframe:!!n,hasStreamUrl:!!$,playerReady:D,hasVideo:t,isMiniPlayerSupported:ie,isMiniPlayerActive:L,hasMediaDetails:!!l,hasContainer:!!i}),t&&ie&&!L&&l&&i){console.log("âœ… All conditions met, activating mini-player");const h={title:l.title||l.name||"Video",url:window.location.href,type:r,id:d,season:u,id:d,season:u,episode:f,progress:we.current?.progress||0,duration:we.current?.duration||0};console.log("ðŸ“ž Calling openMiniPlayer with:",{videoInfo:h});try{$e(n,i,h)}catch(c){console.error("âŒ Failed to open mini-player:",c)}}else console.log("âŒ Conditions NOT met for mini-player"),i||console.error("âŒ Container not found - ref not attached to DOM element")}},[$,D,ie,L,l,r,d,u,f,$e,Se]),_(()=>{if(!d||!r){j("/");return}r==="anime"?(ce("anime"),q(null)):(q(d),ce(r))},[d,r]),_(()=>{if(r!=="anime"&&!I||r==="anime"&&!d)return;z(""),ue(!1),me([]),ae(null),le(!0),H([]),ye.current=!1,be.current=!1,fs.current=!1,ps.current=null,vs.current=!1,se(1),qe(!1),te.current.forEach(n=>clearTimeout(n)),te.current.clear(),ys.current=0,_e.current=null,(async()=>{le(!0);try{const n=new AbortController,i=setTimeout(()=>n.abort(),15e3),t=d,h=r==="anime"?`${M}/tmdb/anime/${t}/enhanced`:`${M}/tmdb/${x}/${I}`,c=r==="anime"?null:`${M}/tmdb/${x}/${I}/videos`,o=r==="anime"?`${M}/tmdb/anime/${t}/recommendations`:`${M}/tmdb/${x}/${I}/recommendations`,a=async(b,P)=>{if(!b)return null;try{const S=await fetch(b,{signal:n.signal});if(!S.ok)throw new Error(`HTTP ${S.status}: ${S.statusText}`);const T=await S.json();return r==="anime"&&T._conversion?.tmdbId&&q(T._conversion.tmdbId),r==="anime"&&T.tmdb_id&&q(T.tmdb_id),T}catch(S){if(console.error(`${P}:`,S),P.includes("videos")||P.includes("recommendations"))return{results:[]};throw S}};let v,g,w;r==="anime"?(v=await a(h,"Error fetching anime details"),g={results:v?.videos?.results||[]},w=await a(o,"Error fetching recommendations")):[v,g,w]=await Promise.all([a(h,"Error fetching media details"),a(c,"Error fetching videos"),a(o,"Error fetching recommendations")]),clearTimeout(i),ae(v),Me(g.results||[]),Ce(w.results||[])}catch{ae(null),Me([]),Ce([])}finally{le(!1)}})()},[I,x,C,R,y]),_(()=>{(async()=>{if(!y||!l||!d||!r){r==="movie"?Z(null):(r==="tv"||r==="anime")&&H([]);return}try{if((r==="tv"||r==="anime")&&l.seasons&&l.seasons.length>0&&!(C&&R&&!isNaN(parseInt(C))&&!isNaN(parseInt(R)))&&!be.current&&u!==null&&f!==null){console.log("ðŸŽ¬ Checking for continue watching episode...");const t=await As(y,d,oe);t&&t.season_number&&t.episode_number?(console.log(`ðŸ”„ Continue watching: S${t.season_number}E${t.episode_number}`),setTimeout(()=>{G(t.season_number),J(t.episode_number);const h=`/watch/${r}/${d}/season/${t.season_number}/episode/${t.episode_number}`;j(h,!0)},100)):console.log("ðŸ“­ No continue watching data found, starting from beginning"),be.current=!0}if(r==="tv"||r==="anime"){const i=await Cs(y,d,oe);console.log(`ðŸ“º [Watch] Series history loaded for ${r} ${d}:`,i),H(i)}const n=await ns(y,d,r);console.log("Progress data loaded:",n),Z(n)}catch(n){console.error("Error loading user-specific data:",n)}})()},[y,l,d,r,C,R,oe]),_(()=>{u!==null&&!pe&&se(1)},[u]),_(()=>{(async()=>{if(r!=="tv"&&r!=="anime"||!u||u===null)return;const n=r==="anime"?d:I;if(n){xe(!0);try{const i=r==="anime"?`${M}/tmdb/anime/${n}/season/${u}`:`${M}/tmdb/${x}/${n}/season/${u}`,t=await fetch(i);if(!t.ok)throw new Error(`Failed to fetch season details: ${t.statusText}`);const h=await t.json();if(Ue(h),!pe){const c=h.episodes.length,o=Ge(f,c);se(o),qe(!0)}}catch(i){console.error("Error fetching season details:",i),Ue(null)}finally{xe(!1)}}})()},[d,r,oe,u,f,pe,Ge]),_(()=>{const s=`${u}-${f}`,n=ve.current&&ve.current!==s;if(ve.current=s,re.current&&!n){re.current=!1;return}n&&(re.current=!1),(async()=>{if(!I||!x)return;const t=r==="anime"?d:I;if(!t)return;V(null),X(!1),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>X(!0),1e4);const h=r==="anime"&&l&&(!l.seasons||l.seasons.length===0);if((r==="tv"||r==="anime")&&!h&&(u===null||f===null)){console.log("Season/episode not set, aborting stream URL fetch."),clearTimeout(k.current);return}try{let c=`${M}/stream-url?type=${r}&id=${t}&source=${A}`;(r==="tv"||r==="anime"&&!h)&&(c+=`&season=${u}&episode=${f}`),r==="anime"&&Q&&(c+="&dub=true"),A==="videasy"&&(W>0&&(c+=`&progress=${Math.round(W)}`),(r==="tv"||r==="anime")&&(c+="&nextEpisode=true&episodeSelector=true&autoplayNextEpisode=true")),console.log(`Fetching stream URL: ${c}`);const o=await fetch(c);if(!o.ok)throw new Error(`Server responded with ${o.status}`);const a=await o.json();if(clearTimeout(k.current),a.url)console.log(`Stream URL generated: ${a.url}`),z(a.url),ue(a.isDirectSource||!1),me(a.qualities||[]),a.availableSources&&a.availableSources.length>0&&ds(a.availableSources),a.currentSource&&(re.current=!0,Re(a.currentSource)),V(null),ee(!0);else throw new Error(a.message||"No stream URL returned from API")}catch(c){clearTimeout(k.current),console.error("Error fetching stream URL:",c.message),V(`Failed to load video: ${c.message}. Try changing the source or refreshing.`),ee(!1)}})()},[I,x,u,f,A,Q,l,W,y]),_(()=>{const s=Je.current;if(s&&console.log("ðŸ” Progress tracking setup:",{hasUser:!0,userId:s,hasMediaDetails:!!l}),!s||!l){s&&!l&&console.log("âš ï¸ Progress tracking disabled - media details not yet available");return}const n=async(t,h)=>{console.log(`ðŸ“Š Progress update received via ${h}: `,t);const c=t.season||u,o=t.episode||f;if(t&&t.progress>=0&&(we.current={progress:t.progress,duration:t.duration}),t&&t.progress>=0&&t.duration>0){const a=Date.now();if(a-ne.current<2e3)return;O.current&&clearTimeout(O.current),ne.current=a;try{console.log(`ðŸŽ¬ Attempting to save progress for ${r} ${d}:`,{progress:t.progress,duration:t.duration,season:c,episode:o});const v=await os(s,{...l,id:l.id,type:r,season:c,episode:o},t.progress,t.duration,!1,Ye).catch(g=>{if(console.error("âŒ Progress save error caught:",g),g.message?.includes("timeout")||g.message?.includes("auth")){const w=`offline_progress_${r}_${d}_${c||0}_${o||0}`,b={media_id:d,media_type:r,season_number:c,episode_number:o,progress_seconds:t.progress,duration_seconds:t.duration,timestamp:new Date().toISOString()};return localStorage.setItem(w,JSON.stringify(b)),console.log("ðŸ“± Saved to localStorage after error"),!0}return!1});if(v){if(console.log("âœ… Progress saved successfully"),ze(),c===u&&o===f){const g=typeof v=="object"&&v.progress_seconds!==void 0?v:{progress_seconds:t.progress,duration_seconds:t.duration};console.log("ðŸ“Š Using progress data for state update:",g),r==="movie"?Z(g):(r==="tv"||r==="anime")&&H(w=>{const b=[...w],P=b.findIndex(T=>T.season_number===c&&T.episode_number===o),S={media_id:parseInt(d,10),media_type:r,season_number:c,episode_number:o,progress_seconds:g.progress_seconds,duration_seconds:g.duration_seconds};return P>-1?b[P]={...b[P],...S}:b.push(S),b})}}else console.error("âŒ Failed to save progress, will retry on next update")}catch(v){console.error("âŒ An unexpected error occurred while saving progress:",v);try{const g=`offline_progress_${r}_${d}_${c||0}_${o||0}`,w={media_id:d,media_type:r,season_number:c,episode_number:o,progress_seconds:t.progress,duration_seconds:t.duration,timestamp:new Date().toISOString()};localStorage.setItem(g,JSON.stringify(w)),console.log("ðŸ“± Saved to localStorage after exception")}catch(g){console.error("ðŸ’” All save mechanisms failed:",g)}}}else console.log("âš ï¸ Progress update ignored (insufficient data):",{hasProgressData:!!t,progress:t?.progress,duration:t?.duration,meetsThreshold:t?.progress>=0&&t?.duration>0})};let i;if(N){const t=ge.current;if(!t)return;const h=async()=>{Rs()&&Ls(t);const o=await ns(y,d,r,u,f);o&&o.progress_seconds&&(t.currentTime=o.progress_seconds)},c=async()=>{if(t.currentTime>0){const o=Date.now();if(o-ne.current<2e3)return;O.current&&clearTimeout(O.current),ne.current=o;const a={progress:Math.round(t.currentTime),duration:Math.round(t.duration),percentage:t.duration>0?t.currentTime/t.duration*100:0};console.log("ðŸŽ¬ Direct video - saving progress:",a);const v=await os(y,{...l,id:l.id,type:r,season:u,episode:f},a.progress,a.duration,!1,Ye);if(v){console.log("âœ… Direct video progress saved successfully");const g=typeof v=="object"&&v.progress_seconds!==void 0?v:{progress_seconds:a.progress,duration_seconds:a.duration};console.log("ðŸ“Š Using direct video progress data for state update:",g),r==="movie"?Z(g):(r==="tv"||r==="anime")&&H(w=>{const b=[...w],P=b.findIndex(T=>T.season_number===u&&T.episode_number===f),S={media_id:parseInt(d,10),media_type:r,season_number:u,episode_number:f,progress_seconds:g.progress_seconds,duration_seconds:g.duration_seconds};return P>-1?b[P]={...b[P],...S}:b.push(S),b})}else console.error("âŒ Failed to save direct video progress")}};return t.addEventListener("loadedmetadata",h),t.addEventListener("timeupdate",c),()=>{t.removeEventListener("loadedmetadata",h),t.removeEventListener("timeupdate",c)}}else return i=t=>{const h=["player.videasy.net","vidsrc.to","embed.su","vidsrc.xyz","vidsrc.in","vidsrc.pm"],c=new URL(t.origin);if(h.includes(c.hostname))try{const o=typeof t.data=="string"?JSON.parse(t.data):t.data;if(o&&o.type==="PROGRESS_UPDATE"&&o.data){const a={progress:o.data.progress?.watched,duration:o.data.progress?.duration,season:o.data.season||u,episode:o.data.episode||f};n(a,"PROGRESS_UPDATE");return}if(o.type==="MEDIA_DATA"&&o.data){let a=o.data;if(typeof a=="string")try{a=JSON.parse(a)}catch(w){console.error("Error parsing double-encoded MEDIA_DATA string:",w);return}const v=`${r}-${d}`,g=a[v];if(g&&g.progress){const w={progress:g.progress.watched,duration:g.progress.duration,season:g.last_season_watched,episode:g.last_episode_watched};n(w,"MEDIA_DATA")}return}if(o.type==="PLAYER_EVENT"&&o.data)if(o.data.event==="timeupdate"){const a={progress:o.data.time,duration:o.data.duration};a.progress&&a.duration&&n(a,"PLAYER_EVENT")}else o.data.event==="ended"&&(r==="tv"||r==="anime")?console.log('Player reported "ended" event - Videasy will handle next episode automatically.'):o.data.event==="player_ready"&&(console.log("Player is ready."),ee(!0))}catch(o){console.error("Error processing message from player:",{origin:t.origin,data:t.data,error:o.message})}},window.addEventListener("message",i),()=>{window.removeEventListener("message",i),O.current&&clearTimeout(O.current)}},[l,N,ge,u,f,y]),_(()=>{if($&&!N&&!D){const s=setTimeout(()=>{D||(console.warn("Player ready timeout, starting fallback progress tracking."),ws())},1e4);return()=>clearTimeout(s)}},[$,N,D]);const ws=()=>{const s=setInterval(()=>{document.hasFocus()&&console.log("Fallback: Checking for progress...")},15e3);return()=>clearInterval(s)};if(_(()=>(X(!1),!$&&!U&&(k.current=setTimeout(()=>{X(!0),console.log("Stream timeout error")},25e3)),()=>{k.current&&clearTimeout(k.current)}),[$,U,u,f,A]),We)return e("div",{class:"container",style:{textAlign:"center",marginTop:"50px"},children:e("div",{class:"error-state",children:[e("h2",{children:"An Error Occurred"}),e("p",{children:We}),e("button",{onClick:()=>j("/"),class:"btn btn-primary",children:"Go Home"})]})});if(cs)return e("div",{class:"loading-state",children:[e("div",{class:"loading-spinner"}),e("p",{children:"Loading media details..."}),e("p",{children:"If your video doesnt load refresh the page or pick a new server."})]});if(!l)return e("div",{class:"container",children:e("div",{class:"error-state",children:[e("h2",{children:"Unable to Load Media"}),e("p",{children:"We couldn't load the details for this content. This could be due to:"}),e("ul",{children:[e("li",{children:"Network connectivity issues"}),e("li",{children:"The content may no longer be available"}),e("li",{children:"Server maintenance"})]}),e("button",{onClick:()=>window.location.reload(),class:"btn btn-primary",style:{marginTop:"20px"},children:"Try Again"})]})});const{title:Pe,name:Te,overview:$s,vote_average:js,release_date:Ke,first_air_date:Y,last_air_date:Qe,runtime:Xe,number_of_seasons:Ze,genres:es,poster_path:ss,status:rs}=l,ts=r==="anime"?d:l.id,ke=bs(ts,r);(Ke||Y)&&new Date(Ke||Y).getFullYear();const Ss=()=>{const s={...l,id:ts,type:r};ke?Ws(s):Os(s)},Es=async()=>{const s=document.querySelector('iframe[title="Video Player"]'),n=document.querySelector("video"),i=N?n:s;if(i&&B.current&&l){const t={title:l.title||l.name||"Video",url:window.location.href,type:r,id:d,season:u,episode:f};L?Se():await $e(i,B.current,t)}};return e("div",{children:[e(Ns,{children:e("title",{children:[Pe||Te," - Fovi"]})}),gs&&e("div",{className:"trailer-modal",onClick:()=>de(!1),children:e("div",{className:"trailer-content",onClick:s=>s.stopPropagation(),children:[e("span",{className:"close-trailer",onClick:()=>de(!1),children:"Ã—"}),e("iframe",{src:`https://www.youtube.com/embed/${Ie.find(s=>s.type==="Trailer")?.key}?autoplay=1`,frameBorder:"0",allow:"autoplay; encrypted-media; fullscreen",allowFullScreen:!0,title:"Trailer"})]})}),e("div",{class:"player-container",ref:B,children:[!$&&U&&e("div",{class:"stream-error-message",children:[e("p",{children:U.message}),U.canRetry&&e("div",{class:"error-actions",children:[e("button",{onClick:async()=>{Ne(!0),setTimeout(()=>{(async()=>{const n=`${M}/stream-url?type=${r}&id=${d}&source=${A}${r==="tv"||r==="anime"?`&season=${u}&episode=${f}`:""}${r==="anime"?`&dub=${Q}`:""}`;try{const i=await fetch(n),t=await i.json();if(i.ok)z(t.url),ue(t.isDirectSource),me(t.qualities||[]),V(null);else throw new Error(t.message)}catch(i){console.error("Retry failed:",i),V({message:"Retry failed. Please try selecting a different source.",canRetry:!0})}Ne(!1)})()},1e3)},disabled:Fe,class:"btn retry-btn",children:Fe?"Retrying...":"Retry"}),e("p",{children:"Or try selecting a different source from the list below."})]})]}),!$&&!U&&!De&&e("div",{class:"stream-loading",children:[e("p",{children:"Loading video stream... "}),e("p",{children:"If your video doesnt load refresh the page or pick a new server."})]}),!$&&!U&&De&&e("div",{class:"stream-error-message",children:[e("p",{children:"Sorry, this episode failed to load. Please refresh the page."}),e("div",{class:"error-actions",children:[e("button",{onClick:()=>window.location.reload(),class:"btn retry-btn",children:"Refresh"}),e("p",{children:"Or try selecting a different source from the list below if refreshing doesn't work."})]})]}),N?e("video",{ref:ge,src:$,controls:!0,autoPlay:!0,playsInline:!0,preload:"metadata",width:"100%",style:{maxWidth:"100%",height:"auto"},"x-webkit-airplay":"allow","webkit-playsinline":"true"}):$&&e("iframe",{src:$,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},frameBorder:"0",allowFullScreen:!0,allow:"autoplay; fullscreen; picture-in-picture; encrypted-media; accelerometer; gyroscope; web-share",title:"Video Player",loading:"eager",referrerPolicy:"no-referrer-when-downgrade",importance:"high",onLoad:()=>{console.log("ðŸŽ¬ Player iframe loaded"),ee(!0),A!=="videasy"&&W>30?setTimeout(()=>{const s=document.querySelector("iframe");if(s&&s.contentWindow)try{s.contentWindow.postMessage({type:"SEEK_TO",time:W},"*"),console.log(`ðŸ“ Sent seek command to restore progress: ${W}s`)}catch(n){console.log("Could not send seek command:",n)}},500):console.log(A==="videasy"?"ðŸ“ Videasy native resume - no seeking needed":"ðŸ“ No significant progress to resume, starting from beginning")}})]}),e("div",{class:"container",children:[e("div",{class:"media-details-layout",children:[e("div",{class:"poster",children:[e("img",{src:is(ss?`${as}${ss}`:"https://via.placeholder.com/500x750.png?text=No+Image"),alt:Pe||Te}),Be>0&&e("div",{class:"movie-progress-container",children:[e("div",{class:"movie-progress-bar",children:e("div",{class:"movie-progress",style:{width:`${Math.max(2,Be)}%`}})}),e("div",{class:"movie-progress-text",children:E.duration_seconds>0?`${Math.floor(E.progress_seconds/60)}m / ${Math.floor(E.duration_seconds/60)}m watched`:`${Math.floor(E.progress_seconds/60)}m watched`})]})]}),e("div",{class:"details",children:[e("div",{class:"title-container",children:[e("h1",{children:Pe||Te}),e("button",{onClick:Ss,class:`favorite-btn ${ke?"favorited":""}`,disabled:!je,children:je?ke?"â™¥ Favorited":"â™¡ Favorite":"..."}),e("button",{onClick:_s,class:"favorite-btn trailer-btn",children:[e("i",{class:"fas fa-film"})," Trailer"]}),ie&&e("button",{onClick:Es,class:`favorite-btn pip-btn ${L?"active":""}`,title:L?"Close Mini Player":"Open Mini Player",children:[e("i",{class:"fas fa-compress-alt"})," ",L?"Close PiP":"Mini Player"]}),!He&&e("span",{class:"login-hint",children:e("small",{children:[e("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in"})," to save favorites, track progress & continue watching"]})})]}),e("div",{class:"meta",children:[e("span",{class:"rating",children:["â˜… ",l.vote_average?l.vote_average.toFixed(1):"N/A"]}),(r==="tv"||r==="anime")&&Y&&e("span",{style:{marginLeft:8},children:(()=>{const s=Y?new Date(Y).getFullYear():null;let n=null;return Qe?n=new Date(Qe).getFullYear():rs&&rs.toLowerCase()==="ended"&&(n=s),s&&n&&s===n?`${s}`:s&&n&&n!==s?`${s} - ${n}`:s?`${s} -`:""})()}),Xe&&e("span",{children:[Xe," min"]}),Ze&&e("span",{children:[Ze," Seasons"]})]}),e("div",{class:"genres",children:es&&es.map(s=>e("span",{class:"genre-tag",children:s.name}))}),e("p",{class:"overview",children:$s}),Oe.length>0&&e("div",{class:"quality-selector",children:[e("label",{children:"Quality:"}),Oe.map(s=>e("button",{class:`quality-btn ${$===s.url?"active":""}`,onClick:()=>z(s.url),children:[s.quality,"p"]}))]})]})]}),r==="anime"&&e("div",{class:"select-container",children:[e("label",{for:"dub-select",children:"Audio:"}),e("select",{id:"dub-select",value:Q,onChange:s=>ms(s.target.value==="true"),children:[e("option",{value:"false",children:"Subbed"}),e("option",{value:"true",children:"Dubbed"})]})]}),e("div",{class:"selectors-container",children:[(r==="tv"||r==="anime")&&l&&l.seasons&&e("div",{class:"select-container",children:[e("label",{children:"Season:"}),e("div",{class:"selector-buttons",children:l.seasons.filter(s=>s.season_number>0).map(s=>e("button",{class:`selector-btn ${u===s.season_number?"active":""}`,onClick:()=>{console.log(`ðŸŽ¯ User manually selected season ${s.season_number}`),ye.current=!0,_e.current=null;const n=`/watch/${r}/${d}/season/${s.season_number}/episode/1`;j(n,!0)},children:s.name},s.id))})]}),Le.length>1&&e("div",{class:"select-container",children:[e("label",{children:"Source:"}),e("div",{class:"selector-buttons",children:Le.map(s=>e("button",{class:`selector-btn ${A===s?"active":""}`,onClick:()=>Re(s),children:s},s))})]})]}),(r==="tv"||r==="anime")&&u!==null&&f!==null&&e("div",{class:"episodes-container",children:[e("h3",{children:"Episodes"}),us?e("div",{class:"loading-spinner"}):e(Fs,{children:[e("div",{class:"episode-list",children:K?.episodes?.slice((he-1)*F,he*F)?.map(s=>{const n=hs.find(t=>t.season_number===u&&t.episode_number===s.episode_number),i=n&&n.progress_seconds>0?n.duration_seconds&&n.duration_seconds>0?Math.min(100,n.progress_seconds/n.duration_seconds*100):n.progress_seconds>30?5:2:0;return n&&n.progress_seconds>0&&console.log(`ðŸ“Š Episode ${s.episode_number} progress:`,{progress_seconds:n.progress_seconds,duration_seconds:n.duration_seconds,progressPercent:i}),e("div",{class:`episode-card ${s.episode_number===f?"active":""}`,onClick:()=>{console.log(`ðŸŽ¯ User manually selected episode ${s.episode_number}`),ye.current=!0,_e.current=null;const t=`/watch/${r}/${d}/season/${u}/episode/${s.episode_number}`;j(t,!0)},children:[e("div",{class:"episode-card-image",children:[e("img",{src:is(s.still_path?s.still_path.startsWith("/anilist_images/")||s.still_path.startsWith("http")?s.still_path:`${as}${s.still_path}`:`https://via.placeholder.com/300x169.png?text=${encodeURIComponent(s.name)}`),alt:s.name}),e("div",{class:"episode-number-badge",children:s.episode_number}),i>0&&e("div",{class:"episode-progress-container",children:[e("div",{class:"episode-progress-bar",children:e("div",{class:"episode-progress",style:{width:`${Math.max(2,i)}%`}})}),e("div",{class:"episode-progress-text",children:n&&n.duration_seconds>0?`${Math.floor(n.progress_seconds/60)}m / ${Math.floor(n.duration_seconds/60)}m`:`${Math.floor(n.progress_seconds/60)}m watched`})]})]}),e("div",{class:"episode-card-content",children:[e("h4",{children:[s.name,s.air_date&&e("span",{style:{color:"#aaa",fontWeight:400,fontSize:"0.95em",marginLeft:8},children:["â€¢ ",(()=>{const t=new Date(s.air_date);return isNaN(t)?null:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})})()]})]}),e("p",{class:"episode-overview",children:s.overview})]})]},s.id)})}),K?.episodes&&K.episodes.length>F&&(()=>{const s=Math.ceil(K.episodes.length/F),n=10,i=Math.ceil(s/n),t=(fe-1)*n+1,h=Math.min(t+n-1,s),c=Array.from({length:h-t+1},(o,a)=>t+a);return e("div",{class:"pagination-controls",children:[fe>1&&e("button",{onClick:()=>Ve(o=>o-1),children:e("i",{class:"fas fa-angle-double-left"})}),c.map(o=>e("button",{class:he===o?"active":"",onClick:()=>se(o),children:o},o)),fe<i&&e("button",{onClick:()=>Ve(o=>o+1),children:e("i",{class:"fas fa-angle-double-right"})})]})})()]})]}),Ae.length>0&&e("div",{class:"recommendations",children:[e("h2",{children:"More Like This"}),e("div",{class:"movie-grid",children:Ae.map(s=>e(Ds,{item:s,type:r,progress:null,duration:null},`${s.media_type||r}-${s.id}`))})]})]})]})};export{Xs as default};
//# sourceMappingURL=Watch-Cg-Ox51k.js.map
