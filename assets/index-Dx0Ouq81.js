import{l as ds,K as ao,H as hs,J as aa,_ as Dn,x as la,a as lo,d as U,y as se,k as ht,R as fs,p as ca,q as ua,A as ye,T as da,E as ha}from"./react-vendor-BYlzYzcd.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var fa=0;function l(n,e,t,r,s,i){e||(e={});var o,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?o=e[a]:c[a]=e[a];var u={type:n,props:c,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--fa,__i:-1,__u:0,__source:s,__self:i};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return ds.vnode&&ds.vnode(u),u}var pa={};function kt(n,e){for(var t in e)n[t]=e[t];return n}function Sn(n,e,t){var r,s=/(?:\?([^#]*))?(#.*)?$/,i=n.match(s),o={};if(i&&i[1])for(var a=i[1].split("&"),c=0;c<a.length;c++){var u=a[c].split("=");o[decodeURIComponent(u[0])]=decodeURIComponent(u.slice(1).join("="))}n=En(n.replace(s,"")),e=En(e||"");for(var h=Math.max(n.length,e.length),d=0;d<h;d++)if(e[d]&&e[d].charAt(0)===":"){var f=e[d].replace(/(^:|[+*?]+$)/g,""),p=(e[d].match(/[+*?]+$/)||pa)[0]||"",g=~p.indexOf("+"),m=~p.indexOf("*"),v=n[d]||"";if(!v&&!m&&(p.indexOf("?")<0||g)){r=!1;break}if(o[f]=decodeURIComponent(v),g||m){o[f]=n.slice(d).map(decodeURIComponent).join("/");break}}else if(e[d]!==n[d]){r=!1;break}return(t.default===!0||r!==!1)&&o}function ga(n,e){return n.rank<e.rank?1:n.rank>e.rank?-1:n.index-e.index}function va(n,e){return n.index=e,n.rank=function(t){return t.props.default?0:En(t.props.path).map(ma).join("")}(n),n.props}function En(n){return n.replace(/(^\/+|\/+$)/g,"").split("/")}function ma(n){return n.charAt(0)==":"?1+"*+?".indexOf(n.charAt(n.length-1))||4:5}var ya={},Xe=[],$t=[],Ee=null,Ln={url:qn()},co=ao(Ln);function _a(){var n=lo(co);if(n===Ln){var e=U()[1];se(function(){return $t.push(e),function(){return $t.splice($t.indexOf(e),1)}},[])}return[n,$e]}function qn(){var n;return""+((n=Ee&&Ee.location?Ee.location:Ee&&Ee.getCurrentLocation?Ee.getCurrentLocation():typeof location<"u"?location:ya).pathname||"")+(n.search||"")}function $e(n,e){return e===void 0&&(e=!1),typeof n!="string"&&n.url&&(e=n.replace,n=n.url),function(t){for(var r=Xe.length;r--;)if(Xe[r].canRoute(t))return!0;return!1}(n)&&function(t,r){r===void 0&&(r="push"),Ee&&Ee[r]?Ee[r](t):typeof history<"u"&&history[r+"State"]&&history[r+"State"](null,null,t)}(n,e?"replace":"push"),uo(n)}function uo(n){for(var e=!1,t=0;t<Xe.length;t++)Xe[t].routeTo(n)&&(e=!0);return e}function wa(n){if(n&&n.getAttribute){var e=n.getAttribute("href"),t=n.getAttribute("target");if(e&&e.match(/^\//g)&&(!t||t.match(/^_?self$/i)))return $e(e)}}function ba(n){return n.stopImmediatePropagation&&n.stopImmediatePropagation(),n.stopPropagation&&n.stopPropagation(),n.preventDefault(),!1}function ho(n){if(!(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.button)){var e=n.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(wa(e))return ba(n)}while(e=e.parentNode)}}var ps=!1;function fo(n){n.history&&(Ee=n.history),this.state={url:n.url||qn()}}kt(fo.prototype=new la,{shouldComponentUpdate:function(n){return n.static!==!0||n.url!==this.props.url||n.onChange!==this.props.onChange},canRoute:function(n){var e=hs(this.props.children);return this.g(e,n)!==void 0},routeTo:function(n){this.setState({url:n});var e=this.canRoute(n);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var n=this;ps||(ps=!0,Ee||addEventListener("popstate",function(){uo(qn())}),addEventListener("click",ho)),Xe.push(this),Ee&&(this.u=Ee.listen(function(e){var t=e.location||e;n.routeTo(""+(t.pathname||"")+(t.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),Xe.splice(Xe.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(n,e){n=n.filter(va).sort(ga);for(var t=0;t<n.length;t++){var r=n[t],s=Sn(e,r.props.path,r.props);if(s)return[r,s]}},render:function(n,e){var t,r,s=n.onChange,i=e.url,o=this.c,a=this.g(hs(n.children),i);if(a&&(r=aa(a[0],kt(kt({url:i,matches:t=a[1]},t),{key:void 0,ref:void 0}))),i!==(o&&o.url)){kt(Ln,o=this.c={url:i,previous:o&&o.url,current:r,path:r?r.props.path:null,matches:t}),o.router=this,o.active=r?[r]:[];for(var c=$t.length;c--;)$t[c]({});typeof s=="function"&&s(o)}return Dn(co.Provider,{value:o},r)}});var Ne=function(n){return Dn("a",kt({onClick:ho},n))};function Kt(){return Kt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Kt.apply(null,arguments)}var ft;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(ft||(ft={}));var gs=function(n){return n},vs="beforeunload",Sa="hashchange",Ea="popstate";function Ta(n){n===void 0&&(n={});var e=n,t=e.window,r=t===void 0?document.defaultView:t,s=r.history;function i(){var $=_s(r.location.hash.substr(1)),B=$.pathname,X=B===void 0?"/":B,G=$.search,Z=G===void 0?"":G,ae=$.hash,te=ae===void 0?"":ae,fe=s.state||{};return[fe.idx,gs({pathname:X,search:Z,hash:te,state:fe.usr||null,key:fe.key||"default"})]}var o=null;function a(){if(o)p.call(o),o=null;else{var $=ft.Pop,B=i(),X=B[0],G=B[1];if(p.length){if(X!=null){var Z=h-X;Z&&(o={action:$,location:G,retry:function(){x(Z*-1)}},x(Z))}}else _($)}}r.addEventListener(Ea,a),r.addEventListener(Sa,function(){var $=i(),B=$[1];sr(B)!==sr(d)&&a()});var c=ft.Pop,u=i(),h=u[0],d=u[1],f=ys(),p=ys();h==null&&(h=0,s.replaceState(Kt({},s.state,{idx:h}),""));function g(){var $=document.querySelector("base"),B="";if($&&$.getAttribute("href")){var X=r.location.href,G=X.indexOf("#");B=G===-1?X:X.slice(0,G)}return B}function m($){return g()+"#"+(typeof $=="string"?$:sr($))}function v($,B){return B===void 0&&(B=null),gs(Kt({pathname:d.pathname,hash:"",search:""},typeof $=="string"?_s($):$,{state:B,key:Pa()}))}function w($,B){return[{usr:$.state,key:$.key,idx:B},m($)]}function T($,B,X){return!p.length||(p.call({action:$,location:B,retry:X}),!1)}function _($){c=$;var B=i();h=B[0],d=B[1],f.call({action:c,location:d})}function P($,B){var X=ft.Push,G=v($,B);function Z(){P($,B)}if(T(X,G,Z)){var ae=w(G,h+1),te=ae[0],fe=ae[1];try{s.pushState(te,"",fe)}catch{r.location.assign(fe)}_(X)}}function E($,B){var X=ft.Replace,G=v($,B);function Z(){E($,B)}if(T(X,G,Z)){var ae=w(G,h),te=ae[0],fe=ae[1];s.replaceState(te,"",fe),_(X)}}function x($){s.go($)}var L={get action(){return c},get location(){return d},createHref:m,push:P,replace:E,go:x,back:function(){x(-1)},forward:function(){x(1)},listen:function(B){return f.push(B)},block:function(B){var X=p.push(B);return p.length===1&&r.addEventListener(vs,ms),function(){X(),p.length||r.removeEventListener(vs,ms)}}};return L}function ms(n){n.preventDefault(),n.returnValue=""}function ys(){var n=[];return{get length(){return n.length},push:function(t){return n.push(t),function(){n=n.filter(function(r){return r!==t})}},call:function(t){n.forEach(function(r){return r&&r(t)})}}}function Pa(){return Math.random().toString(36).substr(2,8)}function sr(n){var e=n.pathname,t=e===void 0?"/":e,r=n.search,s=r===void 0?"":r,i=n.hash,o=i===void 0?"":i;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function _s(n){var e={};if(n){var t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));var r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}const ka="modulepreload",Aa=function(n){return"/"+n},ws={},xt=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let c=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=c(t.map(u=>{if(u=Aa(u),u in ws)return;ws[u]=!0;const h=u.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":ka,h||(f.as="script"),f.crossOrigin="",f.href=u,a&&f.setAttribute("nonce",a),document.head.appendChild(f),h)return new Promise((p,g)=>{f.addEventListener("load",p),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},$a=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>yt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Mn extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Ra extends Mn{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class bs extends Mn{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ss extends Mn{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Tn;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Tn||(Tn={}));var Oa=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class ja{constructor(e,{headers:t={},customFetch:r,region:s=Tn.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=$a(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Oa(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},{region:c}=t;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(a["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let h;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(a["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(a["Content-Type"]="application/json",h=JSON.stringify(o)));const d=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:h}).catch(m=>{throw new Ra(m)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new bs(d);if(!d.ok)throw new Ss(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield d.json():p==="application/octet-stream"?g=yield d.blob():p==="text/event-stream"?g=d:p==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null,response:d}}catch(s){return{data:null,error:s,response:s instanceof Ss||s instanceof bs?s.context:void 0}}})}}function po(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function go(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var ce={},tt={},rt={},nt={},st={},it={},Ca=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},pt=Ca();const Ia=pt.fetch,vo=pt.fetch.bind(pt),mo=pt.Headers,xa=pt.Request,Na=pt.Response,yt=Object.freeze(Object.defineProperty({__proto__:null,Headers:mo,Request:xa,Response:Na,default:vo,fetch:Ia},Symbol.toStringTag,{value:"Module"})),Ua=go(yt);var Lt={},Es;function yo(){if(Es)return Lt;Es=1,Object.defineProperty(Lt,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Lt.default=n,Lt}var Ts;function _o(){if(Ts)return it;Ts=1;var n=it&&it.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(it,"__esModule",{value:!0});const e=n(Ua),t=n(yo());class r{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let c=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var h,d,f;let p=null,g=null,m=null,v=u.status,w=u.statusText;if(u.ok){if(this.method!=="HEAD"){const E=await u.text();E===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=E:g=JSON.parse(E))}const _=(h=this.headers.Prefer)===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),P=(d=u.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");_&&P&&P.length>1&&(m=parseInt(P[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(p={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,m=null,v=406,w="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const _=await u.text();try{p=JSON.parse(_),Array.isArray(p)&&u.status===404&&(g=[],p=null,v=200,w="OK")}catch{u.status===404&&_===""?(v=204,w="No Content"):p={message:_}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,v=200,w="OK"),p&&this.shouldThrowOnError)throw new t.default(p)}return{error:p,data:g,count:m,status:v,statusText:w}});return this.shouldThrowOnError||(c=c.catch(u=>{var h,d,f;return{error:{message:`${(h=u?.name)!==null&&h!==void 0?h:"FetchError"}: ${u?.message}`,details:`${(d=u?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=u?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,o)}returns(){return this}overrideTypes(){return this}}return it.default=r,it}var Ps;function wo(){if(Ps)return st;Ps=1;var n=st&&st.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(st,"__esModule",{value:!0});const e=n(_o());class t extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:c=a}={}){const u=c?`${c}.order`:"order",h=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${h?`${h},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const c=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(c,`${s}`),this.url.searchParams.set(u,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:c=!1,format:u="text"}={}){var h;const d=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(h=this.headers.Accept)!==null&&h!==void 0?h:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${f}"; options=${d};`,u==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return st.default=t,st}var ks;function Fn(){if(ks)return nt;ks=1;var n=nt&&nt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(nt,"__esModule",{value:!0});const e=n(wo());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let c="";a==="plain"?c="pl":a==="phrase"?c="ph":a==="websearch"&&(c="w");const u=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${c}fts${u}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return nt.default=t,nt}var As;function bo(){if(As)return rt;As=1;var n=rt&&rt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(rt,"__esModule",{value:!0});const e=n(Fn());class t{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=i,this.schema=o,this.fetch=a}select(s,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let c=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!c?"":(h==='"'&&(c=!c),h)).join("");return this.url.searchParams.set("select",u),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:i,defaultToNull:o=!0}={}){const a="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),o||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(s)){const u=s.reduce((h,d)=>h.concat(Object.keys(d)),[]);if(u.length>0){const h=[...new Set(u)].map(d=>`"${d}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:c=!0}={}){const u="POST",h=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&h.push(this.headers.Prefer),a&&h.push(`count=${a}`),c||h.push("missing=default"),this.headers.Prefer=h.join(","),Array.isArray(s)){const d=s.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(d.length>0){const f=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const i="DELETE",o=[];return s&&o.push(`count=${s}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return rt.default=t,rt}var Tt={},Pt={},$s;function Da(){return $s||($s=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.version=void 0,Pt.version="0.0.0-automated"),Pt}var Rs;function La(){if(Rs)return Tt;Rs=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.DEFAULT_HEADERS=void 0;const n=Da();return Tt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},Tt}var Os;function qa(){if(Os)return tt;Os=1;var n=tt&&tt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(tt,"__esModule",{value:!0});const e=n(bo()),t=n(Fn()),r=La();class s{constructor(o,{headers:a={},schema:c,fetch:u}={}){this.url=o,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),a),this.schemaName=c,this.fetch=u}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new s(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:c=!1,get:u=!1,count:h}={}){let d;const f=new URL(`${this.url}/rpc/${o}`);let p;c||u?(d=c?"HEAD":"GET",Object.entries(a).filter(([m,v])=>v!==void 0).map(([m,v])=>[m,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([m,v])=>{f.searchParams.append(m,v)})):(d="POST",p=a);const g=Object.assign({},this.headers);return h&&(g.Prefer=`count=${h}`),new t.default({method:d,url:f,headers:g,schema:this.schemaName,body:p,fetch:this.fetch,allowEmpty:!1})}}return tt.default=s,tt}var js;function Ma(){if(js)return ce;js=1;var n=ce&&ce.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(ce,"__esModule",{value:!0}),ce.PostgrestError=ce.PostgrestBuilder=ce.PostgrestTransformBuilder=ce.PostgrestFilterBuilder=ce.PostgrestQueryBuilder=ce.PostgrestClient=void 0;const e=n(qa());ce.PostgrestClient=e.default;const t=n(bo());ce.PostgrestQueryBuilder=t.default;const r=n(Fn());ce.PostgrestFilterBuilder=r.default;const s=n(wo());ce.PostgrestTransformBuilder=s.default;const i=n(_o());ce.PostgrestBuilder=i.default;const o=n(yo());return ce.PostgrestError=o.default,ce.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},ce}var Fa=Ma();const Ba=po(Fa),{PostgrestClient:Wa,PostgrestQueryBuilder:Yu,PostgrestFilterBuilder:Qu,PostgrestTransformBuilder:Xu,PostgrestBuilder:Zu,PostgrestError:ed}=Ba;function Ha(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Ga=Ha(),Ka="2.11.15",Va=`realtime-js/${Ka}`,za="1.0.0",So=1e4,Ja=1e3;var Rt;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Rt||(Rt={}));var pe;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(pe||(pe={}));var Ce;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Ce||(Ce={}));var Pn;(function(n){n.websocket="websocket"})(Pn||(Pn={}));var Qe;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Qe||(Qe={}));class Ya{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const c=r.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:u}}}class Eo{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ee;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(ee||(ee={}));const Cs=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Qa(o,n,e,s),i),{})},Qa=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s?.type,o=t[n];return i&&!r.includes(i)?To(i,o):kn(o)},To=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return tl(e,t)}switch(n){case ee.bool:return Xa(e);case ee.float4:case ee.float8:case ee.int2:case ee.int4:case ee.int8:case ee.numeric:case ee.oid:return Za(e);case ee.json:case ee.jsonb:return el(e);case ee.timestamp:return rl(e);case ee.abstime:case ee.date:case ee.daterange:case ee.int4range:case ee.int8range:case ee.money:case ee.reltime:case ee.text:case ee.time:case ee.timestamptz:case ee.timetz:case ee.tsrange:case ee.tstzrange:return kn(e);default:return kn(e)}},kn=n=>n,Xa=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Za=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},el=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},tl=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>To(e,a))}return n},rl=n=>typeof n=="string"?n.replace(" ","T"):n,Po=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class ir{constructor(e,t,r={},s=So){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Is;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Is||(Is={}));class Ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ot.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=Ot.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ot.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(u,h)=>{o[u]||(c[u]=h)}),this.map(o,(u,h)=>{const d=i[u];if(d){const f=h.map(v=>v.presence_ref),p=d.map(v=>v.presence_ref),g=h.filter(v=>p.indexOf(v.presence_ref)<0),m=d.filter(v=>f.indexOf(v.presence_ref)<0);g.length>0&&(a[u]=g),m.length>0&&(c[u]=m)}else a[u]=h}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var u;const h=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(c),h.length>0){const d=e[a].map(p=>p.presence_ref),f=h.filter(p=>d.indexOf(p.presence_ref)<0);e[a].unshift(...f)}r(a,h,c)}),this.map(o,(a,c)=>{let u=e[a];if(!u)return;const h=c.map(d=>d.presence_ref);u=u.filter(d=>h.indexOf(d.presence_ref)<0),e[a]=u,s(a,u,c),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var xs;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(xs||(xs={}));var Ns;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ns||(Ns={}));var qe;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(qe||(qe={}));class Bn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=pe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ir(this,Ce.join,this.params,this.timeout),this.rejoinTimer=new Eo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=pe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=pe.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=pe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=pe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ce.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Ot(this),this.broadcastEndpointURL=Po(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==pe.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(h=>e?.(qe.CHANNEL_ERROR,h)),this._onClose(()=>e?.(qe.CLOSED));const c={},u={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var d;if(this.socket.setAuth(),h===void 0){e?.(qe.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(d=f?.length)!==null&&d!==void 0?d:0,g=[];for(let m=0;m<p;m++){const v=f[m],{filter:{event:w,schema:T,table:_,filter:P}}=v,E=h&&h[m];if(E&&E.event===w&&E.schema===T&&E.table===_&&E.filter===P)g.push(Object.assign(Object.assign({},v),{id:E.id}));else{this.unsubscribe(),this.state=pe.errored,e?.(qe.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(qe.SUBSCRIBED);return}}).receive("error",h=>{this.state=pe.errored,e?.(qe.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e?.(qe.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=pe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ce.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new ir(this,Ce.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new ir(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:u,join:h}=Ce;if(r&&[a,c,u,h].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var g,m,v;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(m=p.filter)===null||m===void 0?void 0:m.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(p=>p.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var g,m,v,w,T,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const P=p.id,E=(g=p.filter)===null||g===void 0?void 0:g.event;return P&&((m=t.ids)===null||m===void 0?void 0:m.includes(P))&&(E==="*"||E?.toLocaleLowerCase()===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const P=(T=(w=p?.filter)===null||w===void 0?void 0:w.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return P==="*"||P===((_=t?.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:m,table:v,commit_timestamp:w,type:T,errors:_}=g;f=Object.assign(Object.assign({},{schema:m,table:v,commit_timestamp:w,eventType:T,new:{},old:{},errors:_}),this._getPayloadRecords(g))}p.callback(f,r)})}_isClosed(){return this.state===pe.closed}_isJoined(){return this.state===pe.joined}_isJoining(){return this.state===pe.joining}_isLeaving(){return this.state===pe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Bn.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ce.close,{},e)}_onError(e){this._on(Ce.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=pe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Cs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Cs(e.columns,e.old_record)),t}}const Us=()=>{},nl=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class sl{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=So,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Us,this.ref=0,this.logger=Us,this.conn=null,this.sendBuffer=[],this.serializer=new Ya,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>xt(async()=>{const{default:c}=await Promise.resolve().then(()=>yt);return{default:c}},void 0).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${Pn.websocket}`,this.httpEndpoint=Po(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t?.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t?.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Eo(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=Ga),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:za}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Rt.connecting:return Qe.Connecting;case Rt.open:return Qe.Open;case Rt.closing:return Qe.Closing;default:return Qe.Closed}}isConnected(){return this.connectionState()===Qe.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Bn(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:Va};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(Ce.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Ja,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;r==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ce.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([nl],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class Wn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ue(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class il extends Wn{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class An extends Wn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var ol=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const ko=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>yt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},al=()=>ol(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield xt(()=>Promise.resolve().then(()=>yt),void 0)).Response:Response}),$n=n=>{if(Array.isArray(n))return n.map(t=>$n(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=$n(r)}),e};var Ze=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const or=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ll=(n,e,t)=>Ze(void 0,void 0,void 0,function*(){const r=yield al();n instanceof r&&!t?.noResolveJson?n.json().then(s=>{e(new il(or(s),n.status||500))}).catch(s=>{e(new An(or(s),s))}):e(new An(or(n),n))}),cl=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),t))};function Nt(n,e,t,r,s,i){return Ze(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,cl(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>ll(c,a,r))})})}function Vt(n,e,t,r){return Ze(this,void 0,void 0,function*(){return Nt(n,"GET",e,t,r)})}function We(n,e,t,r,s){return Ze(this,void 0,void 0,function*(){return Nt(n,"POST",e,r,s,t)})}function ul(n,e,t,r,s){return Ze(this,void 0,void 0,function*(){return Nt(n,"PUT",e,r,s,t)})}function dl(n,e,t,r){return Ze(this,void 0,void 0,function*(){return Nt(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Ao(n,e,t,r,s){return Ze(this,void 0,void 0,function*(){return Nt(n,"DELETE",e,r,s,t)})}var _e=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const hl={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ds={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class fl{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=ko(s)}uploadOrUpdate(e,t,r,s){return _e(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ds),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(a=Object.assign(Object.assign({},a),s.headers));const u=this._removeEmptyFolders(t),h=this._getFinalPath(u),d=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),f=yield d.json();return d.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(ue(i))return{data:null,error:i};throw i}})}upload(e,t,r){return _e(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return _e(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Ds.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:h}),f=yield d.json();return d.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(ue(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return _e(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const i=yield We(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new Wn("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(r){if(ue(r))return{data:null,error:r};throw r}})}update(e,t,r){return _e(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return _e(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(ue(s))return{data:null,error:s};throw s}})}copy(e,t,r){return _e(this,void 0,void 0,function*(){try{return{data:{path:(yield We(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(ue(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return _e(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield We(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(ue(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return _e(this,void 0,void 0,function*(){try{const s=yield We(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(ue(s))return{data:null,error:s};throw s}})}download(e,t){return _e(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Vt(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(ue(a))return{data:null,error:a};throw a}})}info(e){return _e(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Vt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:$n(r),error:null}}catch(r){if(ue(r))return{data:null,error:r};throw r}})}exists(e){return _e(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield dl(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(ue(r)&&r instanceof An){const s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&s.push(c);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${u}`)}}}remove(e){return _e(this,void 0,void 0,function*(){try{return{data:yield Ao(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ue(t))return{data:null,error:t};throw t}})}list(e,t,r){return _e(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},hl),t),{prefix:e||""});return{data:yield We(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(ue(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const pl="2.7.1",gl={"X-Client-Info":`storage-js/${pl}`};var ot=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class vl{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},gl),t),this.fetch=ko(r)}listBuckets(){return ot(this,void 0,void 0,function*(){try{return{data:yield Vt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ue(e))return{data:null,error:e};throw e}})}getBucket(e){return ot(this,void 0,void 0,function*(){try{return{data:yield Vt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ue(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ot(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ue(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ot(this,void 0,void 0,function*(){try{return{data:yield ul(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(ue(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ot(this,void 0,void 0,function*(){try{return{data:yield We(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ue(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ot(this,void 0,void 0,function*(){try{return{data:yield Ao(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ue(t))return{data:null,error:t};throw t}})}}class ml extends vl{constructor(e,t={},r){super(e,t,r)}from(e){return new fl(this.url,this.headers,e,this.fetch)}}const yl="2.50.5";let At="";typeof Deno<"u"?At="deno":typeof document<"u"?At="web":typeof navigator<"u"&&navigator.product==="ReactNative"?At="react-native":At="node";const _l={"X-Client-Info":`supabase-js-${At}/${yl}`},wl={headers:_l},bl={schema:"public"},Sl={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},El={};var Tl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};const Pl=n=>{let e;return n?e=n:typeof fetch>"u"?e=vo:e=fetch,(...t)=>e(...t)},kl=()=>typeof Headers>"u"?mo:Headers,Al=(n,e,t)=>{const r=Pl(t),s=kl();return(i,o)=>Tl(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let u=new s(o?.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:u}))})};var $l=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};function Rl(n){return n.endsWith("/")?n:n+"/"}function Ol(n,e){var t,r;const{db:s,auth:i,realtime:o,global:a}=n,{db:c,auth:u,realtime:h,global:d}=e,f={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},h),o),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d?.headers)!==null&&t!==void 0?t:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>$l(this,void 0,void 0,function*(){return""})};return n.accessToken?f.accessToken=n.accessToken:delete f.accessToken,f}const $o="2.70.0",dt=30*1e3,Rn=3,ar=Rn*dt,jl="http://localhost:9999",Cl="supabase.auth.token",Il={"X-Client-Info":`gotrue-js/${$o}`},On="X-Supabase-Api-Version",Ro={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},xl=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Nl=6e5;class Hn extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function H(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Ul extends Hn{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Dl(n){return H(n)&&n.name==="AuthApiError"}class Oo extends Hn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ge extends Hn{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Fe extends Ge{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ll(n){return H(n)&&n.name==="AuthSessionMissingError"}class qt extends Ge{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Mt extends Ge{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ft extends Ge{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ql(n){return H(n)&&n.name==="AuthImplicitGrantRedirectError"}class Ls extends Ge{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jn extends Ge{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function lr(n){return H(n)&&n.name==="AuthRetryableFetchError"}class qs extends Ge{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class jt extends Ge{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ms=` 	
\r=`.split(""),Ml=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Ms.length;e+=1)n[Ms[e].charCodeAt(0)]=-2;for(let e=0;e<zt.length;e+=1)n[zt[e].charCodeAt(0)]=e;return n})();function Fs(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(zt[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(zt[r]),e.queuedBits-=6}}function jo(n,e,t){const r=Ml[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Bs(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Wl(o,r,t)};for(let o=0;o<n.length;o+=1)jo(n.charCodeAt(o),s,i);return e.join("")}function Fl(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Bl(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Fl(r,e)}}function Wl(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Hl(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)jo(n.charCodeAt(s),t,r);return new Uint8Array(e)}function Gl(n){const e=[];return Bl(n,t=>e.push(t)),new Uint8Array(e)}function Kl(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>Fs(s,t,r)),Fs(null,t,r),e.join("")}function Vl(n){return Math.round(Date.now()/1e3)+n}function zl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const je=()=>typeof window<"u"&&typeof document<"u",ze={tested:!1,writable:!1},Ct=()=>{if(!je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ze.tested)return ze.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ze.tested=!0,ze.writable=!0}catch{ze.tested=!0,ze.writable=!1}return ze.writable};function Jl(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Co=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>xt(async()=>{const{default:r}=await Promise.resolve().then(()=>yt);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Yl=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Io=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Bt=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Wt=async(n,e)=>{await n.removeItem(e)};class Yt{constructor(){this.promise=new Yt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Yt.promiseConstructor=Promise;function cr(n){const e=n.split(".");if(e.length!==3)throw new jt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!xl.test(e[r]))throw new jt("JWT not in base64url format");return{header:JSON.parse(Bs(e[0])),payload:JSON.parse(Bs(e[1])),signature:Hl(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ql(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Xl(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function Zl(n){return("0"+n.toString(16)).substr(-2)}function ec(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,Zl).join("")}async function tc(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function rc(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await tc(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function at(n,e,t=!1){const r=ec();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Io(n,`${e}-code-verifier`,s);const i=await rc(r);return[i,r===i?"plain":"s256"]}const nc=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function sc(n){const e=n.headers.get(On);if(!e||!e.match(nc))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function ic(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function oc(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ac=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function lt(n){if(!ac.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var lc=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Ye=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),cc=[502,503,504];async function Ws(n){var e;if(!Yl(n))throw new jn(Ye(n),0);if(cc.includes(n.status))throw new jn(Ye(n),n.status);let t;try{t=await n.json()}catch(i){throw new Oo(Ye(i),i)}let r;const s=sc(n);if(s&&s.getTime()>=Ro["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new qs(Ye(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Fe}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new qs(Ye(t),n.status,t.weak_password.reasons);throw new Ul(Ye(t),n.status||500,r)}const uc=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function V(n,e,t,r){var s;const i=Object.assign({},r?.headers);i[On]||(i[On]=Ro["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await dc(n,e,t+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}}async function dc(n,e,t,r,s,i){const o=uc(e,r,s,i);let a;try{a=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new jn(Ye(c),0)}if(a.ok||await Ws(a),r?.noResolveJson)return a;try{return await a.json()}catch(c){await Ws(c)}}function Le(n){var e;let t=null;gc(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Vl(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Hs(n){const e=Le(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function He(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function hc(n){return{data:n,error:null}}function fc(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=lc(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function pc(n){return n}function gc(n){return n.access_token&&n.refresh_token&&n.expires_in}const ur=["global","local","others"];var vc=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class mc{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Co(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=ur[0]){if(ur.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ur.join(", ")}`);try{return await V(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await V(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:He})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=vc(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await V(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:fc,redirectTo:t?.redirectTo})}catch(t){if(H(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await V(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:He})}catch(t){if(H(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,o,a,c;try{const u={nextPage:null,lastPage:0,total:0},h=await V(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:pc});if(h.error)throw h.error;const d=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(g=>{const m=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);u[`${v}Page`]=m}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(H(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){lt(e);try{return await V(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:He})}catch(t){if(H(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){lt(e);try{return await V(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:He})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){lt(e);try{return await V(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:He})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){lt(e.userId);try{const{data:t,error:r}=await V(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(H(t))return{data:null,error:t};throw t}}async _deleteFactor(e){lt(e.userId),lt(e.id);try{return{data:await V(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}}const yc={getItem:n=>Ct()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ct()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ct()&&globalThis.localStorage.removeItem(n)}};function Gs(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function _c(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ct={debug:!!(globalThis&&Ct()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class xo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class wc extends xo{}async function bc(n,e,t){ct.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ct.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){ct.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{ct.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw ct.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new wc(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ct.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}_c();const Sc={url:jl,storageKey:Cl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Il,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ks(n,e,t){return await t()}class It{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=It.nextInstanceID,It.nextInstanceID+=1,this.instanceID>0&&je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Sc),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new mc({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Co(s.fetch),this.lock=s.lock||Ks,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:je()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=bc:this.lock=Ks,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Ct()?this.storage=yc:(this.memoryStorage={},this.storage=Gs(this.memoryStorage)):(this.memoryStorage={},this.storage=Gs(this.memoryStorage)),je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${$o}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Jl(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),je()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),ql(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return H(t)?{error:t}:{error:new Oo("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Le}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(H(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:h,password:d,options:f}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await at(this.storage,this.storageKey)),i=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:h,password:d,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:g},xform:Le})}else if("phone"in e){const{phone:h,password:d,options:f}=e;i=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(s=f?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Le})}else throw new Mt("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(H(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await V(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Hs})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await V(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Hs})}else throw new Mt("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new qt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,i,o,a,c,u,h,d,f,p;let g,m;if("message"in e)g=e.message,m=e.signature;else{const{chain:v,wallet:w,statement:T,options:_}=e;let P;if(je())if(typeof w=="object")P=w;else{const x=window;if("solana"in x&&typeof x.solana=="object"&&("signIn"in x.solana&&typeof x.solana.signIn=="function"||"signMessage"in x.solana&&typeof x.solana.signMessage=="function"))P=x.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=w}const E=new URL((t=_?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in P&&P.signIn){const x=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_?.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),T?{statement:T}:null));let L;if(Array.isArray(x)&&x[0]&&typeof x[0]=="object")L=x[0];else if(x&&typeof x=="object"&&"signedMessage"in x&&"signature"in x)L=x;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in L&&"signature"in L&&(typeof L.signedMessage=="string"||L.signedMessage instanceof Uint8Array)&&L.signature instanceof Uint8Array)g=typeof L.signedMessage=="string"?L.signedMessage:new TextDecoder().decode(L.signedMessage),m=L.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${E.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),...T?["",T,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(s=(r=_?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=_?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((o=_?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((a=_?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((c=_?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((u=_?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((d=(h=_?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||d===void 0)&&d.length?["Resources",..._.signInWithSolana.resources.map(L=>`- ${L}`)]:[]].join(`
`);const x=await P.signMessage(new TextEncoder().encode(g),"utf8");if(!x||!(x instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=x}}try{const{data:v,error:w}=await V(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Kl(m)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Le});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new qt}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(H(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:o}=await V(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Le});if(await Wt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new qt}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(H(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,a=await V(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Le}),{data:c,error:u}=a;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new qt}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,o;try{if("email"in e){const{email:a,options:c}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await at(this.storage,this.storageKey));const{error:d}=await V(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(r=c?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:c}=e,{data:u,error:h}=await V(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:h}}throw new Mt("You must provide either an email or phone number.")}catch(a){if(H(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await V(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Le});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(H(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await at(this.storage,this.storageKey)),await V(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:hc})}catch(i){if(H(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Fe;const{error:s}=await V(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(H(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await V(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=await V(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new Mt("You must provide either an email or phone number and a type")}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Bt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<ar:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,h)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,h))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await V(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:He}):await this._useSession(async t=>{var r,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Fe}:await V(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:He})})}catch(t){if(H(t))return Ll(t)&&(await this._removeSession(),await Wt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Fe;const o=s.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await at(this.storage,this.storageKey));const{data:u,error:h}=await V(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:He});if(h)throw h;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Fe;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:o}=cr(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(H(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Fe;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!je())throw new Ft("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ft(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ls("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ft("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ls("No code detected.");const{data:T,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:T.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:u}=e;if(!i||!a||!o||!u)throw new Ft("No session defined in URL");const h=Math.round(Date.now()/1e3),d=parseInt(a);let f=h+d;c&&(f=parseInt(c));const p=f-h;p*1e3<=dt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const g=f-d;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,h);const{data:m,error:v}=await this._getUser(i);if(v)throw v;const w={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:f,refresh_token:o,token_type:u,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(r){if(H(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Bt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Dl(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Wt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=zl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await at(this.storage,this.storageKey,!0));try{return await V(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(H(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var o,a,c,u,h;const{data:d,error:f}=i;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await V(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return je()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(H(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)throw o;return await V(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Xl(async s=>(s>0&&await Ql(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await V(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Le})),(s,i)=>{const o=200*Math.pow(2,s);return i&&lr(i)&&Date.now()+o-r<dt})}catch(r){if(this._debug(t,"error",r),H(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),je()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Bt(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<ar;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${ar}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),lr(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Fe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Yt;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Fe;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),H(i)){const o={session:null,error:i};return lr(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Io(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Wt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&je()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),dt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/dt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${dt}ms, refresh threshold is ${Rn} ticks`),s<=Rn&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof xo)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!je()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await at(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await V(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await V(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((s=c?.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await V(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(H(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await V(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(H(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],s=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=cr(s.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const h=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r||(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+Nl>Date.now()))return r;const{data:s,error:i}=await V(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new jt("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),r=s.keys.find(o=>o.kid===e),!r)throw new jt("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};r=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:c}}=cr(r);if(ic(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const u=oc(s.alg),h=await this.fetchJwk(s.kid,t),d=await crypto.subtle.importKey("jwk",h,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,Gl(`${a}.${c}`)))throw new jt("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}}}It.nextInstanceID=0;const Ec=It;class Tc extends Ec{constructor(e){super(e)}}var Pc=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(h){try{u(r.next(h))}catch(d){o(d)}}function c(h){try{u(r.throw(h))}catch(d){o(d)}}function u(h){h.done?i(h.value):s(h.value).then(a,c)}u((r=r.apply(n,e||[])).next())})};class kc{constructor(e,t,r){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Rl(e),c=new URL(a);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,h={db:bl,realtime:El,auth:Object.assign(Object.assign({},Sl),{storageKey:u}),global:wl},d=Ol(r??{},h);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=Al(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Wa(new URL("rest/v1",c).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new ja(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new ml(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Pc(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o,lock:a,debug:c},u,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Tc({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,lock:a,debug:c,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new sl(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ac=(n,e,t)=>new kc(n,e,t),$c=void 0,Rc=void 0;console.log(" Supabase Configuration Check:");console.log("URL:","MISSING");console.log("Anon Key:","MISSING");console.error(" Supabase URL or Anon Key is missing. Make sure to set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your .env file or Vercel environment variables."),console.error("Current env vars:",{VITE_SUPABASE_URL:!1,VITE_SUPABASE_ANON_KEY:!1});const K=Ac($c,Rc,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,storageKey:"sb-auth-token",flowType:"pkce",debug:!1},db:{schema:"public"},global:{headers:{"Content-Type":"application/json","X-Client-Info":"supabase-js-web"},fetch:(n,e={})=>{const t=new AbortController,r=setTimeout(()=>t.abort(),15e3);return fetch(n,{...e,signal:t.signal}).finally(()=>{clearTimeout(r)}).catch(s=>{throw console.error(" Supabase request failed:",{url:n,error:s.message,stack:s.stack}),s})}}}),No=async()=>{try{console.log(" Testing Supabase connection...");const{data:n,error:e}=await K.from("watch_history").select("count").limit(1);if(e)return console.error(" Supabase connection test failed:",e),!1;const{data:t,error:r}=await K.auth.getSession();return r?(console.error(" Auth endpoint test failed:",r),!1):(console.log(" Supabase connection and auth endpoint tests successful"),!0)}catch(n){return console.error(" Supabase connection test error:",n),!1}},Oc=n=>{console.error(" Authentication error:",n);const e={"Invalid API key":"Check your VITE_SUPABASE_ANON_KEY environment variable","Invalid JWT":"Your session may have expired. Try logging in again.","User not found":"This email address is not registered.","Invalid login credentials":"Check your email and password.",NetworkError:"Check your internet connection and try again.","CORS error":"Contact support - there may be a configuration issue."},t=n.message||n.error_description||"Unknown error",r=Object.keys(e).find(s=>t.toLowerCase().includes(s.toLowerCase()));return r&&console.log(" Suggested fix:",e[r]),{message:t,suggestion:r?e[r]:"Please try again or contact support"}};typeof window<"u"&&(window.supabase=K,window.testSupabaseConnection=No,window.handleAuthError=Oc);const Uo=ao();function jc({children:n}){const[e,t]=U(null),[r,s]=U(null),[i,o]=U(!0);se(()=>{(async()=>{const{data:{session:h}}=await K.auth.getSession();t(h),s(h?.user??null),o(!1)})();const{data:u}=K.auth.onAuthStateChange((h,d)=>{t(d),s(d?.user??null)});return()=>{u.subscription.unsubscribe()}},[]);const a={session:e,user:r,signOut:()=>K.auth.signOut()};return l(Uo.Provider,{value:a,children:!i&&n})}function et(){return lo(Uo)}let Cc=0,gt=null;const Me={success:(n,e={})=>Ht(n,"success",e),error:(n,e={})=>Ht(n,"error",e),info:(n,e={})=>Ht(n,"info",e),warning:(n,e={})=>Ht(n,"warning",e)},Ht=(n,e="info",t={})=>{if(!gt)return;const r=Cc++,s=t.duration||(e==="error"?6e3:4e3),i={id:r,message:n,type:e,duration:s,timestamp:Date.now()};return gt(o=>[...o,i]),setTimeout(()=>{Cn(r)},s),r},Cn=n=>{gt&&gt(e=>e.filter(t=>t.id!==n))},Ic=({position:n="top-center"})=>{const[e,t]=U([]);return se(()=>(gt=t,()=>{gt=null}),[]),e.length===0?null:l("div",{class:`toast-container toast-container--${n}`,children:e.map(r=>l("div",{class:`toast toast--${r.type}`,onClick:()=>Cn(r.id),children:[l("div",{class:"toast__content",children:[r.type==="success"&&l("span",{class:"toast__icon",children:""}),r.type==="error"&&l("span",{class:"toast__icon",children:""}),r.type==="warning"&&l("span",{class:"toast__icon",children:""}),r.type==="info"&&l("span",{class:"toast__icon",children:""}),l("span",{class:"toast__message",children:r.message})]}),l("button",{class:"toast__close",onClick:s=>{s.stopPropagation(),Cn(r.id)},children:""})]},r.id))})},be={DARK:"dark",LIGHT:"light"},Gn=()=>{const n=localStorage.getItem("theme");return n&&Object.values(be).includes(n)?n:window.matchMedia("(prefers-color-scheme: dark)").matches?be.DARK:be.LIGHT},In=n=>{Object.values(be).includes(n)||(console.warn(`Invalid theme: ${n}. Using default dark theme.`),n=be.DARK),n===be.LIGHT?document.documentElement.setAttribute("data-theme","light"):document.documentElement.removeAttribute("data-theme"),localStorage.setItem("theme",n),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:n}}))},xc=()=>{const e=Gn()===be.LIGHT?be.DARK:be.LIGHT;return In(e),e},Nc=()=>{const n=Gn();In(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||In(e.matches?be.DARK:be.LIGHT)})},Uc=()=>{const[n,e]=U(!0);return se(()=>{const r=Gn();e(r===be.DARK);const s=i=>{e(i.detail.theme===be.DARK)};return window.addEventListener("themeChanged",s),()=>{window.removeEventListener("themeChanged",s)}},[]),l("button",{class:`theme-toggle ${n?"dark":"light"}`,onClick:()=>{const r=xc();e(r===be.DARK)},"aria-label":`Switch to ${n?"light":"dark"} mode`,title:`Switch to ${n?"light":"dark"} mode`,children:l("div",{class:"toggle-track",children:l("div",{class:"toggle-thumb",children:l("div",{class:"icon",children:n?l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):l("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l("circle",{cx:"12",cy:"12",r:"5"}),l("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),l("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),l("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),l("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),l("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),l("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),l("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),l("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})})})})},Dc=()=>{const[n,e]=U(""),[t,r]=U(!1),[s,i]=U(!1),{user:o,signOut:a}=et(),c=f=>{f.preventDefault(),n.trim()&&($e(`/search?q=${encodeURIComponent(n.trim())}`),e(""),i(!1))},u=async()=>{await a(),$e("/")},h=()=>{r(!t),i(!1)};return l("header",{children:l("div",{class:"container",children:[l("div",{class:"header-left",children:[l(Ne,{href:"/",class:"logo",children:"FreeStream"}),l("nav",{class:t?"active":"",children:l("ul",{onClick:()=>r(!1),children:[l("li",{children:l(Ne,{activeClassName:"active",href:"/movies",children:"Movies"})}),l("li",{children:l(Ne,{activeClassName:"active",href:"/tv",children:"TV"})}),o?l(ht,{children:[l("li",{children:l(Ne,{activeClassName:"active",href:"/favorites",children:"Favorites"})}),l("li",{children:l(Ne,{activeClassName:"active",href:"/history",children:"History"})})]}):l(ht,{children:[l("li",{children:l("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"Favorites (Login Required)"})}),l("li",{children:l("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"History (Login Required)"})})]})]})})]}),s&&l("div",{class:"mobile-search-overlay",children:l("form",{class:"mobile-search-form",onSubmit:c,children:[l("input",{type:"text",placeholder:"Search movies & TV shows...",value:n,onInput:f=>e(f.target.value),class:"mobile-search-input",autoFocus:!0}),l("button",{type:"submit",class:"mobile-search-submit",children:l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[l("circle",{cx:"11",cy:"11",r:"8"}),l("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})}),l("div",{class:"header-right",children:[l("form",{class:"search-container desktop-only",onSubmit:c,children:l("input",{type:"text",placeholder:"Search...",value:n,onInput:f=>e(f.target.value),class:"glass-light"})}),l("button",{class:"search-toggle mobile-only",onClick:()=>{i(!s),r(!1)},"aria-label":"Toggle search",children:l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[l("circle",{cx:"11",cy:"11",r:"8"}),l("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),l(Uc,{}),l("div",{class:"auth-links",children:o?l(ht,{children:[l("span",{class:"user-email",children:o.email}),l("button",{onClick:u,class:"auth-button",children:"Logout"})]}):l(ht,{children:[l(Ne,{href:"/login",class:"auth-link",children:"Login"}),l(Ne,{href:"/signup",class:"auth-link",children:"Sign Up"})]})})]}),l("button",{class:"hamburger",onClick:h,"aria-label":"Toggle menu",children:[l("span",{class:"bar"}),l("span",{class:"bar"}),l("span",{class:"bar"})]})]})})};var Lc=["className","activeClass","activeClassName","path"];function Be(n){var e=n.className,t=n.activeClass,r=n.activeClassName,s=n.path,i=function(h,d){if(h==null)return{};var f,p,g={},m=Object.keys(h);for(p=0;p<m.length;p++)d.indexOf(f=m[p])>=0||(g[f]=h[f]);return g}(n,Lc),o=_a()[0],a=s&&o.path&&Sn(o.path,s,{})||Sn(o.url,i.href,{}),c=i.class||e||"",u=a&&(t||r)||"";return i.class=c+(c&&u&&" ")+u,Dn(Ne,i)}const qc=()=>l("footer",{class:"app-footer",children:[l("div",{class:"footer-content",children:[l("div",{class:"footer-brand",children:[l(Be,{href:"/",class:"logo",children:"FreeStream"}),l("p",{children:"Your gateway to unlimited entertainment. Built with passion."})]}),l("div",{class:"footer-links",children:[l("div",{class:"footer-section",children:[l("h4",{children:"Platform"}),l("ul",{children:[l("li",{children:l(Be,{href:"/",children:"Home"})}),l("li",{children:l(Be,{href:"/movies",children:"Movies"})}),l("li",{children:l(Be,{href:"/tv",children:"TV Shows"})})]})]}),l("div",{class:"footer-section",children:[l("h4",{children:"Account"}),l("ul",{children:[l("li",{children:l(Be,{href:"/login",children:"Login"})}),l("li",{children:l(Be,{href:"/signup",children:"Sign Up"})}),l("li",{children:l(Be,{href:"/favorites",children:"Favorites"})})]})]}),l("div",{class:"footer-section",children:[l("h4",{children:"Legal"}),l("ul",{children:[l("li",{children:l("a",{href:"#",children:"Terms of Service"})}),l("li",{children:l("a",{href:"#",children:"Privacy Policy"})})]})]})]})]}),l("div",{class:"footer-bottom",children:[l("p",{children:" 2024 FreeStream. All Rights Reserved. Not a real streaming service."}),l("div",{class:"footer-socials",children:[l("a",{href:"#","aria-label":"Github",children:l("i",{class:"fab fa-github"})}),l("a",{href:"#","aria-label":"Twitter",children:l("i",{class:"fab fa-twitter"})})]})]})]}),Vs=n=>{let e;const t=new Set,r=(u,h)=>{const d=typeof u=="function"?u(e):u;if(!Object.is(d,e)){const f=e;e=h??(typeof d!="object"||d===null)?d:Object.assign({},e,d),t.forEach(p=>p(e,f))}},s=()=>e,a={setState:r,getState:s,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u))},c=e=n(r,s,a);return a},Mc=n=>n?Vs(n):Vs,Fc=n=>n;function Bc(n,e=Fc){const t=fs.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return fs.useDebugValue(t),t}const zs=n=>{const e=Mc(n),t=r=>Bc(e,r);return Object.assign(t,e),t},Wc=n=>n?zs(n):zs;function Hc(n,e){let t;try{t=n()}catch{return}return{getItem:s=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),a=(i=t.getItem(s))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(s,i)=>t.setItem(s,JSON.stringify(i,void 0)),removeItem:s=>t.removeItem(s)}}const xn=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(r){return xn(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return xn(r)(t)}}}},Gc=(n,e)=>(t,r,s)=>{let i={storage:Hc(()=>localStorage),partialize:m=>m,version:0,merge:(m,v)=>({...v,...m}),...e},o=!1;const a=new Set,c=new Set;let u=i.storage;if(!u)return n((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...m)},r,s);const h=()=>{const m=i.partialize({...r()});return u.setItem(i.name,{state:m,version:i.version})},d=s.setState;s.setState=(m,v)=>{d(m,v),h()};const f=n((...m)=>{t(...m),h()},r,s);s.getInitialState=()=>f;let p;const g=()=>{var m,v;if(!u)return;o=!1,a.forEach(T=>{var _;return T((_=r())!=null?_:f)});const w=((v=i.onRehydrateStorage)==null?void 0:v.call(i,(m=r())!=null?m:f))||void 0;return xn(u.getItem.bind(u))(i.name).then(T=>{if(T)if(typeof T.version=="number"&&T.version!==i.version){if(i.migrate){const _=i.migrate(T.state,T.version);return _ instanceof Promise?_.then(P=>[!0,P]):[!0,_]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,T.state];return[!1,void 0]}).then(T=>{var _;const[P,E]=T;if(p=i.merge(E,(_=r())!=null?_:f),t(p,!0),P)return h()}).then(()=>{w?.(p,void 0),p=r(),o=!0,c.forEach(T=>T(p))}).catch(T=>{w?.(void 0,T)})};return s.persist={setOptions:m=>{i={...i,...m},m.storage&&(u=m.storage)},clearStorage:()=>{u?.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:m=>(a.add(m),()=>{a.delete(m)}),onFinishHydration:m=>(c.add(m),()=>{c.delete(m)})},i.skipHydration||g(),p||f},Kc=Gc,Nn="https://image.tmdb.org/t/p/w500",Vc=()=>"/api",we=Vc();function Un(n){return n?`${we}/image-proxy?url=${encodeURIComponent(n)}`:""}console.log(` API Base URL: ${we}`);console.log(" Environment: production");const Ue=async()=>{let e=0;for(;e<2;)try{const t=new Promise((o,a)=>setTimeout(()=>a(new Error("Auth timeout")),5e3)),r=K.auth.getSession(),{data:{session:s},error:i}=await Promise.race([r,t]);if(i){if(console.error("Error getting current session:",i),i.message&&i.message.includes("NetworkError")&&e<1){e++,console.log(`Retrying auth session (attempt ${e+1}/2)`),await new Promise(o=>setTimeout(o,500*e));continue}return null}return s?.user?.id||null}catch(t){if(console.error("Error in getCurrentUserId:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<1){e++,console.log(`Retrying auth due to network error (attempt ${e+1}/2)`),await new Promise(r=>setTimeout(r,500*e));continue}return null}return console.error("Failed to get user session after all retry attempts"),null},zc=async()=>{let e=0;for(;e<3;)try{const t=await Ue();if(!t)return console.log("No authenticated user, returning empty watch history"),[];const r=new Promise((a,c)=>setTimeout(()=>c(new Error("Request timeout")),1e4)),s=K.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),{data:i,error:o}=await Promise.race([s,r]);if(o){if(console.error("Error fetching watch history:",o),o.message&&o.message.includes("NetworkError")&&e<2){e++,console.log(`Retrying watch history fetch (attempt ${e+1}/3)`),await new Promise(a=>setTimeout(a,1e3*e));continue}return[]}return i||[]}catch(t){if(console.error("Error in getWatchHistory:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying watch history fetch due to network error (attempt ${e+1}/3)`),await new Promise(r=>setTimeout(r,1e3*e));continue}return[]}return console.error("Failed to fetch watch history after all retry attempts"),[]},dr=async(n,e,t,r)=>{try{const s=await Ue();if(!s)return console.log("No authenticated user, returning null progress"),null;let i=K.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",s).eq("media_id",n).eq("media_type",e);e!=="movie"&&(i=i.eq("season_number",t).eq("episode_number",r));const{data:o,error:a}=await i;return a?(console.error("Error fetching watch progress:",a),null):o&&o.length>0?o[0]:null}catch(s){return console.error("Error in getWatchProgressForMedia:",s),null}},Jc=async()=>{try{const n=await Ue();if(!n)return console.log("No authenticated user, returning empty continue watching list"),[];console.log(" Fetching continue watching from watch_history...");const{data:e,error:t}=await K.from("watch_history").select("media_id, media_type, season_number, episode_number, watched_at").eq("user_id",n).order("watched_at",{ascending:!1});if(t)return console.error("Error fetching watch history for continue watching:",t),[];if(!e||e.length===0)return console.log(" No watch history found"),[];console.log(` Found ${e.length} watch history entries`);const r=new Map;e.forEach(u=>{const h=u.media_id;r.has(h)||r.set(h,[]),r.get(h).push(u)});const s=[];for(const[u,h]of r){const f=h.sort((p,g)=>p.media_type==="movie"?new Date(g.watched_at)-new Date(p.watched_at):p.season_number!==g.season_number?(g.season_number||0)-(p.season_number||0):(g.episode_number||0)-(p.episode_number||0))[0];console.log(` Most advanced for media ${u}: S${f.season_number}E${f.episode_number} (${f.media_type})`),s.push(f)}const o=(await Promise.all(s.map(async u=>{try{let h=K.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",n).eq("media_id",u.media_id).eq("media_type",u.media_type);u.media_type!=="movie"&&(h=h.eq("season_number",u.season_number).eq("episode_number",u.episode_number));const{data:d,error:f}=await h;if(f)return console.error(`Error fetching progress for ${u.media_id}:`,f),null;const p=d&&d.length>0?d[0]:null,g=p&&p.progress_seconds>30,m=new Date(u.watched_at)>new Date(Date.now()-7*24*60*60*1e3);if(g||m){if(p&&p.duration_seconds>0&&p.progress_seconds/p.duration_seconds>=.9){if(u.media_type!=="movie"){const w=await Do(u.media_id,u.season_number,u.episode_number,u.media_type);if(w)return console.log(` Episode completed, suggesting next: S${w.season}E${w.episode}`),{...u,season_number:w.season,episode_number:w.episode,progress_seconds:0,duration_seconds:null,updated_at:p.updated_at}}return null}return{...u,progress_seconds:p?.progress_seconds||0,duration_seconds:p?.duration_seconds||null,updated_at:p?.updated_at||u.watched_at}}return null}catch(h){return console.error(`Error processing continue watching entry for ${u.media_id}:`,h),null}}))).filter(Boolean).sort((u,h)=>new Date(h.updated_at)-new Date(u.updated_at));console.log(` Found ${o.length} valid continue watching entries`);const c=(await Promise.all(o.map(async u=>{try{const h=await fetch(`${we}/tmdb/${u.media_type}/${u.media_id}`);return h.ok?{...await h.json(),type:u.media_type,progress_seconds:u.progress_seconds,duration_seconds:u.duration_seconds,season_number:u.season_number,episode_number:u.episode_number,updated_at:u.updated_at,media_id:u.media_id}:null}catch(h){return console.error("Error fetching TMDB details for continue watching item:",h),null}}))).filter(Boolean);return console.log(` Returning ${c.length} continue watching items`),c}catch(n){return console.error("Error in getContinueWatching:",n),[]}},Js=async(n,e,t,r=!1)=>{const s=await Ue();if(!s)return console.error(" Cannot save watch progress: No authenticated user"),!1;if(!n||typeof e>"u"||e<0)return console.error(" Invalid progress data:",{item:n,progress:e,durationInSeconds:t}),!1;const i={p_media_id:n.id,p_media_type:n.type,p_season_number:n.season||null,p_episode_number:n.episode||null,p_progress_seconds:e>0?Math.ceil(e):0,p_duration_seconds:t?Math.round(t):null,p_force_history_entry:r};console.log(" Saving watch progress (v2)...",i);const{error:o}=await K.rpc("save_watch_progress",i);if(!o)return console.log(" Watch progress saved successfully via RPC (v2)"),!0;console.warn(` RPC (v2) failed, trying legacy (v1). Error: ${o.message}`);const{p_force_history_entry:a,...c}=i,{error:u}=await K.rpc("save_watch_progress",c);if(!u)return console.log(" Watch progress saved successfully via RPC (v1)"),!0;console.warn(` RPC (v1) also failed, attempting direct DB write. Error: ${u.message}`);try{if(await Yc(s,n,e,t,r))return!0}catch(h){console.error(" Direct DB write fallback threw an exception:",h)}return console.error(" All methods to save progress failed."),!1},Yc=async(n,e,t,r,s)=>{try{console.log(" Using direct database fallback for watch progress");const{error:i}=await K.from("watch_progress").upsert({user_id:n,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,progress_seconds:t>0?Math.ceil(t):0,duration_seconds:r?Math.round(r):null,updated_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});if(i)return console.error(" Direct progress insert error:",i),!1;if(s||t>60){const{error:o}=await K.from("watch_history").upsert({user_id:n,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});o&&console.error(" Direct history insert error:",o)}return console.log(" Watch progress saved via direct database fallback"),!0}catch(i){return console.error(" Direct database fallback failed:",i),!1}},Qc=async n=>{try{const e=await Ue();if(!e){console.log("Cannot add watch history entry: No authenticated user");return}if(!n)return;const{error:t}=await K.from("watch_history").upsert({user_id:e,media_id:n.id,media_type:n.type,season_number:n.season||null,episode_number:n.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});t&&console.error("Error adding watch history entry:",t)}catch(e){console.error("Unexpected error adding watch history entry:",e)}},Xc=async n=>{try{if(!n)return;if(!await Ue()){console.log("Cannot delete watch item: No authenticated user");return}const{error:t}=await K.rpc("delete_watch_item",{p_media_id:n.media_id,p_media_type:n.media_type,p_season_number:n.season_number,p_episode_number:n.episode_number});t&&console.error("Error deleting watch item:",t)}catch(e){console.error("Error in deleteWatchItem:",e)}},Zc=async n=>{try{const e=await Ue();if(!e)return[];const{data:t,error:r}=await K.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n);return r?(console.error("Error fetching series history:",r),[]):t||[]}catch(e){return console.error("Error in getSeriesHistory:",e),[]}},Do=async(n,e,t,r="tv")=>{try{const s=r==="anime"?"tv":r,i=await fetch(`${we}/tmdb/${s}/${n}`);if(!i.ok)return console.error(`Failed to fetch series details: ${i.status}`),null;const o=await i.json();if(!o.seasons||o.seasons.length===0)return console.error("No seasons found in series details"),null;const a=await fetch(`${we}/tmdb/${s}/${n}/season/${e}`);if(!a.ok)return console.error(`Failed to fetch season ${e} details: ${a.status}`),null;const c=await a.json();if(!c.episodes||c.episodes.length===0)return console.error(`No episodes found in season ${e}`),null;const u=c.episodes.length;if(console.log(`Current season ${e} has ${u} episodes, current episode: ${t}`),t<u)return console.log(`Next episode: S${e}E${t+1}`),{season:e,episode:t+1};const d=o.seasons.filter(f=>f.season_number>0).find(f=>f.season_number===e+1);return d&&d.episode_count>0?(console.log(`Next season found: S${d.season_number}E1`),{season:d.season_number,episode:1}):(console.log("No next episode available - series may be completed"),null)}catch(s){return console.error("Error getting next episode:",s),null}},eu=async n=>{try{const e=await Ue();if(!e)return console.log("No authenticated user, returning null for last watched episode with progress"),null;console.log(` [CW] Looking for last watched episode for series ${n}`);const{data:t,error:r}=await K.from("watch_history").select("season_number, episode_number, watched_at, media_type").eq("user_id",e).eq("media_id",n).order("watched_at",{ascending:!1}).limit(1);if(r)return console.error(" [CW] Error fetching watch history:",r),null;if(!t||t.length===0)return console.log(" [CW] No episodes found in watch history for this series."),null;const s=t[0];console.log(` [CW] Most recent interaction: S${s.season_number}E${s.episode_number} (at ${s.watched_at})`);const{data:i,error:o}=await K.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n).eq("season_number",s.season_number).eq("episode_number",s.episode_number).limit(1);if(o)return console.error(" [CW] Error fetching progress data:",o),{season:s.season_number,episode:s.episode_number};const a=i&&i.length>0?i[0]:null;if(a&&a.duration_seconds>0){const c=a.progress_seconds/a.duration_seconds,u=a.duration_seconds-a.progress_seconds,f=c>=.9&&u<=60;if(console.log(` [CW] Progress: ${(c*100).toFixed(1)}%, Time left: ${u}s - ${f?"COMPLETED":"INCOMPLETE"}`),f){console.log(` [CW] Episode S${s.season_number}E${s.episode_number} is completed. Finding next...`);const p=await Do(n,s.season_number,s.episode_number,s.media_type);return p?(console.log(` [CW] Next episode is S${p.season}E${p.episode}.`),p):(console.log(' [CW] Series finished. No "continue watching" target.'),null)}else return console.log(` [CW] Resuming incomplete episode S${s.season_number}E${s.episode_number}.`),{season:s.season_number,episode:s.episode_number}}else return console.log(` [CW] No meaningful progress found. Suggesting last touched episode: S${s.season_number}E${s.episode_number}`),{season:s.season_number,episode:s.episode_number}}catch(e){return console.error(" [CW] Unexpected error in getLastWatchedEpisodeWithProgress:",e),null}},Lo=async n=>{try{const e=await Ue();if(!e||!n||n.length===0)return{};const t={};return await Promise.all(n.map(async r=>{try{let s=K.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",r.media_id).eq("media_type",r.media_type);r.media_type==="tv"&&(r.season_number!=null&&(s=s.eq("season_number",r.season_number)),r.episode_number!=null&&(s=s.eq("episode_number",r.episode_number)));const{data:i,error:o}=await s;if(o)console.error(`Error fetching progress for ${r.media_type} ${r.media_id}:`,o);else if(i&&i.length>0){const a=i[0],c=`${r.media_id}-${r.media_type}-${r.season_number||0}-${r.episode_number||0}`;a.progress_seconds>=0&&a.duration_seconds>0&&(t[c]={progress_seconds:a.progress_seconds,duration_seconds:a.duration_seconds})}}catch(s){console.error(`Error fetching progress for item ${r.media_id}:`,s)}})),t}catch(e){return console.error("Error in getProgressForHistoryItems:",e),{}}},tu=async()=>{let e=0;for(;e<3;)try{const t=await Ue();if(!t)return console.log("No authenticated user, returning empty watch history with progress"),[];console.log(" Fetching combined watch history and progress data...");const[r,s]=await Promise.all([K.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),K.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",t)]);if(r.error)throw r.error;s.error&&console.warn("Error fetching progress data, continuing without progress:",s.error);const i=r.data||[],o=s.data||[],a={};o.forEach(u=>{const h=`${u.media_id}-${u.media_type}-${u.season_number||0}-${u.episode_number||0}`;a[h]=u});const c=i.map(u=>{const h=`${u.media_id}-${u.media_type}-${u.season_number||0}-${u.episode_number||0}`,d=a[h];return{...u,progress_seconds:d?.progress_seconds||null,duration_seconds:d?.duration_seconds||null}});return console.log(" Successfully fetched combined data:",{totalItems:c.length,itemsWithProgress:c.filter(u=>u.progress_seconds>0).length}),c}catch(t){if(console.error("Error in getWatchHistoryWithProgress:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying combined fetch due to network error (attempt ${e+1}/3)`),await new Promise(r=>setTimeout(r,1e3*e));continue}try{console.log(" All retries failed, trying fallback approach...");const r=await zc(),s=await Lo(r);return r.map(i=>{const o=`${i.media_id}-${i.media_type}-${i.season_number||0}-${i.episode_number||0}`,a=s[o];return{...i,progress_seconds:a?.progress_seconds||null,duration_seconds:a?.duration_seconds||null}})}catch(r){return console.error("Fallback approach also failed:",r),[]}}return console.error("Failed to fetch combined watch history and progress after all retry attempts"),[]},Je=async(n,e=3)=>{let t=[];for(let r=1;r<=e;r++)try{const s=await fetch(`${n}?page=${r}`);if(s.ok){const i=await s.json();t=[...t,...i.results||[]]}}catch(s){console.error(`Error fetching page ${r} from ${n}:`,s)}return t},vt=Wc(Kc((n,e)=>({trending:[],popularMovies:[],popularTv:[],topRatedMovies:[],topRatedTv:[],upcomingMovies:[],nowPlayingMovies:[],airingTodayTv:[],favorites:[],favoritesFetched:!1,currentMediaItem:null,continueWatching:[],continueWatchingFetched:!1,fetchContinueWatching:async()=>{const{data:{user:t}}=await K.auth.getUser();if(!t){n({continueWatching:[],continueWatchingFetched:!0});return}const r=await Jc();if(!r||r.length===0){n({continueWatching:[],continueWatchingFetched:!0});return}const s=r.reduce((i,o)=>(i.some(a=>a.media_id===o.media_id)||i.push(o),i),[]);n({continueWatching:s,continueWatchingFetched:!0})},removeContinueWatchingItem:t=>{n(r=>({continueWatching:r.continueWatching.filter(s=>s.media_id!==t)}))},setCurrentMediaItem:t=>n({currentMediaItem:t}),fetchTrending:async()=>{if(!(e().trending.length>0))try{const t=await fetch("/api/tmdb/trending/all/week");if(t.ok){const r=await t.json();n({trending:r.results||[]})}}catch(t){console.error("Error fetching trending:",t)}},fetchPopularMovies:async()=>{if(e().popularMovies.length>0)return;const t=await Je("/api/tmdb/movie/popular");n({popularMovies:t})},fetchPopularTv:async()=>{if(e().popularTv.length>0)return;const t=await Je("/api/tmdb/tv/popular");n({popularTv:t})},fetchTopRatedMovies:async()=>{if(e().topRatedMovies.length>0)return;const t=await Je("/api/tmdb/movie/top_rated");n({topRatedMovies:t})},fetchTopRatedTv:async()=>{if(e().topRatedTv.length>0)return;const t=await Je("/api/tmdb/tv/top_rated");n({topRatedTv:t})},fetchUpcomingMovies:async()=>{if(e().upcomingMovies.length>0)return;const t=await Je("/api/tmdb/movie/upcoming");n({upcomingMovies:t})},fetchNowPlayingMovies:async()=>{if(e().nowPlayingMovies.length>0)return;const t=await Je("/api/tmdb/movie/now_playing");n({nowPlayingMovies:t})},fetchAiringTodayTv:async()=>{if(e().airingTodayTv.length>0)return;const t=await Je("/api/tmdb/tv/airing_today");n({airingTodayTv:t})},fetchFavorites:async()=>{const{data:{user:t}}=await K.auth.getUser();if(!t){n({favorites:[],favoritesFetched:!0});return}const{data:r,error:s}=await K.from("favorites").select("media_id, media_type, season_number, episode_number, episode_name").eq("user_id",t.id);if(s){console.error("Error fetching favorites:",s),n({favoritesFetched:!0});return}const i=await Promise.all(r.map(async o=>{const a=await fetch(`/api/tmdb/${o.media_type}/${o.media_id}`);if(a.ok){const c=await a.json();if(o.media_type==="tv"&&o.season_number&&o.episode_number){try{const u=await fetch(`/api/tmdb/tv/${o.media_id}/season/${o.season_number}/episode/${o.episode_number}`);if(u.ok){const h=await u.json();return{...c,type:o.media_type,season_number:o.season_number,episode_number:o.episode_number,episode_name:h.name||o.episode_name,still_path:h.still_path,vote_average:h.vote_average||c.vote_average,overview:h.overview||c.overview}}}catch(u){console.error("Error fetching episode details:",u)}return{...c,type:o.media_type,season_number:o.season_number,episode_number:o.episode_number,episode_name:o.episode_name}}return{...c,type:o.media_type}}return null}));n({favorites:i.filter(Boolean),favoritesFetched:!0})},addFavorite:async t=>{const{data:{user:r}}=await K.auth.getUser();if(!r)return;n(o=>({favorites:[t,...o.favorites]}));const s={user_id:r.id,media_id:t.id,media_type:t.type};t.type==="tv"&&t.season_number&&t.episode_number&&(s.season_number=t.season_number,s.episode_number=t.episode_number,s.episode_name=t.episode_name);const{error:i}=await K.from("favorites").insert(s);i&&(console.error("Error adding favorite:",i),n(o=>({favorites:o.favorites.filter(a=>a.id!==t.id||a.season_number!==t.season_number||a.episode_number!==t.episode_number)})))},removeFavorite:async(t,r=null,s=null)=>{const{data:{user:i}}=await K.auth.getUser();if(!i)return;const o=e().favorites;n(u=>({favorites:u.favorites.filter(h=>!(h.id===t&&h.season_number===r&&h.episode_number===s))}));const a=K.from("favorites").delete().match({user_id:i.id,media_id:t});r!==null&&s!==null?a.match({season_number:r,episode_number:s}):a.is("season_number",null).is("episode_number",null);const{error:c}=await a;c&&(console.error("Error removing favorite:",c),n({favorites:o}))},isFavorited:(t,r=null,s=null)=>{const{favorites:i,favoritesFetched:o}=e();return o?i.some(a=>a.id===t&&a.season_number===r&&a.episode_number===s):!1}}),{name:"freestream-storage",storage:localStorage,partialize:n=>({favorites:n.favorites,trending:n.trending,popularMovies:n.popularMovies,popularTv:n.popularTv,topRatedMovies:n.topRatedMovies,topRatedTv:n.topRatedTv,upcomingMovies:n.upcomingMovies,nowPlayingMovies:n.nowPlayingMovies,airingTodayTv:n.airingTodayTv,continueWatching:n.continueWatching})})),mt=({item:n,type:e,progress:t,duration:r,showDeleteButton:s,onDelete:i})=>{const{id:o,title:a,name:c,poster_path:u,still_path:h,vote_average:d,episode_name:f,season_number:p,episode_number:g,first_air_date:m,release_date:v,number_of_seasons:w}=n,T=h||u,_=c||a,P=t&&r>0?t/r*100:0,E=v||m?new Date(v||m).getFullYear():null,{addFavorite:x,removeFavorite:L,isFavorited:$}=vt(),B=$(n.id,n.season_number,n.episode_number),X=te=>{te.preventDefault(),te.stopPropagation(),B?L(n.id,n.season_number,n.episode_number):x({...n,type:e})};let G=`/watch/${e}/${n.id}`;e==="tv"&&n.season_number&&n.episode_number&&(G+=`/season/${n.season_number}/episode/${n.episode_number}`);const ae=e==="tv"&&p&&g?`S${p} E${g}${f?`: ${f}`:""}`:e==="tv"&&w?`${E||"Unknown"}  ${w} Season${w!==1?"s":""}`:e==="movie"&&E?E.toString():null;return l("div",{className:"movie-card-container",children:l(Be,{href:G,className:"movie-card",children:l("div",{className:"poster-wrapper",children:[l("img",{src:Un(T?`${Nn}${T}`:"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image"),alt:_,loading:"lazy"}),l("div",{className:"scrim"}),P>.01&&l("div",{className:"progress-bar-container",children:l("div",{className:"progress-bar",style:{width:`${Math.min(P,100)}%`}})}),l("div",{className:"card-info",children:[l("div",{className:"title-row",children:[l("h3",{className:"card-title",children:_}),l("button",{className:`favorite-btn ${B?"favorited":""}`,onClick:X,children:B?"":""})]}),ae&&l("p",{className:"card-subtitle",children:ae}),l("span",{className:"rating",children:[" ",d?d.toFixed(1):"N/A"]})]}),s&&l("button",{className:"delete-btn",onClick:te=>{te.preventDefault(),te.stopPropagation(),i&&i(n)},children:""})]})})})},ru=()=>l("div",{class:"features-showcase",children:[l("div",{class:"features-hero",children:l("div",{class:"features-hero-content",children:[l("h2",{class:"features-title",children:l("span",{class:"gradient-text",children:"Sign in for the full experience"})}),l("p",{class:"features-subtitle",children:"Get personalized recommendations, track your progress, and never lose your place"})]})}),l("div",{class:"features-grid",children:[{icon:"",title:"Continue Watching",description:"Pick up exactly where you left off across all your devices. Never lose your place again.",highlight:!0},{icon:"",title:"Favorites Collection",description:"Save your favorite movies and TV shows in one place for quick access anytime.",highlight:!1},{icon:"",title:"Watch History",description:"Keep track of everything you've watched and easily find content you enjoyed.",highlight:!1},{icon:"",title:"Personal Progress",description:"Sync your watch progress across devices and resume on any screen seamlessly.",highlight:!1},{icon:"",title:"Smart Recommendations",description:"Get personalized suggestions based on your viewing history and preferences.",highlight:!1},{icon:"",title:"Enhanced Experience",description:"Unlock the full potential of FreeStream with user-specific features and settings.",highlight:!1}].map((e,t)=>l("div",{class:`feature-card ${e.highlight?"featured":""}`,children:[l("div",{class:"feature-icon",children:e.icon}),l("h3",{class:"feature-title",children:e.title}),l("p",{class:"feature-description",children:e.description})]},t))}),l("div",{class:"features-footer",children:[l("div",{class:"features-stats",children:[l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"10K+"}),l("span",{class:"stat-label",children:"Movies & Shows"})]}),l("div",{class:"stat",children:[l("span",{class:"stat-number",children:"4K"}),l("span",{class:"stat-label",children:"Ultra HD Quality"})]}),l("div",{class:"stat",children:[l("span",{class:"stat-number",children:""}),l("span",{class:"stat-label",children:"Unlimited Access"})]})]}),l("p",{class:"features-note",children:[l(Ne,{href:"/login",class:"subtle-link",children:"Sign in"})," or ",l(Ne,{href:"/signup",class:"subtle-link",children:"create an account"})," to unlock these features"]})]})]}),qo=({size:n="medium",text:e="Loading..."})=>{const t={small:"spinner-small",medium:"spinner-medium",large:"spinner-large"}[n];return l("div",{class:"loading-container",children:[l("div",{class:`loading-spinner ${t}`,children:[l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"}),l("div",{class:"spinner-ring"})]}),e&&l("p",{class:"loading-text",children:e})]})},nu=()=>{const{user:n}=et();if(!n)return null;const e=()=>{const r=new Date().getHours();return r<12?"Good morning":r<17?"Good afternoon":"Good evening"},t=()=>n.user_metadata?.full_name?n.user_metadata.full_name.split(" ")[0]:n.email.split("@")[0];return l("div",{class:"welcome-message",children:[l("div",{class:"welcome-content",children:[l("h2",{class:"welcome-title",children:[e(),", ",l("span",{class:"user-name",children:t()}),"!"]}),l("p",{class:"welcome-subtitle",children:"What would you like to watch today?"})]}),l("div",{class:"welcome-stats",children:[l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:""}),l("span",{class:"stat-text",children:"Unlimited Movies"})]}),l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:""}),l("span",{class:"stat-text",children:"TV Shows"})]}),l("div",{class:"stat-item",children:[l("span",{class:"stat-icon",children:""}),l("span",{class:"stat-text",children:"HD Streaming"})]})]})]})},hr=n=>{const{trending:e,popularMovies:t,popularTv:r,topRatedMovies:s,topRatedTv:i,upcomingMovies:o,nowPlayingMovies:a,airingTodayTv:c,fetchTrending:u,fetchPopularMovies:h,fetchPopularTv:d,fetchTopRatedMovies:f,fetchTopRatedTv:p,fetchUpcomingMovies:g,fetchNowPlayingMovies:m,fetchAiringTodayTv:v,continueWatching:w,continueWatchingFetched:T,fetchContinueWatching:_}=vt(),{user:P}=et(),[E,x]=U("all");se(()=>{n.path==="/movies"?x("movie"):n.path==="/tv"?x("tv"):x("all")},[n.path]),se(()=>{u(),h(),d(),f(),p(),g(),m(),v()},[u,h,d,f,p,g,m,v]),se(()=>{P&&!T&&_()},[P,T,_]);const L=($,B,X)=>!B||B.length===0?null:l("section",{class:"home-section",children:[l("h2",{children:$}),l("div",{class:"scrolling-row",children:B.map(G=>l(mt,{item:G,type:X||G.media_type},`${$}-${G.id}`))})]});return l("div",{class:"container home-page",children:[l("h1",{class:"main-title",children:[E==="movie"&&"Movies",E==="tv"&&"TV Shows",E==="all"&&"Discover"]}),!P&&E==="all"&&l(ht,{children:[l("div",{class:"guest-info-banner",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"16px",marginBottom:"24px",textAlign:"center"},children:[l("h3",{style:{margin:"0 0 8px 0",color:"var(--text-primary)"},children:" Start Streaming Instantly"}),l("p",{style:{margin:"0",color:"var(--text-secondary)"},children:["No account required! Click any movie or TV show to start watching immediately.",l("a",{href:"/login",style:{color:"var(--accent-color)",textDecoration:"none",marginLeft:"4px"},children:"Sign up"})," to save favorites, track progress, and continue watching across devices."]})]}),l(ru,{})]}),P&&E==="all"&&l(nu,{}),T?w.length>0&&l("section",{class:"home-section",children:[l("h2",{children:"Continue Watching"}),l("div",{class:"scrolling-row scrolling-row--compact",children:w.map($=>l(mt,{item:$,type:$.type,progress:$.progress_seconds,duration:$.duration_seconds},`continue-watching-${$.type}-${$.id}`))})]}):l(qo,{text:"Loading your continue watching..."}),E==="all"&&L("Trending This Week",e,"movie"),E!=="tv"&&L("Popular Movies",t,"movie"),E!=="tv"&&L("Now Playing Movies",a,"movie"),E!=="movie"&&L("Popular TV Shows",r,"tv"),(E==="all"||E==="movie")&&L("Top Rated Movies",s,"movie"),(E==="all"||E==="movie")&&L("Upcoming Movies",o,"movie"),(E==="all"||E==="tv")&&L("Top Rated TV Shows",i,"tv"),(E==="all"||E==="tv")&&L("Airing Today",c,"tv")]})};var Gt={exports:{}};const Mo=go(ca);var fr,Ys;function su(){if(Ys)return fr;Ys=1;var n=Mo;function e(i,o){var a={};for(var c in i)o.indexOf(c)>=0||Object.prototype.hasOwnProperty.call(i,c)&&(a[c]=i[c]);return a}function t(i,o){if(!(i instanceof o))throw new TypeError("Cannot call a class as a function")}function r(i,o){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&(typeof o=="object"||typeof o=="function")?o:i}function s(i,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof o);i.prototype=Object.create(o&&o.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(i,o):i.__proto__=o)}return fr=function(o,a,c){if(typeof o!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof a!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof c<"u"&&typeof c!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function u(d){return d.displayName||d.name||"Component"}return function(f){if(typeof f!="function")throw new Error("Expected WrappedComponent to be a React component.");var p=[],g=void 0;function m(){g=o(p.map(function(w){return w.props})),v.canUseDOM?a(g):c&&(g=c(g))}var v=function(w){s(T,w);function T(){return t(this,T),r(this,w.apply(this,arguments))}return T.peek=function(){return g},T.rewind=function(){if(T.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var P=g;return g=void 0,p=[],P},T.prototype.shouldComponentUpdate=function(P){var E=P.children,x=e(P,["children"]);return E&&E.length&&(x.children=E),h(x,this.props)},T.prototype.componentWillMount=function(){p.push(this),m()},T.prototype.componentDidUpdate=function(){m()},T.prototype.componentWillUnmount=function(){var P=p.indexOf(this);p.splice(P,1),m()},T.prototype.render=function(){return(0,n.h)(f,this.props)},T}(n.Component);return v.displayName="SideEffect("+u(f)+")",v.canUseDOM=!!(typeof window<"u"&&window.document&&window.document.createElement),v};function h(d,f){for(var p in d)if(!(p in f))return!0;for(var g in f)if(d[g]!==f[g])return!0;return!1}},fr}var pr,Qs;function Fo(){if(Qs)return pr;Qs=1;var n=Object.prototype.toString;return pr=function(t){var r=n.call(t),s=r==="[object Arguments]";return s||(s=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&n.call(t.callee)==="[object Function]"),s},pr}var gr,Xs;function iu(){if(Xs)return gr;Xs=1;var n;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,r=Fo(),s=Object.prototype.propertyIsEnumerable,i=!s.call({toString:null},"toString"),o=s.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(f){var p=f.constructor;return p&&p.prototype===f},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if(typeof window>"u")return!1;for(var f in window)try{if(!u["$"+f]&&e.call(window,f)&&window[f]!==null&&typeof window[f]=="object")try{c(window[f])}catch{return!0}}catch{return!0}return!1}(),d=function(f){if(typeof window>"u"||!h)return c(f);try{return c(f)}catch{return!1}};n=function(p){var g=p!==null&&typeof p=="object",m=t.call(p)==="[object Function]",v=r(p),w=g&&t.call(p)==="[object String]",T=[];if(!g&&!m&&!v)throw new TypeError("Object.keys called on a non-object");var _=o&&m;if(w&&p.length>0&&!e.call(p,0))for(var P=0;P<p.length;++P)T.push(String(P));if(v&&p.length>0)for(var E=0;E<p.length;++E)T.push(String(E));else for(var x in p)!(_&&x==="prototype")&&e.call(p,x)&&T.push(String(x));if(i)for(var L=d(p),$=0;$<a.length;++$)!(L&&a[$]==="constructor")&&e.call(p,a[$])&&T.push(a[$]);return T}}return gr=n,gr}var vr,Zs;function Bo(){if(Zs)return vr;Zs=1;var n=Array.prototype.slice,e=Fo(),t=Object.keys,r=t?function(o){return t(o)}:iu(),s=Object.keys;return r.shim=function(){if(Object.keys){var o=function(){var a=Object.keys(arguments);return a&&a.length===arguments.length}(1,2);o||(Object.keys=function(c){return e(c)?s(n.call(c)):s(c)})}else Object.keys=r;return Object.keys||r},vr=r,vr}var mr,ei;function Wo(){return ei||(ei=1,mr=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;e[t]=s;for(var i in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==s||a.enumerable!==!0)return!1}return!0}),mr}var yr,ti;function Kn(){if(ti)return yr;ti=1;var n=Wo();return yr=function(){return n()&&!!Symbol.toStringTag},yr}var _r,ri;function Ho(){return ri||(ri=1,_r=Object),_r}var wr,ni;function Go(){return ni||(ni=1,wr=Error),wr}var br,si;function ou(){return si||(si=1,br=EvalError),br}var Sr,ii;function au(){return ii||(ii=1,Sr=RangeError),Sr}var Er,oi;function lu(){return oi||(oi=1,Er=ReferenceError),Er}var Tr,ai;function Ko(){return ai||(ai=1,Tr=SyntaxError),Tr}var Pr,li;function _t(){return li||(li=1,Pr=TypeError),Pr}var kr,ci;function cu(){return ci||(ci=1,kr=URIError),kr}var Ar,ui;function uu(){return ui||(ui=1,Ar=Math.abs),Ar}var $r,di;function du(){return di||(di=1,$r=Math.floor),$r}var Rr,hi;function hu(){return hi||(hi=1,Rr=Math.max),Rr}var Or,fi;function fu(){return fi||(fi=1,Or=Math.min),Or}var jr,pi;function pu(){return pi||(pi=1,jr=Math.pow),jr}var Cr,gi;function gu(){return gi||(gi=1,Cr=Math.round),Cr}var Ir,vi;function vu(){return vi||(vi=1,Ir=Number.isNaN||function(e){return e!==e}),Ir}var xr,mi;function mu(){if(mi)return xr;mi=1;var n=vu();return xr=function(t){return n(t)||t===0?t:t<0?-1:1},xr}var Nr,yi;function yu(){return yi||(yi=1,Nr=Object.getOwnPropertyDescriptor),Nr}var Ur,_i;function wt(){if(_i)return Ur;_i=1;var n=yu();if(n)try{n([],"length")}catch{n=null}return Ur=n,Ur}var Dr,wi;function Qt(){if(wi)return Dr;wi=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return Dr=n,Dr}var Lr,bi;function _u(){if(bi)return Lr;bi=1;var n=typeof Symbol<"u"&&Symbol,e=Wo();return Lr=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Lr}var qr,Si;function Vo(){return Si||(Si=1,qr=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),qr}var Mr,Ei;function zo(){if(Ei)return Mr;Ei=1;var n=Ho();return Mr=n.getPrototypeOf||null,Mr}var Fr,Ti;function wu(){if(Ti)return Fr;Ti=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",s=function(c,u){for(var h=[],d=0;d<c.length;d+=1)h[d]=c[d];for(var f=0;f<u.length;f+=1)h[f+c.length]=u[f];return h},i=function(c,u){for(var h=[],d=u,f=0;d<c.length;d+=1,f+=1)h[f]=c[d];return h},o=function(a,c){for(var u="",h=0;h<a.length;h+=1)u+=a[h],h+1<a.length&&(u+=c);return u};return Fr=function(c){var u=this;if(typeof u!="function"||e.apply(u)!==r)throw new TypeError(n+u);for(var h=i(arguments,1),d,f=function(){if(this instanceof d){var w=u.apply(this,s(h,arguments));return Object(w)===w?w:this}return u.apply(c,s(h,arguments))},p=t(0,u.length-h.length),g=[],m=0;m<p;m++)g[m]="$"+m;if(d=Function("binder","return function ("+o(g,",")+"){ return binder.apply(this,arguments); }")(f),u.prototype){var v=function(){};v.prototype=u.prototype,d.prototype=new v,v.prototype=null}return d},Fr}var Br,Pi;function Ut(){if(Pi)return Br;Pi=1;var n=wu();return Br=Function.prototype.bind||n,Br}var Wr,ki;function Vn(){return ki||(ki=1,Wr=Function.prototype.call),Wr}var Hr,Ai;function zn(){return Ai||(Ai=1,Hr=Function.prototype.apply),Hr}var Gr,$i;function bu(){return $i||($i=1,Gr=typeof Reflect<"u"&&Reflect&&Reflect.apply),Gr}var Kr,Ri;function Jo(){if(Ri)return Kr;Ri=1;var n=Ut(),e=zn(),t=Vn(),r=bu();return Kr=r||n.call(t,e),Kr}var Vr,Oi;function Jn(){if(Oi)return Vr;Oi=1;var n=Ut(),e=_t(),t=Vn(),r=Jo();return Vr=function(i){if(i.length<1||typeof i[0]!="function")throw new e("a function is required");return r(n,t,i)},Vr}var zr,ji;function Su(){if(ji)return zr;ji=1;var n=Jn(),e=wt(),t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),s=Object,i=s.getPrototypeOf;return zr=r&&typeof r.get=="function"?n([r.get]):typeof i=="function"?function(a){return i(a==null?a:s(a))}:!1,zr}var Jr,Ci;function Yo(){if(Ci)return Jr;Ci=1;var n=Vo(),e=zo(),t=Su();return Jr=n?function(s){return n(s)}:e?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return e(s)}:t?function(s){return t(s)}:null,Jr}var Yr,Ii;function Qo(){if(Ii)return Yr;Ii=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Ut();return Yr=t.call(n,e),Yr}var Qr,xi;function Xo(){if(xi)return Qr;xi=1;var n,e=Ho(),t=Go(),r=ou(),s=au(),i=lu(),o=Ko(),a=_t(),c=cu(),u=uu(),h=du(),d=hu(),f=fu(),p=pu(),g=gu(),m=mu(),v=Function,w=function(N){try{return v('"use strict"; return ('+N+").constructor;")()}catch{}},T=wt(),_=Qt(),P=function(){throw new a},E=T?function(){try{return arguments.callee,P}catch{try{return T(arguments,"callee").get}catch{return P}}}():P,x=_u()(),L=Yo(),$=zo(),B=Vo(),X=zn(),G=Vn(),Z={},ae=typeof Uint8Array>"u"||!L?n:L(Uint8Array),te={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":x&&L?L([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":Z,"%AsyncGenerator%":Z,"%AsyncGeneratorFunction%":Z,"%AsyncIteratorPrototype%":Z,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":v,"%GeneratorFunction%":Z,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":x&&L?L(L([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!x||!L?n:L(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":T,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":s,"%ReferenceError%":i,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!x||!L?n:L(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":x&&L?L(""[Symbol.iterator]()):n,"%Symbol%":x?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":E,"%TypedArray%":ae,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":G,"%Function.prototype.apply%":X,"%Object.defineProperty%":_,"%Object.getPrototypeOf%":$,"%Math.abs%":u,"%Math.floor%":h,"%Math.max%":d,"%Math.min%":f,"%Math.pow%":p,"%Math.round%":g,"%Math.sign%":m,"%Reflect.getPrototypeOf%":B};if(L)try{null.error}catch(N){var fe=L(L(N));te["%Error.prototype%"]=fe}var Ie=function N(C){var D;if(C==="%AsyncFunction%")D=w("async function () {}");else if(C==="%GeneratorFunction%")D=w("function* () {}");else if(C==="%AsyncGeneratorFunction%")D=w("async function* () {}");else if(C==="%AsyncGenerator%"){var j=N("%AsyncGeneratorFunction%");j&&(D=j.prototype)}else if(C==="%AsyncIteratorPrototype%"){var W=N("%AsyncGenerator%");W&&L&&(D=L(W.prototype))}return te[C]=D,D},ve={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Se=Ut(),xe=Qo(),bt=Se.call(G,Array.prototype.concat),De=Se.call(X,Array.prototype.splice),de=Se.call(G,String.prototype.replace),Re=Se.call(G,String.prototype.slice),q=Se.call(G,RegExp.prototype.exec),y=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,S=function(C){var D=Re(C,0,1),j=Re(C,-1);if(D==="%"&&j!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(j==="%"&&D!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var W=[];return de(C,y,function(z,he,J,re){W[W.length]=J?de(re,A,"$1"):he||z}),W},O=function(C,D){var j=C,W;if(xe(ve,j)&&(W=ve[j],j="%"+W[0]+"%"),xe(te,j)){var z=te[j];if(z===Z&&(z=Ie(j)),typeof z>"u"&&!D)throw new a("intrinsic "+C+" exists, but is not available. Please file an issue!");return{alias:W,name:j,value:z}}throw new o("intrinsic "+C+" does not exist!")};return Qr=function(C,D){if(typeof C!="string"||C.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof D!="boolean")throw new a('"allowMissing" argument must be a boolean');if(q(/^%?[^%]*%?$/,C)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var j=S(C),W=j.length>0?j[0]:"",z=O("%"+W+"%",D),he=z.name,J=z.value,re=!1,me=z.alias;me&&(W=me[0],De(j,bt([0,1],me)));for(var ge=1,le=!0;ge<j.length;ge+=1){var M=j[ge],b=Re(M,0,1),Te=Re(M,-1);if((b==='"'||b==="'"||b==="`"||Te==='"'||Te==="'"||Te==="`")&&b!==Te)throw new o("property names with quotes must have matching quotes");if((M==="constructor"||!le)&&(re=!0),W+="."+M,he="%"+W+"%",xe(te,he))J=te[he];else if(J!=null){if(!(M in J)){if(!D)throw new a("base intrinsic for "+C+" exists, but the property is not available.");return}if(T&&ge+1>=j.length){var Pe=T(J,M);le=!!Pe,le&&"get"in Pe&&!("originalValue"in Pe.get)?J=Pe.get:J=J[M]}else le=xe(J,M),J=J[M];le&&!re&&(te[he]=J)}}return J},Qr}var Xr,Ni;function Yn(){if(Ni)return Xr;Ni=1;var n=Xo(),e=Jn(),t=e([n("%String.prototype.indexOf%")]);return Xr=function(s,i){var o=n(s,!!i);return typeof o=="function"&&t(s,".prototype.")>-1?e([o]):o},Xr}var Zr,Ui;function Eu(){if(Ui)return Zr;Ui=1;var n=Kn()(),e=Yn(),t=e("Object.prototype.toString"),r=function(a){return n&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:t(a)==="[object Arguments]"},s=function(a){return r(a)?!0:a!==null&&typeof a=="object"&&"length"in a&&typeof a.length=="number"&&a.length>=0&&t(a)!=="[object Array]"&&"callee"in a&&t(a.callee)==="[object Function]"},i=function(){return r(arguments)}();return r.isLegacyArguments=s,Zr=i?r:s,Zr}var en,Di;function Qn(){if(Di)return en;Di=1;var n=Qt(),e=Ko(),t=_t(),r=wt();return en=function(i,o,a){if(!i||typeof i!="object"&&typeof i!="function")throw new t("`obj` must be an object or a function`");if(typeof o!="string"&&typeof o!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,d=arguments.length>6?arguments[6]:!1,f=!!r&&r(i,o);if(n)n(i,o,{configurable:h===null&&f?f.configurable:!h,enumerable:c===null&&f?f.enumerable:!c,value:a,writable:u===null&&f?f.writable:!u});else if(d||!c&&!u&&!h)i[o]=a;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},en}var tn,Li;function Xn(){if(Li)return tn;Li=1;var n=Qt(),e=function(){return!!n};return e.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},tn=e,tn}var rn,qi;function Dt(){if(qi)return rn;qi=1;var n=Bo(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",t=Object.prototype.toString,r=Array.prototype.concat,s=Qn(),i=function(u){return typeof u=="function"&&t.call(u)==="[object Function]"},o=Xn()(),a=function(u,h,d,f){if(h in u){if(f===!0){if(u[h]===d)return}else if(!i(f)||!f())return}o?s(u,h,d,!0):s(u,h,d)},c=function(u,h){var d=arguments.length>2?arguments[2]:{},f=n(h);e&&(f=r.call(f,Object.getOwnPropertySymbols(h)));for(var p=0;p<f.length;p+=1)a(u,f[p],h[f[p]],d[f[p]])};return c.supportsDescriptors=!!o,rn=c,rn}var nn={exports:{}},sn,Mi;function Tu(){if(Mi)return sn;Mi=1;var n=Xo(),e=Qn(),t=Xn()(),r=wt(),s=_t(),i=n("%Math.floor%");return sn=function(a,c){if(typeof a!="function")throw new s("`fn` is not a function");if(typeof c!="number"||c<0||c>4294967295||i(c)!==c)throw new s("`length` must be a positive 32-bit integer");var u=arguments.length>2&&!!arguments[2],h=!0,d=!0;if("length"in a&&r){var f=r(a,"length");f&&!f.configurable&&(h=!1),f&&!f.writable&&(d=!1)}return(h||d||!u)&&(t?e(a,"length",c,!0,!0):e(a,"length",c)),a},sn}var on,Fi;function Pu(){if(Fi)return on;Fi=1;var n=Ut(),e=zn(),t=Jo();return on=function(){return t(n,e,arguments)},on}var Bi;function Zo(){return Bi||(Bi=1,function(n){var e=Tu(),t=Qt(),r=Jn(),s=Pu();n.exports=function(o){var a=r(arguments),c=o.length-(arguments.length-1);return e(a,1+(c>0?c:0),!0)},t?t(n.exports,"apply",{value:s}):n.exports.apply=s}(nn)),nn.exports}var an,Wi;function ea(){if(Wi)return an;Wi=1;var n=function(e){return e!==e};return an=function(t,r){return t===0&&r===0?1/t===1/r:!!(t===r||n(t)&&n(r))},an}var ln,Hi;function ta(){if(Hi)return ln;Hi=1;var n=ea();return ln=function(){return typeof Object.is=="function"?Object.is:n},ln}var cn,Gi;function ku(){if(Gi)return cn;Gi=1;var n=ta(),e=Dt();return cn=function(){var r=n();return e(Object,{is:r},{is:function(){return Object.is!==r}}),r},cn}var un,Ki;function Au(){if(Ki)return un;Ki=1;var n=Dt(),e=Zo(),t=ea(),r=ta(),s=ku(),i=e(r(),Object);return n(i,{getPolyfill:r,implementation:t,shim:s}),un=i,un}var dn,Vi;function $u(){if(Vi)return dn;Vi=1;var n=Yn(),e=Kn()(),t=Qo(),r=wt(),s;if(e){var i=n("RegExp.prototype.exec"),o={},a=function(){throw o},c={toString:a,valueOf:a};typeof Symbol.toPrimitive=="symbol"&&(c[Symbol.toPrimitive]=a),s=function(f){if(!f||typeof f!="object")return!1;var p=r(f,"lastIndex"),g=p&&t(p,"value");if(!g)return!1;try{i(f,c)}catch(m){return m===o}}}else{var u=n("Object.prototype.toString"),h="[object RegExp]";s=function(f){return!f||typeof f!="object"&&typeof f!="function"?!1:u(f)===h}}return dn=s,dn}var hn,zi;function Ru(){if(zi)return hn;zi=1;var n=function(){return typeof(function(){}).name=="string"},e=Object.getOwnPropertyDescriptor;if(e)try{e([],"length")}catch{e=null}n.functionsHaveConfigurableNames=function(){if(!n()||!e)return!1;var s=e(function(){},"name");return!!s&&!!s.configurable};var t=Function.prototype.bind;return n.boundFunctionsHaveNames=function(){return n()&&typeof t=="function"&&(function(){}).bind().name!==""},hn=n,hn}var fn,Ji;function Ou(){if(Ji)return fn;Ji=1;var n=Qn(),e=Xn()(),t=Ru().functionsHaveConfigurableNames(),r=_t();return fn=function(i,o){if(typeof i!="function")throw new r("`fn` is not a function");var a=arguments.length>2&&!!arguments[2];return(!a||t)&&(e?n(i,"name",o,!0,!0):n(i,"name",o)),i},fn}var pn,Yi;function ra(){if(Yi)return pn;Yi=1;var n=Ou(),e=_t(),t=Object;return pn=n(function(){if(this==null||this!==t(this))throw new e("RegExp.prototype.flags getter called on non-object");var s="";return this.hasIndices&&(s+="d"),this.global&&(s+="g"),this.ignoreCase&&(s+="i"),this.multiline&&(s+="m"),this.dotAll&&(s+="s"),this.unicode&&(s+="u"),this.unicodeSets&&(s+="v"),this.sticky&&(s+="y"),s},"get flags",!0),pn}var gn,Qi;function na(){if(Qi)return gn;Qi=1;var n=ra(),e=Dt().supportsDescriptors,t=Object.getOwnPropertyDescriptor;return gn=function(){if(e&&/a/mig.flags==="gim"){var s=t(RegExp.prototype,"flags");if(s&&typeof s.get=="function"&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var i="",o={};if(Object.defineProperty(o,"hasIndices",{get:function(){i+="d"}}),Object.defineProperty(o,"sticky",{get:function(){i+="y"}}),s.get.call(o),i==="dy")return s.get}}return n},gn}var vn,Xi;function ju(){if(Xi)return vn;Xi=1;var n=Dt().supportsDescriptors,e=na(),t=wt(),r=Object.defineProperty,s=Go(),i=Yo(),o=/a/;return vn=function(){if(!n||!i)throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var c=e(),u=i(o),h=t(u,"flags");return(!h||h.get!==c)&&r(u,"flags",{configurable:!0,enumerable:!1,get:c}),c},vn}var mn,Zi;function Cu(){if(Zi)return mn;Zi=1;var n=Dt(),e=Zo(),t=ra(),r=na(),s=ju(),i=e(r());return n(i,{getPolyfill:r,implementation:t,shim:s}),mn=i,mn}var yn,eo;function Iu(){if(eo)return yn;eo=1;var n=Yn(),e=n("Date.prototype.getDay"),t=function(a){try{return e(a),!0}catch{return!1}},r=n("Object.prototype.toString"),s="[object Date]",i=Kn()();return yn=function(a){return typeof a!="object"||a===null?!1:i?t(a):r(a)===s},yn}var _n,to;function xu(){if(to)return _n;to=1;var n=Bo(),e=Eu(),t=Au(),r=$u(),s=Cu(),i=Iu(),o=Date.prototype.getTime;function a(d,f,p){var g=p||{};return(g.strict?t(d,f):d===f)?!0:!d||!f||typeof d!="object"&&typeof f!="object"?g.strict?t(d,f):d==f:h(d,f,g)}function c(d){return d==null}function u(d){return!(!d||typeof d!="object"||typeof d.length!="number"||typeof d.copy!="function"||typeof d.slice!="function"||d.length>0&&typeof d[0]!="number")}function h(d,f,p){var g,m;if(typeof d!=typeof f||c(d)||c(f)||d.prototype!==f.prototype||e(d)!==e(f))return!1;var v=r(d),w=r(f);if(v!==w)return!1;if(v||w)return d.source===f.source&&s(d)===s(f);if(i(d)&&i(f))return o.call(d)===o.call(f);var T=u(d),_=u(f);if(T!==_)return!1;if(T||_){if(d.length!==f.length)return!1;for(g=0;g<d.length;g++)if(d[g]!==f[g])return!1;return!0}if(typeof d!=typeof f)return!1;try{var P=n(d),E=n(f)}catch{return!1}if(P.length!==E.length)return!1;for(P.sort(),E.sort(),g=P.length-1;g>=0;g--)if(P[g]!=E[g])return!1;for(g=P.length-1;g>=0;g--)if(m=P[g],!a(d[m],f[m],p))return!1;return!0}return _n=a,_n}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var wn,ro;function Nu(){if(ro)return wn;ro=1;var n=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(i){if(i==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(i)}function s(){try{if(!Object.assign)return!1;var i=new String("abc");if(i[5]="de",Object.getOwnPropertyNames(i)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var c=Object.getOwnPropertyNames(o).map(function(h){return o[h]});if(c.join("")!=="0123456789")return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(h){u[h]=h}),Object.keys(Object.assign({},u)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return wn=s()?Object.assign:function(i,o){for(var a,c=r(i),u,h=1;h<arguments.length;h++){a=Object(arguments[h]);for(var d in a)e.call(a,d)&&(c[d]=a[d]);if(n){u=n(a);for(var f=0;f<u.length;f++)t.call(a,u[f])&&(c[u[f]]=a[u[f]])}}return c},wn}var ut={},no;function Uu(){return no||(no=1,ut.__esModule=!0,ut.TAG_NAMES={HTML:"htmlAttributes",TITLE:"title",BASE:"base",META:"meta",LINK:"link",SCRIPT:"script",NOSCRIPT:"noscript",STYLE:"style"},ut.TAG_PROPERTIES={NAME:"name",CHARSET:"charset",HTTPEQUIV:"http-equiv",REL:"rel",HREF:"href",PROPERTY:"property",SRC:"src",INNER_HTML:"innerHTML",CSS_TEXT:"cssText",ITEM_PROP:"itemprop"},ut.PREACT_TAG_MAP={charset:"charSet","http-equiv":"httpEquiv",itemprop:"itemProp",class:"className"}),ut}var so;function Du(){return so||(so=1,function(n,e){e.__esModule=!0;var t=function(){function q(y,A){for(var S=0;S<A.length;S++){var O=A[S];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(y,O.key,O)}}return function(y,A,S){return A&&q(y.prototype,A),S&&q(y,S),y}}(),r=Object.assign||function(q){for(var y=1;y<arguments.length;y++){var A=arguments[y];for(var S in A)Object.prototype.hasOwnProperty.call(A,S)&&(q[S]=A[S])}return q},s=Mo,i=su(),o=f(i),a=xu(),c=f(a),u=Nu(),h=f(u),d=Uu();function f(q){return q&&q.__esModule?q:{default:q}}function p(q,y){if(!(q instanceof y))throw new TypeError("Cannot call a class as a function")}function g(q,y){if(!q)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:q}function m(q,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof y);q.prototype=Object.create(y&&y.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(q,y):q.__proto__=y)}function v(q,y,A){return y in q?Object.defineProperty(q,y,{value:A,enumerable:!0,configurable:!0,writable:!0}):q[y]=A,q}var w="data-preact-helmet",T=function(y){return String(y).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},_=function(y,A){for(var S=y.length-1;S>=0;S--){var O=y[S];if(O[A])return O[A]}return null},P=function(y){var A=_(y,"title"),S=_(y,"titleTemplate");if(S&&A)return S.replace(/%s/g,function(){return A});var O=_(y,"defaultTitle");return A||O||""},E=function(y){return _(y,"onChangeClientState")||function(){}},x=function(y,A){return A.filter(function(S){return typeof S[y]<"u"}).map(function(S){return S[y]}).reduce(function(S,O){return r({},S,O)},{})},L=function(y,A){return A.filter(function(S){return typeof S[d.TAG_NAMES.BASE]<"u"}).map(function(S){return S[d.TAG_NAMES.BASE]}).reverse().reduce(function(S,O){if(!S.length)for(var N=Object.keys(O),C=0;C<N.length;C++){var D=N[C],j=D.toLowerCase();if(y.indexOf(j)!==-1&&O[j])return S.concat(O)}return S},[])},$=function(y,A,S){var O={};return S.filter(function(N){return typeof N[y]<"u"}).map(function(N){return N[y]}).reverse().reduce(function(N,C){var D={};C.filter(function(J){for(var re=void 0,me=Object.keys(J),ge=0;ge<me.length;ge++){var le=me[ge],M=le.toLowerCase();A.indexOf(M)!==-1&&!(re===d.TAG_PROPERTIES.REL&&J[re].toLowerCase()==="canonical")&&!(M===d.TAG_PROPERTIES.REL&&J[M].toLowerCase()==="stylesheet")&&(re=M),A.indexOf(le)!==-1&&(le===d.TAG_PROPERTIES.INNER_HTML||le===d.TAG_PROPERTIES.CSS_TEXT||le===d.TAG_PROPERTIES.ITEM_PROP)&&(re=le)}if(!re||!J[re])return!1;var b=J[re].toLowerCase();return O[re]||(O[re]={}),D[re]||(D[re]={}),O[re][b]?!1:(D[re][b]=!0,!0)}).reverse().forEach(function(J){return N.push(J)});for(var j=Object.keys(D),W=0;W<j.length;W++){var z=j[W],he=(0,h.default)({},O[z],D[z]);O[z]=he}return N},[]).reverse()},B=function(y,A){document.title=y||document.title,X(d.TAG_NAMES.TITLE,A)},X=function(y,A){for(var S=document.getElementsByTagName(y)[0],O=S.getAttribute(w),N=O?O.split(","):[],C=[].concat(N),D=Object.keys(A),j=0;j<D.length;j++){var W=D[j],z=A[W]||"";S.setAttribute(W,z),N.indexOf(W)===-1&&N.push(W);var he=C.indexOf(W);he!==-1&&C.splice(he,1)}for(var J=C.length-1;J>=0;J--)S.removeAttribute(C[J]);N.length===C.length?S.removeAttribute(w):S.setAttribute(w,N.join(","))},G=function(y,A){var S=document.head||document.querySelector("head"),O=S.querySelectorAll(y+"["+w+"]"),N=Array.prototype.slice.call(O),C=[],D=void 0;return A&&A.length&&A.forEach(function(j){var W=document.createElement(y);for(var z in j)if(j.hasOwnProperty(z))if(z==="innerHTML")W.innerHTML=j.innerHTML;else if(z==="cssText")W.styleSheet?W.styleSheet.cssText=j.cssText:W.appendChild(document.createTextNode(j.cssText));else{var he=typeof j[z]>"u"?"":j[z];W.setAttribute(z,he)}W.setAttribute(w,"true"),N.some(function(J,re){return D=re,W.isEqualNode(J)})?N.splice(D,1):C.push(W)}),N.forEach(function(j){return j.parentNode.removeChild(j)}),C.forEach(function(j){return S.appendChild(j)}),{oldTags:N,newTags:C}},Z=function(y){return Object.keys(y).reduce(function(A,S){var O=typeof y[S]<"u"?S+'="'+y[S]+'"':""+S;return A?A+" "+O:O},"")},ae=function(y,A,S){var O=Z(S);return O?"<"+y+" "+w+" "+O+">"+T(A)+"</"+y+">":"<"+y+" "+w+">"+T(A)+"</"+y+">"},te=function(y,A){return A.reduce(function(S,O){var N=Object.keys(O).filter(function(j){return!(j==="innerHTML"||j==="cssText")}).reduce(function(j,W){var z=typeof O[W]>"u"?W:W+'="'+T(O[W])+'"';return j?j+" "+z:z},""),C=O.innerHTML||O.cssText||"",D=[d.TAG_NAMES.NOSCRIPT,d.TAG_NAMES.SCRIPT,d.TAG_NAMES.STYLE].indexOf(y)===-1;return S+"<"+y+" "+w+" "+N+(D?">":">"+C+"</"+y+">")},"")},fe=function(y,A,S){var O=v({key:A},w,!0),N=Object.keys(S).reduce(function(C,D){return C[D]=S[D],C},O);return[(0,s.h)(d.TAG_NAMES.TITLE,N,A)]},Ie=function(y,A){return A.map(function(S,O){var N=v({key:O},w,!0);return Object.keys(S).forEach(function(C){var D=C;if(D==="innerHTML"||D==="cssText"){var j=S.innerHTML||S.cssText;N.dangerouslySetInnerHTML={__html:j}}else N[D]=S[C]}),(0,s.h)(y,N)})},ve=function(y,A){switch(y){case d.TAG_NAMES.TITLE:return{toComponent:function(){return fe(y,A.title,A.titleAttributes)},toString:function(){return ae(y,A.title,A.titleAttributes)}};case d.TAG_NAMES.HTML:return{toComponent:function(){return A},toString:function(){return Z(A)}};default:return{toComponent:function(){return Ie(y,A)},toString:function(){return te(y,A)}}}},Se=function(y){var A=y.htmlAttributes,S=y.title,O=y.titleAttributes,N=y.baseTag,C=y.metaTags,D=y.linkTags,j=y.scriptTags,W=y.noscriptTags,z=y.styleTags;return{htmlAttributes:ve(d.TAG_NAMES.HTML,A),title:ve(d.TAG_NAMES.TITLE,{title:S,titleAttributes:O}),base:ve(d.TAG_NAMES.BASE,N),meta:ve(d.TAG_NAMES.META,C),link:ve(d.TAG_NAMES.LINK,D),script:ve(d.TAG_NAMES.SCRIPT,j),noscript:ve(d.TAG_NAMES.NOSCRIPT,W),style:ve(d.TAG_NAMES.STYLE,z)}},xe=function(y){var A,S;return S=A=function(O){m(N,O);function N(){return p(this,N),g(this,(N.__proto__||Object.getPrototypeOf(N)).apply(this,arguments))}return t(N,[{key:"shouldComponentUpdate",value:function(D){var j=r({},D);return(!j.children||!j.children.length)&&delete j.children,!(0,c.default)(this.props,j)}},{key:"render",value:function(){return(0,s.h)(y,this.props)}}],[{key:"canUseDOM",set:function(D){y.canUseDOM=D}}]),N}(s.Component),A.peek=y.peek,A.rewind=function(){var O=y.rewind();return O||(O=Se({htmlAttributes:{},title:"",titleAttributes:{},baseTag:[],metaTags:[],linkTags:[],scriptTags:[],noscriptTags:[],styleTags:[]})),O},S},bt=function(y){return{htmlAttributes:x(d.TAG_NAMES.HTML,y),title:P(y),titleAttributes:x("titleAttributes",y),baseTag:L([d.TAG_PROPERTIES.HREF],y),metaTags:$(d.TAG_NAMES.META,[d.TAG_PROPERTIES.NAME,d.TAG_PROPERTIES.CHARSET,d.TAG_PROPERTIES.HTTPEQUIV,d.TAG_PROPERTIES.PROPERTY,d.TAG_PROPERTIES.ITEM_PROP],y),linkTags:$(d.TAG_NAMES.LINK,[d.TAG_PROPERTIES.REL,d.TAG_PROPERTIES.HREF],y),scriptTags:$(d.TAG_NAMES.SCRIPT,[d.TAG_PROPERTIES.SRC,d.TAG_PROPERTIES.INNER_HTML],y),noscriptTags:$(d.TAG_NAMES.NOSCRIPT,[d.TAG_PROPERTIES.INNER_HTML],y),styleTags:$(d.TAG_NAMES.STYLE,[d.TAG_PROPERTIES.CSS_TEXT],y),onChangeClientState:E(y)}},De=function(y){var A=y.htmlAttributes,S=y.title,O=y.titleAttributes,N=y.baseTag,C=y.metaTags,D=y.linkTags,j=y.scriptTags,W=y.noscriptTags,z=y.styleTags,he=y.onChangeClientState;X("html",A),B(S,O);var J={baseTag:G(d.TAG_NAMES.BASE,N),metaTags:G(d.TAG_NAMES.META,C),linkTags:G(d.TAG_NAMES.LINK,D),scriptTags:G(d.TAG_NAMES.SCRIPT,j),noscriptTags:G(d.TAG_NAMES.NOSCRIPT,W),styleTags:G(d.TAG_NAMES.STYLE,z)},re={},me={};Object.keys(J).forEach(function(ge){var le=J[ge],M=le.newTags,b=le.oldTags;M.length&&(re[ge]=M),b.length&&(me[ge]=J[ge].oldTags)}),he(y,re,me)},de=function(){return null},Re=(0,o.default)(bt,De,Se)(de);e.default=xe(Re),n.exports=e.default}(Gt,Gt.exports)),Gt.exports}var Lu=Du();const Jt=po(Lu),qu=()=>{const{user:n}=et(),e=vt(i=>i.favorites),t=vt(i=>i.fetchFavorites),[r,s]=U({});return se(()=>{document.title="My Favorites - FreeStream",n&&t()},[n,t]),se(()=>{(async()=>{if(n&&e.length>0){const o=e.map(a=>({media_id:a.id,media_type:a.type,season_number:a.season_number||null,episode_number:a.episode_number||null}));try{const a=await Lo(o);s(a)}catch(a){console.error("Error fetching progress data for favorites:",a),s({})}}else s({})})()},[n,e]),l("div",{class:"container",children:[l(Jt,{children:l("title",{children:"My Favorites - FreeStream"})}),l("h1",{children:"My Favorites"}),e.length>0?l("div",{class:"movie-grid",children:e.map(i=>{const o=`${i.id}-${i.type}-${i.season_number||0}-${i.episode_number||0}`,a=r[o];return l(mt,{item:i,type:i.type,progress:a?.progress_seconds,duration:a?.duration_seconds},`${i.type}-${i.id}-${i.season_number||0}-${i.episode_number||0}`)})}):l("p",{children:"You haven't added any favorites yet."})]})},io=async(n,e=3,t=1e3)=>{for(let r=0;r<e;r++)try{const s=new Promise((a,c)=>{setTimeout(()=>c(new Error("Request timeout")),1e4)}),i=fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json"}}),o=await Promise.race([i,s]);if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return o}catch(s){if(console.warn(`Fetch attempt ${r+1} failed for ${n}:`,s.message),r===e-1)throw s;await new Promise(i=>setTimeout(i,t*(r+1)))}},Mu=()=>{const{user:n}=et(),[e,t]=U([]),[r,s]=U(!0),[i,o]=U(null),{removeContinueWatchingItem:a,fetchContinueWatching:c}=vt(),u=ua(async()=>{if(!n){s(!1);return}s(!0),o(null);try{if(!await No())throw new Error("Supabase connection test failed. Please check your internet connection and try again.");const p=await tu();if(!p||p.length===0){t([]),s(!1);return}console.log(" Combined history data received:",{totalItems:p.length,itemsWithProgress:p.filter(v=>v.progress_seconds>0).length});const m=(await Promise.allSettled(p.map(async v=>{try{const T=await(await io(`${we}/tmdb/${v.media_type}/${v.media_id}`)).json(),_={...T,id:T.id,watch_id:`${v.user_id}-${v.media_id}-${v.media_type}-${v.season_number||0}-${v.episode_number||0}`,type:v.media_type,media_type:v.media_type,media_id:v.media_id,season_number:v.season_number,episode_number:v.episode_number,watched_at:v.watched_at,progress_seconds:v.progress_seconds,duration_seconds:v.duration_seconds};if(v.media_type==="tv"&&v.season_number&&v.episode_number)try{const E=await(await io(`${we}/tmdb/tv/${v.media_id}/season/${v.season_number}/episode/${v.episode_number}`)).json();return{..._,episode_name:E.name,still_path:E.still_path,episode_overview:E.overview}}catch(P){console.error("Error fetching episode details:",P)}return _}catch(w){return console.error(`Error fetching details for ${v.media_type} ${v.media_id}:`,w),{id:v.media_id,watch_id:`${v.user_id}-${v.media_id}-${v.media_type}-${v.season_number||0}-${v.episode_number||0}`,type:v.media_type,media_type:v.media_type,media_id:v.media_id,season_number:v.season_number,episode_number:v.episode_number,watched_at:v.watched_at,title:v.media_type==="tv"?"Unknown TV Show":"Unknown Movie",name:v.media_type==="tv"?"Unknown TV Show":void 0,poster_path:null,overview:"Details could not be loaded",_failed_to_load:!0,progress_seconds:v.progress_seconds,duration_seconds:v.duration_seconds}}}))).filter(v=>v.status==="fulfilled"&&v.value).map(v=>v.value);t(m)}catch(f){console.error("Error fetching watch history:",f),o("Failed to load watch history. Please try again."),t([])}finally{s(!1)}},[n]);se(()=>{u()},[u]);const h=async f=>{t(e.filter(p=>p.watch_id!==f.watch_id)),a(f.media_id);try{await Xc(f),await c()}catch(p){console.error("Failed to delete item or refetch continue watching:",p)}},d=()=>{u()};return r?l("div",{class:"container",children:l("p",{children:"Loading watch history..."})}):i?l("div",{class:"container",children:[l(Jt,{children:l("title",{children:"Watch History - FreeStream"})}),l("h1",{children:"Watch History"}),l("div",{class:"error-message",children:[l("p",{children:i}),l("button",{onClick:d,class:"retry-button",children:"Retry"})]})]}):l("div",{class:"container",children:[l(Jt,{children:l("title",{children:"Watch History - FreeStream"})}),l("h1",{children:"Watch History"}),e.length>0?l("div",{class:"movie-grid",children:e.map(f=>l(mt,{item:f,type:f.type,progress:f.progress_seconds,duration:f.duration_seconds,showDeleteButton:!0,onDelete:h},f.watch_id))}):l("p",{children:"Your watch history is empty."})]})},oo=n=>{const[e,t]=U(null),[r,s]=U([]),[i,o]=U([]),[a,c]=U(""),[u,h]=U(!0),[d,f]=U(!1),[p,g]=U(null),[m,v]=U(null),[w,T]=U("videasy"),[_,P]=U(["videasy","vidsrc","embedsu"]),[E,x]=U(null),[L,$]=U(!1),[B,X]=U(!1),[G,Z]=U(null),[ae,te]=U(!1),[fe,Ie]=U(!1),[ve,Se]=U([]),xe=ye(null),[bt,De]=U([]),[de,Re]=U(null),[q,y]=U(!1),[A,S]=U(0),[O,N]=U(1),C=6,D=ye(!1),j=ye(null),W=ye(!1),z=ye(!1),he=ye(!1),J=ye(null),re=ye(!1),me=ye(new Set),ge=ye(0);ye(0);const le=ye(null),{id:M,type:b,season:Te,episode:Pe}=n.matches,{user:ke}=et(),{addFavorite:Zn,removeFavorite:es,isFavorited:ts,setCurrentMediaItem:Xt}=vt();se(()=>{if(b==="tv"||b==="anime")if(Te&&Pe&&!isNaN(parseInt(Te))&&!isNaN(parseInt(Pe))){const F=parseInt(Te,10),R=parseInt(Pe,10);g(F),v(R)}else g(1),v(1);else g(null),v(null)},[b,Te,Pe]);const rs=da(()=>b!=="movie"||!de||!de.progress_seconds||de.progress_seconds<=0?0:de.duration_seconds>0?Math.min(100,de.progress_seconds/de.duration_seconds*100):de.progress_seconds>30?5:2,[b,de]),Zt=ke?.id,ns=ye(Zt);ye(0),se(()=>{ns.current=Zt},[Zt]),se(()=>()=>{me.current.forEach(k=>clearTimeout(k)),me.current.clear()},[p,m]),se(()=>(e&&Xt({...e,type:b}),()=>{Xt(null)}),[e,b,Xt]),se(()=>{if(!M||!b){$e("/");return}c(""),Ie(!1),Se([]),t(null),h(!0),De([]),W.current=!1,z.current=!1,he.current=!1,J.current=null,re.current=!1,me.current.forEach(F=>clearTimeout(F)),me.current.clear(),ge.current=0,le.current=null,(async()=>{h(!0);try{const F=new AbortController,R=setTimeout(()=>F.abort(),15e3),[Y,oe,Q]=await Promise.all([fetch(`${we}/tmdb/${b}/${M}`,{signal:F.signal}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}: ${I.statusText}`);return I.json()}).catch(I=>{throw console.error("Error fetching media details:",I),I}),fetch(`${we}/tmdb/${b}/${M}/videos`,{signal:F.signal}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}: ${I.statusText}`);return I.json()}).catch(I=>(console.error("Error fetching videos:",I),{results:[]})),fetch(`${we}/tmdb/${b}/${M}/recommendations`,{signal:F.signal}).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}: ${I.statusText}`);return I.json()}).catch(I=>(console.error("Error fetching recommendations:",I),{results:[]}))]);clearTimeout(R),t(Y),s(oe.results||[]),o(Q.results||[])}catch{t(null),s([]),o([])}finally{h(!1)}})()},[M,b,Te,Pe]),se(()=>{(async()=>{if(!ke||!e||!M||!b){b==="movie"?Re(null):(b==="tv"||b==="anime")&&De([]);return}try{if((b==="tv"||b==="anime")&&e.seasons&&e.seasons.length>0&&!(Te&&Pe&&!isNaN(parseInt(Te))&&!isNaN(parseInt(Pe)))&&!z.current&&p!==null&&m!==null){console.log(" Checking for continue watching episode...");const R=await eu(M);R&&R.season&&R.episode?(console.log(` Continue watching: S${R.season}E${R.episode}`),setTimeout(()=>{g(R.season),v(R.episode);const Y=`/watch/${b}/${M}/season/${R.season}/episode/${R.episode}`;$e(Y,!0)},100)):console.log(" No continue watching data found, starting from beginning"),z.current=!0}if(b==="tv"||b==="anime"){const F=await Zc(M);De(F)}else if(b==="movie"){const F=await dr(M,b);console.log("Movie progress data loaded:",F),Re(F)}}catch(F){console.error("Error loading user-specific data:",F)}})()},[ke,e,M,b]),se(()=>{p!==null&&N(1)},[p]),se(()=>{(async()=>{if(!(b!=="tv"&&b!=="anime"||!M||!p||p===null)){$(!0);try{const F=new AbortController,R=setTimeout(()=>F.abort(),1e4),Y=await fetch(`${we}/tmdb/${b}/${M}/season/${p}`,{signal:F.signal});if(clearTimeout(R),Y.ok){const oe=await Y.json();x(oe)}else x(null)}catch{x(null)}finally{$(!1)}}})()},[M,b,p]),se(()=>{const k=`${p}-${m}`,F=j.current&&j.current!==k;if(j.current=k,D.current&&!F){D.current=!1;return}F&&(D.current=!1),(async()=>{if(!M||!b||(b==="tv"||b==="anime")&&(p===null||m===null))return;Z(null),te(!1);let Y=0;if(ns.current)try{const Q=await dr(M,b,p,m);Q&&Q.progress_seconds>30?(Y=Q.progress_seconds,S(Q.progress_seconds)):S(0)}catch(Q){console.error("Error fetching progress for stream URL:",Q),S(0)}else S(0);let oe=`${we}/stream-url?type=${b}&id=${M}&source=${w}`;(b==="tv"||b==="anime")&&(oe+=`&season=${p}&episode=${m}`,b==="anime"&&(oe+=`&dub=${B}`)),w==="videasy"&&(Y>30&&(oe+=`&progress=${Math.floor(Y)}`),(b==="tv"||b==="anime")&&(oe+="&nextEpisode=true&episodeSelector=true&autoplayNextEpisode=true"));try{const Q=new AbortController,I=setTimeout(()=>Q.abort(),2e4),ne=await fetch(oe,{signal:Q.signal});clearTimeout(I);const ie=await ne.json();if(!ne.ok)throw new Error(ie.message||`HTTP ${ne.status}`);let Ae=ie.url;if(!Ae)throw new Error("The streaming service did not provide a valid URL. This content might not be available.");ie.isDirectSource?(c(Ae),Se(ie.qualities||[]),Ie(!0)):(c(Ae),Ie(!1),Se([])),ie.currentSource&&ie.currentSource!==w&&(D.current=!0,T(ie.currentSource)),ie.availableSources&&P(ie.availableSources),Z(null)}catch(Q){let I="Could not load the video stream.",ne=!0;Q.name==="AbortError"?I="Stream request timed out. Please try again.":Q.message.includes("unavailable")?I="All streaming sources are currently unavailable. This is usually temporary.":Q.message.includes("503")?I="Streaming service is temporarily down. Please try again in a few minutes.":Q.message.includes("404")?I="This content is not available from the current source.":Q.message.includes("NetworkError")||Q.message.includes("fetch")?I="Network connection issue. Please check your internet and try again.":I="Unable to load video stream. This might be due to leaving and returning to the browser.",Z({message:I,canRetry:ne}),c(""),Ie(!1)}})()},[M,b,p,m,w,B]),se(()=>{if(ke&&e){const k=`${M}-${b}-${p}-${m}`,F=Date.now(),R=window.lastHistoryUpdate||{};(!R[k]||F-R[k]>5e3)&&(console.log(" Adding immediate watch history entry:",{mediaId:M,type:b,season:p,episode:m,title:e.title||e.name}),Qc({...e,id:e.id,type:b,season:p,episode:m}).then(()=>{console.log(" Watch history entry added successfully")}).catch(Y=>{console.error(" Failed to add watch history entry:",Y)}),window.lastHistoryUpdate={...R,[k]:F})}},[ke,e,b,p,m,M]),se(()=>{if(ke&&console.log(" Progress tracking setup:",{hasUser:!0,userId:ke.id,hasMediaDetails:!!e}),!ke||!e){ke&&!e&&console.log(" Progress tracking disabled - media details not yet available");return}const k=async(R,Y)=>{console.log(` Progress update received via ${Y}:`,R);const oe=R.season||p,Q=R.episode||m;if(R&&R.progress>=0&&R.duration>0){const I=Date.now(),ne=`${M}-${b}-${oe}-${Q}`,ie=window.lastProgressSave||{};!ie[ne]||I-ie[ne]>5e3?(console.log(` Attempting to save progress for ${b} ${M}:`,{progress:R.progress,duration:R.duration,season:oe,episode:Q}),await Js({...e,id:e.id,type:b,season:oe,episode:Q},R.progress,R.duration)?(console.log(" Progress saved successfully"),window.lastProgressSave={...ie,[ne]:I},oe===p&&Q===m&&(b==="movie"?Re({progress_seconds:R.progress,duration_seconds:R.duration}):(b==="tv"||b==="anime")&&De(Ke=>{const Oe=[...Ke],Ve=Oe.findIndex(Et=>Et.season_number===oe&&Et.episode_number===Q),St={media_id:parseInt(M,10),media_type:b,season_number:oe,episode_number:Q,progress_seconds:R.progress,duration_seconds:R.duration};return Ve>-1?Oe[Ve]={...Oe[Ve],...St}:Oe.push(St),Oe}))):console.error(" Failed to save progress")):console.log(" Progress save skipped (too recent):",{timeSinceLastSave:I-ie[ne],threshold:5e3}),R.duration-R.progress}else console.log(" Progress update ignored (insufficient data):",{hasProgressData:!!R,progress:R?.progress,duration:R?.duration,meetsThreshold:R?.progress>=0&&R?.duration>0})};let F;if(fe){const R=xe.current;if(!R)return;const Y=async()=>{const Q=await dr(M,b,p,m);Q&&Q.progress_seconds&&(R.currentTime=Q.progress_seconds)},oe=async()=>{if(R.currentTime>0){const Q=Date.now(),I=`${M}-${b}-${p}-${m}`,ne=window.lastProgressSave||{};if(!ne[I]||Q-ne[I]>5e3){const ie={progress:Math.round(R.currentTime),duration:Math.round(R.duration),percentage:R.duration>0?R.currentTime/R.duration*100:0};console.log(" Direct video - saving progress:",ie),await Js({...e,id:e.id,type:b,season:p,episode:m},ie.progress,ie.duration)?(console.log(" Direct video progress saved successfully"),window.lastProgressSave={...ne,[I]:Q},b==="movie"?Re({progress_seconds:ie.progress,duration_seconds:ie.duration}):(b==="tv"||b==="anime")&&De(Ke=>{const Oe=[...Ke],Ve=Oe.findIndex(Et=>Et.season_number===p&&Et.episode_number===m),St={media_id:parseInt(M,10),media_type:b,season_number:p,episode_number:m,progress_seconds:ie.progress,duration_seconds:ie.duration};return Ve>-1?Oe[Ve]={...Oe[Ve],...St}:Oe.push(St),Oe})):console.error(" Failed to save direct video progress")}}};return R.addEventListener("loadedmetadata",Y),R.addEventListener("timeupdate",oe),()=>{R.removeEventListener("loadedmetadata",Y),R.removeEventListener("timeupdate",oe)}}else{F=Y=>{const oe=["player.videasy.net","vidsrc.to","embed.su","vidsrc.xyz","vidsrc.in","vidsrc.pm"],Q=new URL(Y.origin);if(oe.includes(Q.hostname))try{const I=typeof Y.data=="string"?JSON.parse(Y.data):Y.data;if(I&&I.type==="PROGRESS_UPDATE"&&I.data){const ne={progress:I.data.progress?.watched,duration:I.data.progress?.duration,season:I.data.season||p,episode:I.data.episode||m};k(ne,"PROGRESS_UPDATE");return}if(I.type==="MEDIA_DATA"&&I.data){console.warn("Legacy 'MEDIA_DATA' format detected. Player should be updated.");let ne=I.data;if(typeof ne=="string")try{ne=JSON.parse(ne)}catch(Ke){console.error("Error parsing double-encoded MEDIA_DATA string:",Ke);return}const ie=`${b}-${M}`,Ae=ne[ie];if(Ae&&Ae.progress){const Ke={progress:Ae.progress.watched,duration:Ae.progress.duration,season:Ae.last_season_watched,episode:Ae.last_episode_watched};k(Ke,"MEDIA_DATA")}return}if(I.type==="PLAYER_EVENT"&&I.data)if(I.data.event==="timeupdate"){const ne={progress:I.data.time,duration:I.data.duration};ne.progress&&ne.duration&&k(ne,"PLAYER_EVENT")}else I.data.event==="ended"&&(b==="tv"||b==="anime")?console.log('Player reported "ended" event - Videasy will handle next episode automatically.'):I.data.event==="player_ready"&&(console.log("Player is ready."),y(!0))}catch(I){console.error("Error processing message from player:",{origin:Y.origin,data:Y.data,error:I.message})}},window.addEventListener("message",F);const R=setTimeout(()=>{q||(console.log("Player ready timeout, starting fallback progress tracking."),sa())},5e3);return()=>{window.removeEventListener("message",F),clearTimeout(R)}}},[ke,e,fe,xe,p,m,q]);const sa=()=>{const k=setInterval(()=>{document.hasFocus()&&console.log("Fallback: Checking for progress...")},15e3);return()=>clearInterval(k)};if(u)return l("div",{class:"loading-state",children:[l("div",{class:"loading-spinner"}),l("p",{children:"Loading media details..."})]});if(!e)return l("div",{class:"container",children:l("div",{class:"error-state",children:[l("h2",{children:"Unable to Load Media"}),l("p",{children:"We couldn't load the details for this content. This could be due to:"}),l("ul",{children:[l("li",{children:"Network connectivity issues"}),l("li",{children:"The content may no longer be available"}),l("li",{children:"Server maintenance"})]}),l("button",{onClick:()=>window.location.reload(),class:"btn btn-primary",style:{marginTop:"20px"},children:"Try Again"})]})});const{title:er,name:tr,overview:ia,vote_average:zu,release_date:ss,first_air_date:is,runtime:os,number_of_seasons:as,genres:ls,poster_path:cs}=e,rr=(b==="tv"||b==="anime")&&p&&m,nr=rr?ts(e.id,p,m):ts(e.id),us=ss||is?new Date(ss||is).getFullYear():"",oa=()=>{if(!ke){window.confirm("You need to log in to save favorites. Would you like to go to the login page?")&&$e("/login");return}if(nr)rr?es(e.id,p,m):es(e.id);else if(rr){const k=E?.episodes?.find(F=>F.episode_number===m);Zn({...e,type:b,season_number:p,episode_number:m,episode_name:k?.name||`Episode ${m}`})}else Zn({...e,type:b})};return l("div",{children:[l(Jt,{children:l("title",{children:[er||tr," - FreeStream"]})}),l("div",{class:"player-container",children:[!a&&G&&l("div",{class:"stream-error-message",children:[l("p",{children:G.message}),G.canRetry&&l("div",{class:"error-actions",children:[l("button",{onClick:async()=>{te(!0),setTimeout(()=>{(async()=>{const F=`${we}/stream-url?type=${b}&id=${M}&source=${w}${b==="tv"||b==="anime"?`&season=${p}&episode=${m}`:""}${b==="anime"?`&dub=${B}`:""}`;try{const R=await fetch(F),Y=await R.json();if(R.ok)c(Y.url),Ie(Y.isDirectSource),Se(Y.qualities||[]),Z(null);else throw new Error(Y.message)}catch(R){console.error("Retry failed:",R),Z({message:"Retry failed. Please try selecting a different source.",canRetry:!0})}te(!1)})()},1e3)},disabled:ae,class:"btn retry-btn",children:ae?"Retrying...":"Retry"}),l("p",{children:"Or try selecting a different source from the list below."})]})]}),!a&&!G&&l("div",{class:"stream-loading",children:l("p",{children:"Loading video stream..."})}),fe?l("video",{ref:xe,src:a,controls:!0,autoPlay:!0,width:"100%"}):a&&l("iframe",{src:a,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},frameBorder:"0",allowFullScreen:!0,allow:"autoplay; picture-in-picture",sandbox:"allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation",title:"Video Player",loading:"eager",referrerPolicy:"no-referrer-when-downgrade",importance:"high",onLoad:()=>{console.log(" Player iframe loaded"),y(!0),w!=="videasy"&&A>30?setTimeout(()=>{const k=document.querySelector("iframe");if(k&&k.contentWindow)try{k.contentWindow.postMessage({type:"SEEK_TO",time:A},"*"),console.log(` Sent seek command to restore progress: ${A}s`)}catch(F){console.log("Could not send seek command:",F)}},500):console.log(w==="videasy"?" Videasy native resume - no seeking needed":" No significant progress to resume, starting from beginning")}})]}),l("div",{class:"container",children:[l("div",{class:"media-details-layout",children:[l("div",{class:"poster",children:[l("img",{src:Un(cs?`${Nn}${cs}`:"https://via.placeholder.com/500x750.png?text=No+Image"),alt:er||tr}),rs>0&&l("div",{class:"movie-progress-container",children:[l("div",{class:"movie-progress-bar",children:l("div",{class:"movie-progress",style:{width:`${Math.max(2,rs)}%`}})}),l("div",{class:"movie-progress-text",children:de.duration_seconds>0?`${Math.floor(de.progress_seconds/60)}m / ${Math.floor(de.duration_seconds/60)}m watched`:`${Math.floor(de.progress_seconds/60)}m watched`})]})]}),l("div",{class:"details",children:[l("div",{class:"title-container",children:[l("h1",{children:er||tr}),l("button",{onClick:oa,class:`favorite-btn ${nr?"favorited":""}`,children:nr?" Favorited":""}),!ke&&l("span",{class:"login-hint",children:l("small",{children:[l("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in"})," to save favorites, track progress & continue watching"]})})]}),l("div",{class:"meta",children:[l("span",{class:"rating",children:[" ",e.vote_average?e.vote_average.toFixed(1):"N/A"]}),us&&l("span",{children:us}),os&&l("span",{children:[os," min"]}),as&&l("span",{children:[as," Seasons"]})]}),l("div",{class:"genres",children:ls&&ls.map(k=>l("span",{class:"genre-tag",children:k.name}))}),l("p",{class:"overview",children:ia}),ve.length>0&&l("div",{class:"quality-selector",children:[l("label",{children:"Quality:"}),ve.map(k=>l("button",{class:`quality-btn ${a===k.url?"active":""}`,onClick:()=>c(k.url),children:[k.quality,"p"]}))]})]})]}),b==="anime"&&l("div",{class:"select-container",children:[l("label",{for:"dub-select",children:"Audio:"}),l("select",{id:"dub-select",value:B,onChange:k=>X(k.target.value==="true"),children:[l("option",{value:"false",children:"Subbed"}),l("option",{value:"true",children:"Dubbed"})]})]}),l("div",{class:"selectors-container",children:[(b==="tv"||b==="anime")&&e&&e.seasons&&l("div",{class:"select-container",children:[l("label",{children:"Season:"}),l("div",{class:"selector-buttons",children:e.seasons.filter(k=>k.season_number>0).map(k=>l("button",{class:`selector-btn ${p===k.season_number?"active":""}`,onClick:()=>{console.log(` User manually selected season ${k.season_number}`),W.current=!0,le.current=null;const F=`/watch/${b}/${M}/season/${k.season_number}/episode/1`;$e(F,!0)},children:k.name},k.id))})]}),_.length>1&&l("div",{class:"select-container",children:[l("label",{children:"Source:"}),l("div",{class:"selector-buttons",children:_.map(k=>l("button",{class:`selector-btn ${w===k?"active":""}`,onClick:()=>T(k),children:k},k))})]})]}),(b==="tv"||b==="anime")&&p!==null&&m!==null&&l("div",{class:"episodes-container",children:[l("h3",{children:"Episodes"}),L?l("div",{class:"loading-spinner"}):l(ht,{children:[l("div",{class:"episode-list",children:E?.episodes?.slice((O-1)*C,O*C)?.map(k=>{const F=bt.find(Y=>Y.season_number===p&&Y.episode_number===k.episode_number),R=F&&F.progress_seconds>0?F.duration_seconds&&F.duration_seconds>0?Math.min(100,F.progress_seconds/F.duration_seconds*100):F.progress_seconds>30?5:2:0;return l("div",{class:`episode-card ${k.episode_number===m?"active":""}`,onClick:()=>{console.log(` User manually selected episode ${k.episode_number}`),W.current=!0,le.current=null;const Y=`/watch/${b}/${M}/season/${p}/episode/${k.episode_number}`;$e(Y,!0)},children:[l("div",{class:"episode-card-image",children:[l("img",{src:Un(k.still_path?`${Nn}${k.still_path}`:`https://via.placeholder.com/300x169.png?text=${encodeURIComponent(k.name)}`),alt:k.name}),l("div",{class:"episode-number-badge",children:k.episode_number}),R>0&&l("div",{class:"episode-progress-bar",children:l("div",{class:"episode-progress",style:{width:`${Math.max(2,R)}%`}})})]}),l("div",{class:"episode-card-content",children:[l("h4",{children:k.name}),l("p",{class:"episode-overview",children:k.overview})]})]},k.id)})}),E?.episodes&&E.episodes.length>C&&l("div",{class:"pagination-controls",children:[l("button",{class:"pagination-btn",onClick:()=>N(k=>Math.max(1,k-1)),disabled:O===1,children:" Previous"}),l("div",{class:"pagination-info",children:[l("span",{class:"page-numbers",children:Array.from({length:Math.ceil(E.episodes.length/C)},(k,F)=>F+1).map(k=>l("button",{class:`page-number ${k===O?"active":""}`,onClick:()=>N(k),children:k},k))}),l("span",{class:"page-text",children:["Page ",O," of ",Math.ceil(E.episodes.length/C),"(",E.episodes.length," episodes)"]})]}),l("button",{class:"pagination-btn",onClick:()=>N(k=>Math.min(Math.ceil(E.episodes.length/C),k+1)),disabled:O===Math.ceil(E.episodes.length/C),children:"Next "})]})]})]}),i.length>0&&l("div",{class:"recommendations",children:[l("h2",{children:"More Like This"}),l("div",{class:"movie-grid",children:i.map(k=>l(mt,{item:k,type:b,progress:null,duration:null},`${k.media_type||b}-${k.id}`))})]})]})]})},Fu=n=>{const[e,t]=U([]),[r,s]=U(!1),[i,o]=U("");se(()=>{const u=new URLSearchParams(n.url?.split("?")[1]||"").get("q");o(u||""),u?a(u):t([])},[n.url]);const a=async c=>{s(!0);try{const h=await(await fetch(`${we}/tmdb/search/multi?query=${encodeURIComponent(c)}`)).json();if(h&&h.results){const d=h.results.filter(f=>(f.media_type==="movie"||f.media_type==="tv")&&f.poster_path);t(d)}}catch(u){console.error("Error performing search:",u),t([])}finally{s(!1)}};return l("div",{class:"container home-page",children:[l("div",{class:"search-header",children:[l("h1",{class:"main-title",children:"Search Results"}),l("div",{class:"search-query-display",children:[l("span",{class:"search-label",children:"Showing results for:"}),l("span",{class:"search-query",children:['"',i,'"']})]})]}),r?l(qo,{text:"Searching for movies and TV shows..."}):e.length>0?l("section",{class:"home-section",children:[l("h2",{children:["Found ",e.length," result",e.length!==1?"s":""]}),l("div",{class:"movie-grid",children:e.map(c=>l(mt,{item:c,type:c.media_type,progress:null,duration:null},`${c.media_type}-${c.id}`))})]}):i?l("div",{class:"no-results",children:[l("div",{class:"no-results-icon",children:""}),l("h3",{children:"No results found"}),l("p",{children:[`We couldn't find anything for "`,i,'". Try searching with different keywords.']}),l("div",{class:"search-suggestions",children:[l("p",{children:"Try searching for:"}),l("ul",{children:[l("li",{children:"Movie or TV show titles"}),l("li",{children:"Actor or director names"}),l("li",{children:'Genre names (e.g., "action", "comedy")'}),l("li",{children:"Keywords from the plot"})]})]})]}):l("div",{class:"search-welcome",children:[l("div",{class:"search-welcome-icon",children:""}),l("h3",{children:"Start your search"}),l("p",{children:"Use the search bar above to find your favorite movies and TV shows."})]})]})};function bn(){const[n,e]=U(!1),[t,r]=U(""),[s,i]=U(""),[o,a]=U(!1),[c,u]=U({}),h=async p=>{try{const{error:g}=await K.auth.signInWithOAuth({provider:p});if(g)throw g}catch(g){Me.error(g.error_description||g.message)}},d=()=>{const p={};return t?/\S+@\S+\.\S+/.test(t)||(p.email="Please enter a valid email"):p.email="Email is required",s?s.length<6&&(p.password="Password must be at least 6 characters"):p.password="Password is required",u(p),Object.keys(p).length===0},f=async p=>{if(p.preventDefault(),!!d())try{e(!0),u({});const{error:g}=await K.auth.signInWithPassword({email:t.trim(),password:s});if(g)throw g;Me.success("Logged in successfully!"),$e("/",!0)}catch(g){console.error("Login error:",g),g.message.includes("Invalid login credentials")?u({general:"Invalid email or password"}):g.message.includes("Email not confirmed")?u({general:"Please check your email and confirm your account"}):u({general:g.error_description||g.message})}finally{e(!1)}};return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Login"}),l("p",{className:"description",children:"Sign in to your account."}),c.general&&l("div",{className:"error-message",children:c.general}),l("form",{onSubmit:f,noValidate:!0,children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:`input-field ${c.email?"error":""}`,type:"email",placeholder:"Your email",value:t,onChange:p=>{r(p.target.value),c.email&&u({...c,email:null})},required:!0,"aria-describedby":c.email?"email-error":void 0,"aria-invalid":!!c.email}),c.email&&l("span",{id:"email-error",className:"field-error",role:"alert",children:c.email})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"Password"}),l("div",{className:"password-input-container",children:[l("input",{id:"password",className:`input-field ${c.password?"error":""}`,type:o?"text":"password",placeholder:"Your password",value:s,onChange:p=>{i(p.target.value),c.password&&u({...c,password:null})},required:!0,"aria-describedby":c.password?"password-error":void 0,"aria-invalid":!!c.password}),l("button",{type:"button",className:"password-toggle",onClick:()=>a(!o),"aria-label":o?"Hide password":"Show password",children:o?"Hide":"Show"})]}),c.password&&l("span",{id:"password-error",className:"field-error",role:"alert",children:c.password})]}),l("div",{className:"auth-options",children:l("a",{href:"/forgot-password",className:"auth-link",children:"Forgot password?"})}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Signing in..."}):l("span",{children:"Login"})})})]}),l("div",{className:"auth-divider",children:l("span",{children:"OR"})}),l("div",{className:"social-login-group",children:l("button",{type:"button",className:"social-button google",onClick:()=>h("google"),children:"Sign in with Google"})}),l("div",{className:"auth-links",children:l("p",{children:["Don't have an account?",l("a",{href:"/signup",className:"auth-link",children:" Sign up"})]})})]})})}function Bu(){const[n,e]=U(!1),[t,r]=U(""),[s,i]=U(""),o=async c=>{try{const{error:u}=await K.auth.signInWithOAuth({provider:c});if(u)throw u}catch(u){Me.error(u.error_description||u.message)}};return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Create an account"}),l("p",{className:"description",children:"Sign up for a new account."}),l("form",{onSubmit:async c=>{c.preventDefault();try{e(!0);const{error:u}=await K.auth.signUp({email:t,password:s});if(u)throw u;Me.success("Check your email for the confirmation link!")}catch(u){Me.error(u.error_description||u.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:c=>r(c.target.value)})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"Password"}),l("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:c=>i(c.target.value)})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Loading..."}):l("span",{children:"Sign Up"})})})]}),l("div",{className:"auth-divider",children:l("span",{children:"OR"})}),l("div",{className:"social-login-group",children:l("button",{type:"button",className:"social-button google",onClick:()=>o("google"),children:"Sign up with Google"})}),l("div",{className:"auth-links",children:l("p",{children:["Already have an account?",l("a",{href:"/login",className:"auth-link",children:" Log in"})]})})]})})}function Wu(){const[n,e]=U(!1),[t,r]=U("");return l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Forgot Password"}),l("p",{className:"description",children:"Enter your email and we'll send you a link to reset your password."}),l("form",{onSubmit:async i=>{i.preventDefault();try{e(!0);const{error:o}=await K.auth.resetPasswordForEmail(t,{redirectTo:`${window.location.origin}/update-password`});if(o)throw o;Me.success("Password reset link sent! Please check your email.")}catch(o){Me.error(o.error_description||o.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"email",children:"Email"}),l("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:i=>r(i.target.value),required:!0})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Sending..."}):l("span",{children:"Send Reset Link"})})})]}),l("div",{className:"auth-links",children:l("a",{href:"/login",className:"auth-link",children:["Remembered your password? ",l("span",{children:"Log in"})]})})]})})}function Hu(){const[n,e]=U(!1),[t,r]=U(""),[s,i]=U(""),[o,a]=U(""),[c,u]=U(null);return se(()=>{K.auth.getSession().then(({data:{session:f}})=>{f?u(f):(Me.error("You must be logged in to update your password."),$e("/login",!0))});const{data:{subscription:d}}=K.auth.onAuthStateChange((f,p)=>{u(p)});return()=>d.unsubscribe()},[]),l("div",{className:"auth-container",children:l("div",{className:"auth-form",children:[l("h1",{className:"header",children:"Update Password"}),l("p",{className:"description",children:"Enter a new password for your account."}),o&&l("div",{className:"error-message",children:o}),l("form",{onSubmit:async d=>{if(d.preventDefault(),a(""),t!==s){a("Passwords do not match.");return}if(t.length<6){a("Password must be at least 6 characters long.");return}try{e(!0);const{error:f}=await K.auth.updateUser({password:t});if(f)throw f;Me.success("Password updated successfully!"),$e("/",!0)}catch(f){a(f.error_description||f.message)}finally{e(!1)}},children:[l("div",{className:"input-group",children:[l("label",{htmlFor:"password",children:"New Password"}),l("input",{id:"password",className:"input-field",type:"password",placeholder:"Your new password",value:t,onChange:d=>r(d.target.value),required:!0})]}),l("div",{className:"input-group",children:[l("label",{htmlFor:"confirm-password",children:"Confirm New Password"}),l("input",{id:"confirm-password",className:"input-field",type:"password",placeholder:"Confirm your new password",value:s,onChange:d=>i(d.target.value),required:!0})]}),l("div",{children:l("button",{className:"button",disabled:n,children:n?l("span",{children:"Updating..."}):l("span",{children:"Update Password"})})})]})]})})}const Gu=()=>{const[n,e]=U(!1);return se(()=>{const r=()=>{window.pageYOffset>300?e(!0):e(!1)};return window.addEventListener("scroll",r),()=>window.removeEventListener("scroll",r)},[]),l("button",{class:`scroll-to-top ${n?"visible":""}`,onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},"aria-label":"Scroll to top",children:l("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l("path",{d:"M18 15l-6-6-6 6"})})})},Ku=()=>{const{user:n}=et();return l("div",{class:"app",children:[l(Ic,{position:"top-center"}),l(Dc,{}),l("main",{children:l(fo,{history:Ta(),children:[l(hr,{path:"/"}),l(hr,{path:"/movies"}),l(hr,{path:"/tv"}),n?l(qu,{path:"/favorites"}):l(bn,{path:"/favorites"}),n?l(Mu,{path:"/history"}):l(bn,{path:"/history"}),l(oo,{path:"/watch/:type/:id"}),l(oo,{path:"/watch/:type/:id/season/:season/episode/:episode"}),l(Fu,{path:"/search"}),l(bn,{path:"/login"}),l(Bu,{path:"/signup"}),l(Wu,{path:"/forgot-password"}),l(Hu,{path:"/update-password"})]})}),l(qc,{}),l(Gu,{})]})},Vu=()=>(se(()=>{Nc()},[]),l(jc,{children:l(Ku,{})}));ha(l(Vu,{}),document.getElementById("app"));
//# sourceMappingURL=index-Dx0Ouq81.js.map
