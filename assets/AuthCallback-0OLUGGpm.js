import{t as a,$ as t,s as p,u as r,L as v}from"./index-Db6xGWP3.js";import{d as A,y as S,k as w}from"./react-vendor-BYlzYzcd.js";function R(){const[T,o]=A("processing"),[y,s]=A("Processing authentication...");return S(()=>{let e;return(async()=>{e=setTimeout(()=>{console.error("âš ï¸ Auth callback timeout"),o("error"),s("Authentication is taking too long. Please try again."),a.error("Authentication timeout. Redirecting..."),setTimeout(()=>t("/login",!0),2e3)},1e4);try{const i=new URLSearchParams(window.location.hash.substring(1)),d=i.get("access_token"),h=i.get("refresh_token"),g=i.get("type"),f=i.get("error"),P=i.get("error_description");if(f){clearTimeout(e),console.error("Auth callback error:",f,P),o("error"),s(P||f),a.error(P||f),setTimeout(()=>t("/login",!0),3e3);return}if(g==="signup"||g==="email_confirmation")if(d&&h){console.log("ðŸ“§ Setting session from email confirmation...");const l=p.auth.setSession({access_token:d,refresh_token:h}),u=new Promise((m,k)=>{setTimeout(()=>k(new Error("Session setup timeout")),8e3)}),{data:n,error:c}=await Promise.race([l,u]);if(c){clearTimeout(e),console.error("Session error:",c),o("error"),s("Failed to confirm email. Please try again."),a.error("Failed to confirm email. Please try again."),setTimeout(()=>t("/login",!0),3e3);return}n.user?(clearTimeout(e),console.log("âœ… Email confirmed successfully"),o("success"),s("Email confirmed successfully! Redirecting..."),a.success("Email confirmed successfully!"),window.location.hash="",await new Promise(m=>setTimeout(m,500)),setTimeout(()=>t("/",!0),1500)):(clearTimeout(e),o("error"),s("Authentication failed. Please try logging in."),setTimeout(()=>t("/login",!0),3e3))}else clearTimeout(e),o("error"),s("Invalid confirmation link. Please try again."),setTimeout(()=>t("/login",!0),3e3);else if(g==="recovery"||g==="password_recovery")if(d&&h){const l=p.auth.setSession({access_token:d,refresh_token:h}),u=new Promise((c,m)=>{setTimeout(()=>m(new Error("Recovery session timeout")),8e3)}),{error:n}=await Promise.race([l,u]);if(n){clearTimeout(e),console.error("Recovery session error:",n),o("error"),s("Invalid recovery link. Please try again."),setTimeout(()=>t("/forgot-password",!0),3e3);return}clearTimeout(e),o("success"),s("Recovery link verified! Redirecting to update password..."),setTimeout(()=>t("/update-password",!0),2e3)}else clearTimeout(e),o("error"),s("Invalid recovery link. Please try again."),setTimeout(()=>t("/forgot-password",!0),3e3);else{const l=p.auth.getSession(),u=new Promise((m,k)=>{setTimeout(()=>k(new Error("Session check timeout")),5e3)}),{data:n,error:c}=await Promise.race([l,u]);if(c){clearTimeout(e),console.error("Session check error:",c),o("error"),s("Authentication failed. Please try logging in."),setTimeout(()=>t("/login",!0),3e3);return}n.session?(clearTimeout(e),o("success"),s("Authentication successful! Redirecting..."),a.success("Authentication successful!"),setTimeout(()=>t("/",!0),2e3)):(clearTimeout(e),o("error"),s("No active session found. Please try logging in."),setTimeout(()=>t("/login",!0),3e3))}}catch(i){clearTimeout(e),console.error("Auth callback error:",i),o("error"),s(i.message.includes("timeout")?"Authentication is taking too long. Please check your connection and try again.":"An unexpected error occurred. Please try again."),a.error("Authentication failed. Please try again."),setTimeout(()=>t("/login",!0),3e3)}})(),()=>{e&&clearTimeout(e)}},[]),r("div",{className:"auth-callback-container",children:r("div",{className:"auth-callback-content",children:[T==="processing"&&r(w,{children:[r(v,{}),r("h2",{children:"Processing Authentication"}),r("p",{children:y})]}),T==="success"&&r(w,{children:[r("div",{className:"success-icon",children:"âœ“"}),r("h2",{children:"Success!"}),r("p",{children:y})]}),T==="error"&&r(w,{children:[r("div",{className:"error-icon",children:"âœ—"}),r("h2",{children:"Authentication Failed"}),r("p",{children:y}),r("p",{className:"redirect-note",children:"You will be redirected shortly..."})]})]})})}export{R as default};
//# sourceMappingURL=AuthCallback-0OLUGGpm.js.map
