import{O as W,A as g,u as e,a as K,b as Q,p as X,I as P,m as Z}from"./index-DJKKYvGv.js";import{E as ee,d as m,y as te}from"./react-vendor-BYlzYzcd.js";import{r as ne,a as se}from"./favorites-7Q9RYkW7.js";import{M as ie}from"./MovieCard-BNWtjiUN.js";/* empty css                  */async function L(n){try{const t=await fetch(n);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.error("Fetch error:",t),null}}function U(n,t){const a=t==="movie",r=a?n.title:n.name;a?n.release_date:n.first_air_date;const i=n.media_type||t,d=document.createElement("div");return d.className="movie-card",d.innerHTML=`
        <a href="movie.html?id=${n.id}&type=${i}">
            <img src="${g}${n.poster_path}" alt="${r}" loading="lazy">
            <div class="movie-card-info">
                <h3>${r}</h3>
                <p>⭐ ${n.vote_average.toFixed(1)}</p>
            </div>
        </a>
    `,d.innerHTML}function x(){const n=document.getElementById("search-input"),t=document.getElementById("search-button"),a=()=>{const r=n.value.trim();r&&(window.location.href=`search.html?q=${encodeURIComponent(r)}`)};t&&t.addEventListener("click",a),n&&n.addEventListener("keypress",r=>{r.key==="Enter"&&a()})}document.addEventListener("DOMContentLoaded",()=>{({currentMediaType:"movie",heroSlideshowInterval:null,elements:{heroSection:document.getElementById("hero"),contentDisplay:document.getElementById("content-display"),genreResultsSection:document.getElementById("genre-results"),navLinks:document.querySelectorAll("header nav a[data-type]"),genreBar:document.getElementById("genre-bar"),trendingMoviesGrid:document.querySelector("#trending-movies .movie-grid"),topRatedMoviesGrid:document.querySelector("#top-rated-movies .movie-grid"),trendingTvGrid:document.querySelector("#trending-tv .movie-grid"),topRatedTvGrid:document.querySelector("#top-rated-tv .movie-grid"),genreResultsGrid:document.getElementById("genre-results-grid"),genreResultsTitle:document.getElementById("genre-results-title"),paginationContainer:document.getElementById("pagination"),continueWatchingSection:document.getElementById("continue-watching")},init(){this.displayContinueWatching(),this.setupEventListeners(),this.switchView(this.currentMediaType),this.elements.navLinks[0].classList.add("active"),x()},setupEventListeners(){this.elements.navLinks.forEach(t=>{t.addEventListener("click",a=>{a.preventDefault(),this.switchView(t.dataset.type)})})},switchView(t){this.currentMediaType=t,this.elements.navLinks.forEach(a=>{a.classList.toggle("active",a.dataset.type===t)}),this.elements.contentDisplay.classList.remove("hidden"),this.elements.genreResultsSection.classList.add("hidden"),this.fetchAndDisplaySections(t),this.fetchAndDisplayGenres(t)},async fetchAndDisplaySections(t){this.toggleSectionVisibility(t);const a=t==="movie"?this.elements.trendingMoviesGrid:this.elements.trendingTvGrid,r=t==="movie"?this.elements.topRatedMoviesGrid:this.elements.topRatedTvGrid;a.innerHTML="<p>Loading...</p>",r.innerHTML="<p>Loading...</p>";const i=`${g}/trending/${t}/week`,d=`${g}/${t}/top_rated?language=en-US&page=1`,[l,y]=await Promise.all([L(i),L(d)]);l&&l.results&&(this.displayGrid(l.results,a,t),this.startHeroSlideshow(l.results.slice(0,5),t)),y&&y.results&&this.displayGrid(y.results,r,t)},displayGrid(t,a,r){if(!t||t.length===0){a.innerHTML="<p>No items to display.</p>";return}a.innerHTML=t.map(i=>U(i,r)).join(""),attachFavoriteListeners()},toggleSectionVisibility(t){const a=t==="movie";document.getElementById("trending-movies").style.display=a?"block":"none",document.getElementById("top-rated-movies").style.display=a?"block":"none",document.getElementById("trending-tv").style.display=a?"none":"block",document.getElementById("top-rated-tv").style.display=a?"none":"block"},updateHeroContent(t,a){this.elements.heroSection.style.backgroundImage=`linear-gradient(to right, rgba(0, 0, 0, 0.7) 30%, transparent), url(${W}${t.backdrop_path})`;const r=a==="movie"?t.title:t.name,i=`movie.html?id=${t.id}&type=${a}`;this.elements.heroSection.innerHTML=`
                <div class="hero-content">
                    <h1 class="hero-title">${r}</h1>
                    <p class="hero-overview">${t.overview}</p>
                    <a href="${i}" class="btn btn-primary">▶ Watch Now</a>
                </div>
            `},startHeroSlideshow(t,a){if(!t||t.length===0)return;let r=0;this.updateHeroContent(t[r],a),clearInterval(this.heroSlideshowInterval),this.heroSlideshowInterval=setInterval(()=>{r=(r+1)%t.length,this.updateHeroContent(t[r],a)},7e3)},async fetchAndDisplayGenres(t){const a=`${g}/genre/${t}/list?language=en-US`,r=await L(a);!r||!r.genres||(this.elements.genreBar.innerHTML='<button class="genre-btn active" data-genre-id="all">All Genres</button>'+r.genres.map(i=>`<button class="genre-btn" data-genre-id="${i.id}">${i.name}</button>`).join(""),this.elements.genreBar.querySelectorAll(".genre-btn").forEach(i=>{i.addEventListener("click",()=>{this.elements.genreBar.querySelector(".genre-btn.active").classList.remove("active"),i.classList.add("active");const d=i.dataset.genreId,l=i.textContent;d==="all"?(this.elements.contentDisplay.classList.remove("hidden"),this.elements.genreResultsSection.classList.add("hidden")):this.fetchAndDisplayByGenre(t,d,l)})}))},async fetchAndDisplayByGenre(t,a,r,i=1){const d=`${g}/discover/${t}?with_genres=${a}&language=en-US&page=${i}`,l=await L(d);l&&(this.elements.contentDisplay.classList.add("hidden"),this.elements.genreResultsSection.classList.remove("hidden"),this.elements.genreResultsTitle.textContent=`${r}`,this.displayGrid(l.results,this.elements.genreResultsGrid,t),this.setupPagination(t,a,r,i,l.total_pages))},setupPagination(t,a,r,i,d){if(this.elements.paginationContainer.innerHTML="",d<=1)return;const l=(p,v,_=!1)=>{const k=document.createElement("button");return k.textContent=v,k.disabled=_,_||k.addEventListener("click",()=>this.fetchAndDisplayByGenre(t,a,r,p)),k};i>1&&this.elements.paginationContainer.appendChild(l(i-1,"« Prev"));const y=Math.max(1,i-2),c=Math.min(d,i+2);for(let p=y;p<=c;p++){const v=l(p,p);p===i&&(v.classList.add("active"),v.disabled=!0),this.elements.paginationContainer.appendChild(v)}i<d&&this.elements.paginationContainer.appendChild(l(i+1,"Next »"))},displayContinueWatching(){const t=getHistory();if(!t||t.length===0){this.elements.continueWatchingSection.classList.add("hidden");return}this.elements.continueWatchingSection.classList.remove("hidden");let r=t.slice(0,10).map(i=>{const d=U(i,i.type),l=document.createElement("div");l.innerHTML=d;const y=l.querySelector(".movie-info");let c=0;if(i.type==="movie"&&i.progress)c=i.progress;else if(i.type==="tv"&&i.watchedEpisodes){const p=Object.keys(i.watchedEpisodes).length,v=Object.values(i.watchedEpisodes).filter(_=>_.status==="completed").length;p>0&&(c=v/p*100)}return y&&c>0&&(y.innerHTML+=`<div class="progress-bar-container"><div class="progress-bar" style="width: ${c}%;"></div></div>`),l.innerHTML}).join("");this.elements.continueWatchingSection.innerHTML=`
                <h2>Continue Watching</h2>
                <div class="movie-grid">${r}</div>
            `,attachFavoriteListeners()}}).init()});const ae=()=>{const[n,t]=m(null),[a,r]=m([]),[i,d]=m([]),[l,y]=m(null),[c,p]=m(null),{isShowFavorited:v}=K(),{user:_,session:k}=Q(),[$,D]=m(null),[re,q]=m(null),[F,G]=m(!0),[H,j]=m(!1),[A,R]=m(1),[I,C]=m(1);te(()=>{const s=window.location.pathname.split("/"),o=s[1],h=s[2];y(h),p(o);const b=X().find(S=>S.id==h);b&&q(b),h&&o&&N(h,o),x()},[l]);const N=async(s,o)=>{G(!0);const h=`${g}/tmdb/${o}/${s}?language=en-US`,b=`${g}/tmdb/${o}/${s}/videos?language=en-US`,S=`${g}/tmdb/${o}/${s}/recommendations?language=en-US`;try{const[f,E,w]=await Promise.all([L(h,"Error loading media details"),L(b,"Error loading videos"),L(S,"Error loading recommendations")]);if(t(f),r(E?.results||[]),d(w?.results||[]),o==="tv"&&f&&f.seasons){const B=await T(s,f.seasons[0].season_number);D(B)}}catch(f){console.error("Failed to fetch page data",f)}finally{G(!1)}},T=async(s,o)=>{const h=`${g}/tmdb/tv/${s}/season/${o}?language=en-US`;return await L(h)},V=async s=>{const o=await T(l,s);D(o),R(1),C(1)},O=()=>{const s={id:n.id,type:c,title:n.name||n.title,poster_path:n.poster_path,vote_average:n.vote_average};v(n.id,c)?ne(s):se(s)},M=(s,o=null,h=null,b=!1)=>{const S=document.getElementById("video-player");if(!S)return;const f={id:n.id,type:c,title:n.name||n.title,poster_path:n.poster_path,vote_average:n.vote_average};_?.id&&Z(_.id,f,0,0,!1,k);let E="";c==="movie"?E=`${g}/stream-url?source=${s}&type=movie&id=${l}`:c==="tv"&&(E=`${g}/stream-url?source=${s}&type=tv&id=${l}&season=${o}&episode=${h}&dub=${b}`),fetch(E).then(w=>w.json()).then(w=>{w.url&&(S.src=w.url)})},z=()=>{const s=a.find(o=>o.type==="Trailer"&&o.site==="YouTube");return s?e("div",{id:"trailer-modal",class:"modal",children:e("div",{class:"modal-content",children:[e("span",{class:"close-button",onClick:()=>document.getElementById("trailer-modal").style.display="none",children:"×"}),e("iframe",{width:"560",height:"315",src:`https://www.youtube.com/embed/${s.key}`,frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; fullscreen; picture-in-picture",allowfullscreen:!0})]})}):null};if(F)return e("div",{class:"loading-spinner"});if(!n)return e("p",{class:"container",children:"Could not load media details. Please try again later."});const J=n.backdrop_path?`${W}${n.backdrop_path}`:"";return e("div",{children:[e("div",{id:"backdrop",style:{backgroundImage:`url(${J})`}}),e("main",{class:"container",id:"media-details-content",children:[e("section",{id:"media-header",children:[e("div",{class:"poster",children:e("img",{src:`${P}${n.poster_path}`,alt:n.title||n.name})}),e("div",{class:"info",children:[e("div",{class:"title-container",children:[e("h1",{children:n.title||n.name}),e("button",{id:"favorite-btn",class:v(n.id,c)?"favorited":"",onClick:O,children:v(n.id,c)?"♥ Favorited":"♡ Add to Favorites"})]}),e("div",{class:"meta",children:[e("span",{children:n.release_date||n.first_air_date}),e("span",{children:n.genres.map(s=>s.name).join(", ")}),n.runtime&&e("span",{children:[n.runtime," min"]}),e("span",{class:"rating",children:["★ ",n.vote_average.toFixed(1)]})]}),e("p",{class:"overview",children:n.overview}),e("div",{class:"actions",children:a.find(s=>s.type==="Trailer")&&e("button",{id:"watch-trailer-btn",onClick:()=>document.getElementById("trailer-modal").style.display="block",children:"Watch Trailer"})})]})]}),e("section",{id:"playback",children:[e("h2",{children:"Watch Now"}),e("div",{class:"server-selection",children:[e("button",{class:"server-btn active",onClick:s=>M(s.target.dataset.server),"data-server":"videasy",children:"Videasy"}),e("button",{class:"server-btn",onClick:s=>M(s.target.dataset.server),"data-server":"vidsrc",children:"VidSrc"}),e("button",{class:"server-btn",onClick:s=>M(s.target.dataset.server),"data-server":"embedsu",children:"Embeds.su"})]}),e("div",{class:"video-container",children:e("iframe",{id:"video-player",allowfullscreen:!0})}),c==="tv"&&e("div",{class:"select-container",children:[e("label",{for:"dub-select",children:"Audio:"}),e("select",{id:"dub-select",value:H,onChange:s=>{j(s.target.value==="true");const o=document.querySelector(".server-btn.active").dataset.server,h=$?.episodes?.[0]?.episode_number||1;M(o,$?.season_number,h,s.target.value==="true")},children:[e("option",{value:"false",children:"Subbed"}),e("option",{value:"true",children:"Dubbed"})]})]})]}),c==="tv"&&n.seasons&&e("section",{id:"seasons-episodes",children:[e("h2",{children:"Seasons & Episodes"}),e("div",{class:"seasons-container",children:n.seasons.filter(s=>s.season_number>0).map(s=>e("div",{class:`season-card ${$?.season_number===s.season_number?"active":""}`,onClick:()=>V(s.season_number),children:[e("img",{src:s.poster_path?`${P}${s.poster_path}`:"https://via.placeholder.com/130x200?text=No+Image",alt:s.name}),e("span",{children:s.name})]}))}),$&&(()=>{const s=$.episodes.length,o=Math.ceil(s/episodesPerPage),h=Math.ceil(o/pagesPerPagination),b=(A-1)*episodesPerPage,S=b+episodesPerPage,f=$.episodes.slice(b,S),E=(I-1)*pagesPerPagination,w=E+pagesPerPagination,B=Array.from({length:o},(u,Y)=>Y+1).slice(E,w);return e("div",{children:[e("div",{class:"episodes-container",children:[e("h3",{children:$.name}),f.map(u=>e("div",{class:"episode-card",onClick:()=>M(document.querySelector(".server-btn.active").dataset.server,$.season_number,u.episode_number,H),children:[e("div",{class:"episode-thumbnail",children:e("img",{src:u.still_path?`${P}${u.still_path}`:"https://via.placeholder.com/150x84?text=No+Image",alt:u.name})}),e("div",{class:"episode-info",children:[e("h4",{children:[u.episode_number,". ",u.name]}),e("p",{children:u.overview})]})]}))]}),o>1&&e("div",{class:"pagination-controls",children:[I>1&&e("button",{onClick:()=>C(I-1),children:e("i",{class:"fas fa-angle-double-left"})}),B.map(u=>e("button",{class:A===u?"active":"",onClick:()=>R(u),children:u},u)),I<h&&e("button",{onClick:()=>C(I+1),children:e("i",{class:"fas fa-angle-double-right"})})]})]})})()]}),i.length>0&&e("section",{id:"recommendations",children:[e("h2",{children:"Recommendations"}),e("div",{class:"movie-grid",children:i.map(s=>e(ie,{item:s,type:c}))})]})]}),z()]})};ee(e(ae,{}),document.getElementById("app"));
//# sourceMappingURL=movie-oz0LVctZ.js.map
