import{b as E,u as e,g as p,s as b,t as s,$ as F}from"./index-Db6xGWP3.js";import{d as l,A as D,y as L}from"./react-vendor-BYlzYzcd.js";const A=(r,t)=>r?.avatar_url?p(r.avatar_url):t?.user_metadata?.picture?p(t.user_metadata.picture):t?.user_metadata?.avatar_url?p(t.user_metadata.avatar_url):"/assets/default-avatar.png",W=()=>{const{user:r,profile:t,updateUser:N}=E(),[d,v]=l(t?.full_name||r?.user_metadata?.full_name||""),[_,u]=l(()=>A(t,r)),[c,S]=l(null),[U,g]=l(!1),[w,m]=l("Save Changes"),[x,f]=l(!1),C=D();return L(()=>{u(A(t,r)),f(!1),t?.full_name!==d&&v(t.full_name||"")},[t,r]),r?e("div",{className:"profile-container",children:e("div",{className:"profile-form",style:{maxWidth:420},children:e("form",{onSubmit:async n=>{n.preventDefault(),g(!0),m("Saving...");try{let a=null;if(c){const o=c.name.split(".").pop(),h=`${r.id}/avatar.${o}`,{error:y}=await b.storage.from("avatars").upload(h,c,{upsert:!0,cacheControl:"3600"});if(y)throw y;const{data:P}=b.storage.from("avatars").getPublicUrl(h);a=`${P.publicUrl}?t=${new Date().getTime()}`}const i={data:{full_name:d,...a&&{avatar_url:a}}};console.log("Starting profile update...",i),N({...i,id:r.id}).catch(o=>{console.warn("Update response error (likely timeout, update still succeeded):",o)}),s.success("Profile updated successfully!"),m("Saved!"),console.log("Profile saved, redirecting to home..."),setTimeout(()=>{console.log("Redirecting now..."),F("/",!0)},800)}catch(a){console.error("Profile update failed:",a),s.error(a.message||"An error occurred while updating your profile."),m("Save Changes"),g(!1)}},children:[e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:e("label",{htmlFor:"avatar-upload",style:{cursor:"pointer"},children:[e("img",{src:x?"/assets/default-avatar.png":_,alt:"Profile avatar",onError:()=>{console.warn("Avatar failed to load, using default"),f(!0),u("/assets/default-avatar.png")},style:{width:96,height:96,borderRadius:"50%",objectFit:"cover",marginBottom:8,border:"2px solid var(--brand-primary)"}}),e("input",{id:"avatar-upload",type:"file",accept:"image/*",style:{display:"none"},ref:C,onChange:n=>{const a=n.target.files[0];if(!a)return;if(!a.type.startsWith("image/")){s.error("Please select a valid image file.");return}if(a.size>50*1024*1024){s.error("Avatar must be less than 50MB.");return}S(a),f(!1);const i=new FileReader;i.onload=o=>u(o.target.result),i.readAsDataURL(a)},"aria-label":"Change profile picture"}),e("div",{style:{color:"var(--brand-primary)",fontSize:14,textAlign:"center"},children:"Change Avatar"})]})}),e("div",{className:"input-group",children:[e("label",{htmlFor:"full-name",children:"Full Name"}),e("input",{id:"full-name",className:"input-field",type:"text",value:d,onInput:n=>v(n.target.value),placeholder:"Your name",maxLength:40,required:!0})]}),e("div",{className:"input-group",children:[e("label",{children:"Email"}),e("input",{className:"input-field",type:"email",value:r.email,disabled:!0,readOnly:!0})]}),e("button",{className:"button",type:"submit",disabled:U,style:{marginTop:16},children:w})]})})}):e("div",{className:"profile-container",children:e("div",{className:"profile-form",children:e("h2",{children:"Not logged in"})})})};export{W as default};
//# sourceMappingURL=Profile-LSbmvDxD.js.map
