import{b as G,a as H,A as R,i as W,$ as L,u as n,L as U}from"./index-DJKKYvGv.js";import{d as r,y as g,q as f}from"./react-vendor-BYlzYzcd.js";/* empty css                  */import{A as D}from"./AnimeCard-DiEp6bkk.js";/* empty css             */const X=()=>{const[y,v]=r(!0),[A,V]=r([]),[x,F]=r([]),[w,N]=r([]),[b,M]=r([]),[$,h]=r(null),[k,C]=r(!0),{user:s}=G(),{continueWatching:O,continueWatchingFetched:S,fetchContinueWatching:T}=H();g(()=>{s&&!S&&T(s.id)},[s,S,T]);const E=O.filter(e=>e.type==="anime"),p=f(async(e=3)=>{try{const i=await fetch(`${R}/trending/anime/combined`);if(!i.ok)throw new Error(`API error: ${i.status}`);return i.json()}catch(i){return console.error("Error fetching combined anime data:",i),e>0?(await new Promise(a=>setTimeout(a,1e3*(4-e))),p(e-1)):null}},[]),P=f(async e=>{let i,a,t;if(e.source==="tmdb"){if(i=e.media_type||"tv",a=e.tmdb_id||e.id,t=`/watch/${i}/${a}`,i==="tv")if(s){const o=await W(s.id,a);o?t+=`/season/${o.season}/episode/${o.episode}`:t+="/season/1/episode/1"}else t+="/season/1/episode/1"}else if(i="anime",a=e.anilist_id||e.id,t=`/watch/anime/${a}`,s){const o=await W(s.id,a);o?t+=`/season/${o.season}/episode/${o.episode}`:t+="/season/1/episode/1"}else t+="/season/1/episode/1";L(t)},[s]),m=f(async()=>{try{const e=await fetch(`${R}/health/videasy`,{method:"GET",signal:AbortSignal.timeout(5e3)});C(e.ok)}catch(e){console.warn("Videasy availability check failed:",e),C(!1)}},[]);g(()=>{m()},[m]),g(()=>{(async()=>{v(!0),h(null);try{const i=await p();if(i){const a=c=>c.filter(l=>l.poster_path);V(a(i.combined||[]).slice(0,20)),F(a(i.seasonal||[]));const t=a(i.combined||[]),o=[...t].sort((c,l)=>(l.popularity||0)-(c.popularity||0));N(o.slice(0,20));const B=[...t].sort((c,l)=>(l.vote_average||0)-(c.vote_average||0));M(B.slice(0,20))}else throw new Error("Failed to fetch any anime data.")}catch(i){console.error("Error fetching anime data:",i),h("Failed to load anime data. Please refresh the page.")}finally{v(!1)}})()},[p]);const j=e=>({"Trending Now":"trending","This Season":"seasonal","Popular Anime":"popular","Top Rated Anime":"top-rated"})[e]||"popular",_=e=>{const i=j(e);L(`/browse/anime/${i}`)},d=(e,i)=>!i||i.length===0?null:n("section",{class:"home-section",children:[n("div",{class:"section-header clickable-header",onClick:()=>_(e),children:[n("h2",{children:e}),n("button",{class:"view-all-btn",onClick:a=>{a.stopPropagation(),_(e)},children:["View All ",n("i",{class:"fas fa-arrow-right"})]})]}),n("div",{class:"scrolling-row",children:i.map(a=>n(D,{item:a,onClick:()=>P(a)},`${e}-${a.id}`))})]}),u=()=>n("div",{class:"service-status",children:n("div",{class:`status-indicator ${k?"online":"offline"}`,children:[n("span",{class:"status-dot"}),"Videasy: ",k?"Online":"Offline"]})}),q=({error:e,onRetry:i})=>n("div",{class:"error-container",children:[n("div",{class:"error-message",children:[n("h3",{children:"Something went wrong"}),n("p",{children:e}),n("button",{onClick:i,class:"retry-button",children:"Try Again"})]}),n(u,{})]});return y?n("div",{class:"container home-page anime-page",children:[n("h1",{class:"main-title",children:"Anime"}),n(u,{}),n(U,{text:"Loading anime..."})]}):$?n("div",{class:"container home-page anime-page",children:[n("h1",{class:"main-title",children:"Anime"}),n(q,{error:$,onRetry:()=>{h(null),m()}})]}):n("div",{class:"container home-page anime-page",children:[n("h1",{class:"main-title",children:"Anime"}),n("div",{class:"anime-controls",children:n(u,{})}),E.length>0&&n("section",{class:"home-section",children:[n("h2",{children:"Continue Watching"}),n("div",{class:"scrolling-row scrolling-row--compact",children:E.map(e=>n(D,{item:e,progress:e.progress_seconds,duration:e.duration_seconds,onClick:()=>P(e)},`continue-watching-${e.id}`))})]}),d("Trending Now",A),d("This Season",x),d("Popular Anime",w),d("Top Rated Anime",b),!y&&A.length===0&&w.length===0&&b.length===0&&n("div",{class:"no-content",children:[n("h3",{children:"No anime content available"}),n("p",{children:"Please check your connection and try again."})]})]})};export{X as default};
//# sourceMappingURL=Anime-z5B2KRzR.js.map
