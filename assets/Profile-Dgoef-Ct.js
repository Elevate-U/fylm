import{b as F,u as a,g as p,s as b,t as o,$ as D}from"./index-DJKKYvGv.js";import{d as l,A as L,y as R}from"./react-vendor-BYlzYzcd.js";const A=(r,t)=>r?.avatar_url?p(r.avatar_url):t?.user_metadata?.picture?p(t.user_metadata.picture):t?.user_metadata?.avatar_url?p(t.user_metadata.avatar_url):"/assets/default-avatar.png",j=()=>{const{user:r,profile:t,updateUser:N}=F(),[d,v]=l(t?.full_name||r?.user_metadata?.full_name||""),[_,u]=l(()=>A(t,r)),[c,w]=l(null),[S,h]=l(!1),[x,f]=l("Save Changes"),[C,m]=l(!1),U=L();return R(()=>{u(A(t,r)),m(!1),t?.full_name!==d&&v(t.full_name||"")},[t,r]),r?a("div",{className:"profile-container",children:a("div",{className:"profile-form",style:{maxWidth:420},children:a("form",{onSubmit:async n=>{n.preventDefault(),h(!0),f("Saving...");try{let e=null;if(c){const P=c.name.split(".").pop(),g=`${r.id}/avatar.${P}`,{error:y}=await b.storage.from("avatars").upload(g,c,{upsert:!0,cacheControl:"3600"});if(y)throw y;const{data:E}=b.storage.from("avatars").getPublicUrl(g);e=`${E.publicUrl}?t=${new Date().getTime()}`}const i={data:{full_name:d,...e&&{avatar_url:e}}},s=await N({...i,id:r.id});if(s?.error)throw s.error;o.success("Profile updated successfully!"),f("Saved!"),console.log("Profile saved successfully, redirecting to home..."),setTimeout(()=>{console.log("Redirecting now..."),D("/")},1500)}catch(e){console.error("Profile update failed:",e),o.error(e.message||"An error occurred while updating your profile."),f("Save Changes")}finally{h(!1)}},children:[a("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:a("label",{htmlFor:"avatar-upload",style:{cursor:"pointer"},children:[a("img",{src:C?"/assets/default-avatar.png":_,alt:"Profile avatar",onError:()=>{console.warn("Avatar failed to load, using default"),m(!0),u("/assets/default-avatar.png")},style:{width:96,height:96,borderRadius:"50%",objectFit:"cover",marginBottom:8,border:"2px solid var(--brand-primary)"}}),a("input",{id:"avatar-upload",type:"file",accept:"image/*",style:{display:"none"},ref:U,onChange:n=>{const e=n.target.files[0];if(!e)return;if(!e.type.startsWith("image/")){o.error("Please select a valid image file.");return}if(e.size>50*1024*1024){o.error("Avatar must be less than 50MB.");return}w(e),m(!1);const i=new FileReader;i.onload=s=>u(s.target.result),i.readAsDataURL(e)},"aria-label":"Change profile picture"}),a("div",{style:{color:"var(--brand-primary)",fontSize:14,textAlign:"center"},children:"Change Avatar"})]})}),a("div",{className:"input-group",children:[a("label",{htmlFor:"full-name",children:"Full Name"}),a("input",{id:"full-name",className:"input-field",type:"text",value:d,onInput:n=>v(n.target.value),placeholder:"Your name",maxLength:40,required:!0})]}),a("div",{className:"input-group",children:[a("label",{children:"Email"}),a("input",{className:"input-field",type:"email",value:r.email,disabled:!0,readOnly:!0})]}),a("button",{className:"button",type:"submit",disabled:S,style:{marginTop:16},children:x})]})})}):a("div",{className:"profile-container",children:a("div",{className:"profile-form",children:a("h2",{children:"Not logged in"})})})};export{j as default};
//# sourceMappingURL=Profile-Dgoef-Ct.js.map
