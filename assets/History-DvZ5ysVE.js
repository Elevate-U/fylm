import{a as z,b as B,c as E,u as t,d as R}from"./index-MrGnfflC.js";import{d as i,q as m,y as x,k as P}from"./react-vendor-BYlzYzcd.js";import{H as M}from"./Helmet-DxLH8ZeB.js";import{M as q}from"./MovieCard-CB0S2WSY.js";/* empty css                  */const G=()=>{const{user:r}=z(),[a,s]=i([]),[w,l]=i(!0),[p,h]=i(null),[c,H]=i(!1),[n,d]=i(!0),{removeContinueWatchingItem:W,fetchContinueWatching:_}=B(),u=m(async()=>{if(!r){l(!1);return}l(!0),h(null),s([]),d(!0);try{await y(0,!0)}catch(e){console.error("Error fetching watch history:",e),h("Failed to load watch history. Please try again."),s([])}finally{l(!1)}},[r]),y=m(async(e=0,o=!1)=>{if(!(!r||!o&&!n)){o||H(!0);try{const f=await E(r.id,e,20);if(f.length===0){d(!1);return}s(v=>{const S=new Set(v.map(g=>g.watch_id)),k=f.filter(g=>!S.has(g.watch_id));return[...v,...k]}),f.length<20&&d(!1)}catch(b){console.error("Error loading history batch:",b),o&&h("Failed to load watch history. Please try again.")}finally{o||H(!1)}}},[r,n]),F=m(()=>{!c&&n&&y(a.length)},[y,a.length,c,n]);x(()=>{u()},[u,r]);const C=async e=>{s(a.filter(o=>o.watch_id!==e.watch_id)),W(e.media_id);try{await R(r.id,e),await _(r.id)}catch(o){console.error("Failed to delete item or refetch continue watching:",o)}},L=()=>{u()};return w?t("div",{class:"container",children:t("p",{children:"Loading watch history..."})}):p?t("div",{class:"container",children:[t(M,{children:t("title",{children:"Watch History - Fylm"})}),t("h1",{children:"Watch History"}),t("div",{class:"error-message",children:[t("p",{children:p}),t("button",{onClick:L,class:"retry-button",children:"Retry"})]})]}):t("div",{class:"container",children:[t(M,{children:t("title",{children:"Watch History - Fylm"})}),t("h1",{children:"Watch History"}),a.length>0?t(P,{children:[t("div",{class:"movie-grid",children:a.map(e=>t(q,{item:e,type:e.type,progress:e.progress_seconds,duration:e.duration_seconds,showDeleteButton:!0,onDelete:C,useFullResolution:!0},e.watch_id))}),n&&t("div",{class:"load-more-container",children:t("button",{class:"load-more-btn",onClick:F,disabled:c,children:c?"Loading...":"Load More"})})]}):!w&&t("p",{children:"Your watch history is empty."})]})};export{G as default};
//# sourceMappingURL=History-DvZ5ysVE.js.map
