(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var or,H,Ei,$i,nt,qs,Ti,Pi,ki,Vn,$n,Tn,Ai,Zt={},Oi=[],xl=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ir=Array.isArray;function Le(r,e){for(var t in e)r[t]=e[t];return r}function Kn(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function ye(r,e,t){var n,s,o,i={};for(o in e)o=="key"?n=e[o]:o=="ref"?s=e[o]:i[o]=e[o];if(arguments.length>2&&(i.children=arguments.length>3?or.call(arguments,2):t),typeof r=="function"&&r.defaultProps!=null)for(o in r.defaultProps)i[o]===void 0&&(i[o]=r.defaultProps[o]);return Gt(r,i,n,s,null)}function Gt(r,e,t,n,s){var o={type:r,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++Ei,__i:-1,__u:0};return s==null&&H.vnode!=null&&H.vnode(o),o}function Jn(){return{current:null}}function ve(r){return r.children}function Pe(r,e){this.props=r,this.context=e}function kt(r,e){if(e==null)return r.__?kt(r.__,r.__i+1):null;for(var t;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null)return t.__e;return typeof r.type=="function"?kt(r):null}function Ri(r){var e,t;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,e=0;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null){r.__e=r.__c.base=t.__e;break}return Ri(r)}}function Pn(r){(!r.__d&&(r.__d=!0)&&nt.push(r)&&!Cr.__r++||qs!=H.debounceRendering)&&((qs=H.debounceRendering)||Ti)(Cr)}function Cr(){for(var r,e,t,n,s,o,i,a=1;nt.length;)nt.length>a&&nt.sort(Pi),r=nt.shift(),a=nt.length,r.__d&&(t=void 0,s=(n=(e=r).__v).__e,o=[],i=[],e.__P&&((t=Le({},n)).__v=n.__v+1,H.vnode&&H.vnode(t),Yn(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[s]:null,o,s??kt(n),!!(32&n.__u),i),t.__v=n.__v,t.__.__k[t.__i]=t,ji(o,t,i),t.__e!=s&&Ri(t)));Cr.__r=0}function Ci(r,e,t,n,s,o,i,a,l,c,h){var d,p,f,_,g,v,y=n&&n.__k||Oi,b=e.length;for(l=jl(t,e,y,l,b),d=0;d<b;d++)(f=t.__k[d])!=null&&(p=f.__i==-1?Zt:y[f.__i]||Zt,f.__i=d,v=Yn(r,f,p,s,o,i,a,l,c,h),_=f.__e,f.ref&&p.ref!=f.ref&&(p.ref&&Qn(p.ref,null,f),h.push(f.ref,f.__c||_,f)),g==null&&_!=null&&(g=_),4&f.__u||p.__k===f.__k?l=xi(f,l,r):typeof f.type=="function"&&v!==void 0?l=v:_&&(l=_.nextSibling),f.__u&=-7);return t.__e=g,l}function jl(r,e,t,n,s){var o,i,a,l,c,h=t.length,d=h,p=0;for(r.__k=new Array(s),o=0;o<s;o++)(i=e[o])!=null&&typeof i!="boolean"&&typeof i!="function"?(l=o+p,(i=r.__k[o]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?Gt(null,i,null,null,null):ir(i)?Gt(ve,{children:i},null,null,null):i.constructor==null&&i.__b>0?Gt(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=r,i.__b=r.__b+1,a=null,(c=i.__i=Il(i,t,l,d))!=-1&&(d--,(a=t[c])&&(a.__u|=2)),a==null||a.__v==null?(c==-1&&(s>h?p--:s<h&&p++),typeof i.type!="function"&&(i.__u|=4)):c!=l&&(c==l-1?p--:c==l+1?p++:(c>l?p--:p++,i.__u|=4))):r.__k[o]=null;if(d)for(o=0;o<h;o++)(a=t[o])!=null&&!(2&a.__u)&&(a.__e==n&&(n=kt(a)),Ui(a,a));return n}function xi(r,e,t){var n,s;if(typeof r.type=="function"){for(n=r.__k,s=0;n&&s<n.length;s++)n[s]&&(n[s].__=r,e=xi(n[s],e,t));return e}r.__e!=e&&(e&&r.type&&!t.contains(e)&&(e=kt(r)),t.insertBefore(r.__e,e||null),e=r.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ae(r,e){return e=e||[],r==null||typeof r=="boolean"||(ir(r)?r.some(function(t){Ae(t,e)}):e.push(r)),e}function Il(r,e,t,n){var s,o,i=r.key,a=r.type,l=e[t];if(l===null&&r.key==null||l&&i==l.key&&a==l.type&&!(2&l.__u))return t;if(n>(l!=null&&!(2&l.__u)?1:0))for(s=t-1,o=t+1;s>=0||o<e.length;){if(s>=0){if((l=e[s])&&!(2&l.__u)&&i==l.key&&a==l.type)return s;s--}if(o<e.length){if((l=e[o])&&!(2&l.__u)&&i==l.key&&a==l.type)return o;o++}}return-1}function Ws(r,e,t){e[0]=="-"?r.setProperty(e,t??""):r[e]=t==null?"":typeof t!="number"||xl.test(e)?t:t+"px"}function br(r,e,t,n,s){var o,i;e:if(e=="style")if(typeof t=="string")r.style.cssText=t;else{if(typeof n=="string"&&(r.style.cssText=n=""),n)for(e in n)t&&e in t||Ws(r.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||Ws(r.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(ki,"$1")),i=e.toLowerCase(),e=i in r||e=="onFocusOut"||e=="onFocusIn"?i.slice(2):e.slice(2),r.l||(r.l={}),r.l[e+o]=t,t?n?t.u=n.u:(t.u=Vn,r.addEventListener(e,o?Tn:$n,o)):r.removeEventListener(e,o?Tn:$n,o);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in r)try{r[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?r.removeAttribute(e):r.setAttribute(e,e=="popover"&&t==1?"":t))}}function Gs(r){return function(e){if(this.l){var t=this.l[e.type+r];if(e.t==null)e.t=Vn++;else if(e.t<t.u)return;return t(H.event?H.event(e):e)}}}function Yn(r,e,t,n,s,o,i,a,l,c){var h,d,p,f,_,g,v,y,b,w,C,A,N,Z,S,j,q,I=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),o=[a=e.__e=t.__e]),(h=H.__b)&&h(e);e:if(typeof I=="function")try{if(y=e.props,b="prototype"in I&&I.prototype.render,w=(h=I.contextType)&&n[h.__c],C=h?w?w.props.value:h.__:n,t.__c?v=(d=e.__c=t.__c).__=d.__E:(b?e.__c=d=new I(y,C):(e.__c=d=new Pe(y,C),d.constructor=I,d.render=Nl),w&&w.sub(d),d.props=y,d.state||(d.state={}),d.context=C,d.__n=n,p=d.__d=!0,d.__h=[],d._sb=[]),b&&d.__s==null&&(d.__s=d.state),b&&I.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=Le({},d.__s)),Le(d.__s,I.getDerivedStateFromProps(y,d.__s))),f=d.props,_=d.state,d.__v=e,p)b&&I.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),b&&d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(b&&I.getDerivedStateFromProps==null&&y!==f&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(y,C),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(y,d.__s,C)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(d.props=y,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(K){K&&(K.__=e)}),A=0;A<d._sb.length;A++)d.__h.push(d._sb[A]);d._sb=[],d.__h.length&&i.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(y,d.__s,C),b&&d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(f,_,g)})}if(d.context=C,d.props=y,d.__P=r,d.__e=!1,N=H.__r,Z=0,b){for(d.state=d.__s,d.__d=!1,N&&N(e),h=d.render(d.props,d.state,d.context),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[]}else do d.__d=!1,N&&N(e),h=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++Z<25);d.state=d.__s,d.getChildContext!=null&&(n=Le(Le({},n),d.getChildContext())),b&&!p&&d.getSnapshotBeforeUpdate!=null&&(g=d.getSnapshotBeforeUpdate(f,_)),j=h,h!=null&&h.type===ve&&h.key==null&&(j=Ii(h.props.children)),a=Ci(r,ir(j)?j:[j],e,t,n,s,o,i,a,l,c),d.base=e.__e,e.__u&=-161,d.__h.length&&i.push(d),v&&(d.__E=d.__=null)}catch(K){if(e.__v=null,l||o!=null)if(K.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,e.__e=a}else for(q=o.length;q--;)Kn(o[q]);else e.__e=t.__e,e.__k=t.__k;H.__e(K,e,t)}else o==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=Ul(t.__e,e,t,n,s,o,i,l,c);return(h=H.diffed)&&h(e),128&e.__u?void 0:a}function ji(r,e,t){for(var n=0;n<t.length;n++)Qn(t[n],t[++n],t[++n]);H.__c&&H.__c(e,r),r.some(function(s){try{r=s.__h,s.__h=[],r.some(function(o){o.call(s)})}catch(o){H.__e(o,s.__v)}})}function Ii(r){return typeof r!="object"||r==null||r.__b&&r.__b>0?r:ir(r)?r.map(Ii):Le({},r)}function Ul(r,e,t,n,s,o,i,a,l){var c,h,d,p,f,_,g,v=t.props,y=e.props,b=e.type;if(b=="svg"?s="http://www.w3.org/2000/svg":b=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((f=o[c])&&"setAttribute"in f==!!b&&(b?f.localName==b:f.nodeType==3)){r=f,o[c]=null;break}}if(r==null){if(b==null)return document.createTextNode(y);r=document.createElementNS(s,b,y.is&&y),a&&(H.__m&&H.__m(e,o),a=!1),o=null}if(b==null)v===y||a&&r.data==y||(r.data=y);else{if(o=o&&or.call(r.childNodes),v=t.props||Zt,!a&&o!=null)for(v={},c=0;c<r.attributes.length;c++)v[(f=r.attributes[c]).name]=f.value;for(c in v)if(f=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")d=f;else if(!(c in y)){if(c=="value"&&"defaultValue"in y||c=="checked"&&"defaultChecked"in y)continue;br(r,c,null,f,s)}}for(c in y)f=y[c],c=="children"?p=f:c=="dangerouslySetInnerHTML"?h=f:c=="value"?_=f:c=="checked"?g=f:a&&typeof f!="function"||v[c]===f||br(r,c,f,v[c],s);if(h)a||d&&(h.__html==d.__html||h.__html==r.innerHTML)||(r.innerHTML=h.__html),e.__k=[];else if(d&&(r.innerHTML=""),Ci(e.type=="template"?r.content:r,ir(p)?p:[p],e,t,n,b=="foreignObject"?"http://www.w3.org/1999/xhtml":s,o,i,o?o[0]:t.__k&&kt(t,0),a,l),o!=null)for(c=o.length;c--;)Kn(o[c]);a||(c="value",b=="progress"&&_==null?r.removeAttribute("value"):_!=null&&(_!==r[c]||b=="progress"&&!_||b=="option"&&_!=v[c])&&br(r,c,_,v[c],s),c="checked",g!=null&&g!=r[c]&&br(r,c,g,v[c],s))}return r}function Qn(r,e,t){try{if(typeof r=="function"){var n=typeof r.__u=="function";n&&r.__u(),n&&e==null||(r.__u=r(e))}else r.current=e}catch(s){H.__e(s,t)}}function Ui(r,e,t){var n,s;if(H.unmount&&H.unmount(r),(n=r.ref)&&(n.current&&n.current!=r.__e||Qn(n,null,e)),(n=r.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(o){H.__e(o,e)}n.base=n.__P=null}if(n=r.__k)for(s=0;s<n.length;s++)n[s]&&Ui(n[s],e,t||typeof r.type!="function");t||Kn(r.__e),r.__c=r.__=r.__e=void 0}function Nl(r,e,t){return this.constructor(r,t)}function at(r,e,t){var n,s,o,i;e==document&&(e=document.documentElement),H.__&&H.__(r,e),s=(n=typeof t=="function")?null:t&&t.__k||e.__k,o=[],i=[],Yn(e,r=(!n&&t||e).__k=ye(ve,null,[r]),s||Zt,Zt,e.namespaceURI,!n&&t?[t]:s?null:e.firstChild?or.call(e.childNodes):null,o,!n&&t?t:s?s.__e:e.firstChild,n,i),ji(o,r,i)}function Xn(r,e){at(r,e,Xn)}function Zn(r,e,t){var n,s,o,i,a=Le({},r.props);for(o in r.type&&r.type.defaultProps&&(i=r.type.defaultProps),e)o=="key"?n=e[o]:o=="ref"?s=e[o]:a[o]=e[o]===void 0&&i!=null?i[o]:e[o];return arguments.length>2&&(a.children=arguments.length>3?or.call(arguments,2):t),Gt(r.type,a,n||r.key,s||r.ref,null)}function ar(r){function e(t){var n,s;return this.getChildContext||(n=new Set,(s={})[e.__c]=this,this.getChildContext=function(){return s},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(o){this.props.value!=o.value&&n.forEach(function(i){i.__e=!0,Pn(i)})},this.sub=function(o){n.add(o);var i=o.componentWillUnmount;o.componentWillUnmount=function(){n&&n.delete(o),i&&i.call(o)}}),t.children}return e.__c="__cC"+Ai++,e.__=r,e.Provider=e.__l=(e.Consumer=function(t,n){return t.children(n)}).contextType=e,e}or=Oi.slice,H={__e:function(r,e,t,n){for(var s,o,i;e=e.__;)if((s=e.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(r)),i=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(r,n||{}),i=s.__d),i)return s.__E=s}catch(a){r=a}throw r}},Ei=0,$i=function(r){return r!=null&&r.constructor==null},Pe.prototype.setState=function(r,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Le({},this.state),typeof r=="function"&&(r=r(Le({},t),this.props)),r&&Le(t,r),r!=null&&this.__v&&(e&&this._sb.push(e),Pn(this))},Pe.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),Pn(this))},Pe.prototype.render=ve,nt=[],Ti=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Pi=function(r,e){return r.__v.__b-e.__v.__b},Cr.__r=0,ki=/(PointerCapture)$|Capture$/i,Vn=0,$n=Gs(!1),Tn=Gs(!0),Ai=0;const Ll=Object.freeze(Object.defineProperty({__proto__:null,Component:Pe,Fragment:ve,cloneElement:Zn,createContext:ar,createElement:ye,createRef:Jn,h:ye,hydrate:Xn,get isValidElement(){return $i},get options(){return H},render:at,toChildArray:Ae},Symbol.toStringTag,{value:"Module"}));var Dl=0;function u(r,e,t,n,s,o){e||(e={});var i,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?i=e[a]:l[a]=e[a];var c={type:r,props:l,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Dl,__i:-1,__u:0,__source:s,__self:o};if(typeof r=="function"&&(i=r.defaultProps))for(a in i)l[a]===void 0&&(l[a]=i[a]);return H.vnode&&H.vnode(c),c}var Ge,se,on,zs,At=0,Ni=[],ce=H,Vs=ce.__b,Ks=ce.__r,Js=ce.diffed,Ys=ce.__c,Qs=ce.unmount,Xs=ce.__;function lt(r,e){ce.__h&&ce.__h(se,r,At||e),At=0;var t=se.__H||(se.__H={__:[],__h:[]});return r>=t.__.length&&t.__.push({}),t.__[r]}function R(r){return At=1,Fr(Li,r)}function Fr(r,e,t){var n=lt(Ge++,2);if(n.t=r,!n.__c&&(n.__=[t?t(e):Li(void 0,e),function(a){var l=n.__N?n.__N[0]:n.__[0],c=n.t(l,a);l!==c&&(n.__N=[c,n.__[1]],n.__c.setState({}))}],n.__c=se,!se.__f)){var s=function(a,l,c){if(!n.__c.__H)return!0;var h=n.__c.__H.__.filter(function(p){return!!p.__c});if(h.every(function(p){return!p.__N}))return!o||o.call(this,a,l,c);var d=n.__c.props!==a;return h.forEach(function(p){if(p.__N){var f=p.__[0];p.__=p.__N,p.__N=void 0,f!==p.__[0]&&(d=!0)}}),o&&o.call(this,a,l,c)||d};se.__f=!0;var o=se.shouldComponentUpdate,i=se.componentWillUpdate;se.componentWillUpdate=function(a,l,c){if(this.__e){var h=o;o=void 0,s(a,l,c),o=h}i&&i.call(this,a,l,c)},se.shouldComponentUpdate=s}return n.__N||n.__}function re(r,e){var t=lt(Ge++,3);!ce.__s&&ns(t.__H,e)&&(t.__=r,t.u=e,se.__H.__h.push(t))}function It(r,e){var t=lt(Ge++,4);!ce.__s&&ns(t.__H,e)&&(t.__=r,t.u=e,se.__h.push(t))}function ge(r){return At=5,Ut(function(){return{current:r}},[])}function es(r,e,t){At=6,It(function(){if(typeof r=="function"){var n=r(e());return function(){r(null),n&&typeof n=="function"&&n()}}if(r)return r.current=e(),function(){return r.current=null}},t==null?t:t.concat(r))}function Ut(r,e){var t=lt(Ge++,7);return ns(t.__H,e)&&(t.__=r(),t.__H=e,t.__h=r),t.__}function Br(r,e){return At=8,Ut(function(){return r},e)}function lr(r){var e=se.context[r.__c],t=lt(Ge++,9);return t.c=r,e?(t.__==null&&(t.__=!0,e.sub(se)),e.props.value):r.__}function ts(r,e){ce.useDebugValue&&ce.useDebugValue(e?e(r):r)}function Ml(r){var e=lt(Ge++,10),t=R();return e.__=r,se.componentDidCatch||(se.componentDidCatch=function(n,s){e.__&&e.__(n,s),t[1](n)}),[t[0],function(){t[1](void 0)}]}function rs(){var r=lt(Ge++,11);if(!r.__){for(var e=se.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var t=e.__m||(e.__m=[0,0]);r.__="P"+t[0]+"-"+t[1]++}return r.__}function Fl(){for(var r;r=Ni.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(kr),r.__H.__h.forEach(kn),r.__H.__h=[]}catch(e){r.__H.__h=[],ce.__e(e,r.__v)}}ce.__b=function(r){se=null,Vs&&Vs(r)},ce.__=function(r,e){r&&e.__k&&e.__k.__m&&(r.__m=e.__k.__m),Xs&&Xs(r,e)},ce.__r=function(r){Ks&&Ks(r),Ge=0;var e=(se=r.__c).__H;e&&(on===se?(e.__h=[],se.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.u=t.__N=void 0})):(e.__h.forEach(kr),e.__h.forEach(kn),e.__h=[],Ge=0)),on=se},ce.diffed=function(r){Js&&Js(r);var e=r.__c;e&&e.__H&&(e.__H.__h.length&&(Ni.push(e)!==1&&zs===ce.requestAnimationFrame||((zs=ce.requestAnimationFrame)||Bl)(Fl)),e.__H.__.forEach(function(t){t.u&&(t.__H=t.u),t.u=void 0})),on=se=null},ce.__c=function(r,e){e.some(function(t){try{t.__h.forEach(kr),t.__h=t.__h.filter(function(n){return!n.__||kn(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],ce.__e(n,t.__v)}}),Ys&&Ys(r,e)},ce.unmount=function(r){Qs&&Qs(r);var e,t=r.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{kr(n)}catch(s){e=s}}),t.__H=void 0,e&&ce.__e(e,t.__v))};var Zs=typeof requestAnimationFrame=="function";function Bl(r){var e,t=function(){clearTimeout(n),Zs&&cancelAnimationFrame(e),setTimeout(r)},n=setTimeout(t,35);Zs&&(e=requestAnimationFrame(t))}function kr(r){var e=se,t=r.__c;typeof t=="function"&&(r.__c=void 0,t()),se=e}function kn(r){var e=se;r.__c=r.__(),se=e}function ns(r,e){return!r||r.length!==e.length||e.some(function(t,n){return t!==r[n]})}function Li(r,e){return typeof e=="function"?e(r):e}var Hl={};function qt(r,e){for(var t in e)r[t]=e[t];return r}function An(r,e,t){var n,s=/(?:\?([^#]*))?(#.*)?$/,o=r.match(s),i={};if(o&&o[1])for(var a=o[1].split("&"),l=0;l<a.length;l++){var c=a[l].split("=");i[decodeURIComponent(c[0])]=decodeURIComponent(c.slice(1).join("="))}r=On(r.replace(s,"")),e=On(e||"");for(var h=Math.max(r.length,e.length),d=0;d<h;d++)if(e[d]&&e[d].charAt(0)===":"){var p=e[d].replace(/(^:|[+*?]+$)/g,""),f=(e[d].match(/[+*?]+$/)||Hl)[0]||"",_=~f.indexOf("+"),g=~f.indexOf("*"),v=r[d]||"";if(!v&&!g&&(f.indexOf("?")<0||_)){n=!1;break}if(i[p]=decodeURIComponent(v),_||g){i[p]=r.slice(d).map(decodeURIComponent).join("/");break}}else if(e[d]!==r[d]){n=!1;break}return(t.default===!0||n!==!1)&&i}function ql(r,e){return r.rank<e.rank?1:r.rank>e.rank?-1:r.index-e.index}function Wl(r,e){return r.index=e,r.rank=function(t){return t.props.default?0:On(t.props.path).map(Gl).join("")}(r),r.props}function On(r){return r.replace(/(^\/+|\/+$)/g,"").split("/")}function Gl(r){return r.charAt(0)==":"?1+"*+?".indexOf(r.charAt(r.length-1))||4:5}var zl={},ot=[],zt=[],$e=null,ss={url:os()},Di=ar(ss);function Vl(){var r=lr(Di);if(r===ss){var e=R()[1];re(function(){return zt.push(e),function(){return zt.splice(zt.indexOf(e),1)}},[])}return[r,Ie]}function os(){var r;return""+((r=$e&&$e.location?$e.location:$e&&$e.getCurrentLocation?$e.getCurrentLocation():typeof location<"u"?location:zl).pathname||"")+(r.search||"")}function Ie(r,e){return e===void 0&&(e=!1),typeof r!="string"&&r.url&&(e=r.replace,r=r.url),function(t){for(var n=ot.length;n--;)if(ot[n].canRoute(t))return!0;return!1}(r)&&function(t,n){n===void 0&&(n="push"),$e&&$e[n]?$e[n](t):typeof history<"u"&&history[n+"State"]&&history[n+"State"](null,null,t)}(r,e?"replace":"push"),Mi(r)}function Mi(r){for(var e=!1,t=0;t<ot.length;t++)ot[t].routeTo(r)&&(e=!0);return e}function Kl(r){if(r&&r.getAttribute){var e=r.getAttribute("href"),t=r.getAttribute("target");if(e&&e.match(/^\//g)&&(!t||t.match(/^_?self$/i)))return Ie(e)}}function Jl(r){return r.stopImmediatePropagation&&r.stopImmediatePropagation(),r.stopPropagation&&r.stopPropagation(),r.preventDefault(),!1}function Fi(r){if(!(r.ctrlKey||r.metaKey||r.altKey||r.shiftKey||r.button)){var e=r.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(Kl(e))return Jl(r)}while(e=e.parentNode)}}var eo=!1;function Bi(r){r.history&&($e=r.history),this.state={url:r.url||os()}}qt(Bi.prototype=new Pe,{shouldComponentUpdate:function(r){return r.static!==!0||r.url!==this.props.url||r.onChange!==this.props.onChange},canRoute:function(r){var e=Ae(this.props.children);return this.g(e,r)!==void 0},routeTo:function(r){this.setState({url:r});var e=this.canRoute(r);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var r=this;eo||(eo=!0,$e||addEventListener("popstate",function(){Mi(os())}),addEventListener("click",Fi)),ot.push(this),$e&&(this.u=$e.listen(function(e){var t=e.location||e;r.routeTo(""+(t.pathname||"")+(t.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),ot.splice(ot.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(r,e){r=r.filter(Wl).sort(ql);for(var t=0;t<r.length;t++){var n=r[t],s=An(e,n.props.path,n.props);if(s)return[n,s]}},render:function(r,e){var t,n,s=r.onChange,o=e.url,i=this.c,a=this.g(Ae(r.children),o);if(a&&(n=Zn(a[0],qt(qt({url:o,matches:t=a[1]},t),{key:void 0,ref:void 0}))),o!==(i&&i.url)){qt(ss,i=this.c={url:o,previous:i&&i.url,current:n,path:n?n.props.path:null,matches:t}),i.router=this,i.active=n?[n]:[];for(var l=zt.length;l--;)zt[l]({});typeof s=="function"&&s(i)}return ye(Di.Provider,{value:i},n)}});var Ne=function(r){return ye("a",qt({onClick:Fi},r))};function xr(){return xr=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},xr.apply(null,arguments)}var $t;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})($t||($t={}));var to=function(r){return r},ro="beforeunload",Yl="hashchange",Ql="popstate";function Xl(r){r===void 0&&(r={});var e=r,t=e.window,n=t===void 0?document.defaultView:t,s=n.history;function o(){var S=oo(n.location.hash.substr(1)),j=S.pathname,q=j===void 0?"/":j,I=S.search,K=I===void 0?"":I,ie=S.hash,te=ie===void 0?"":ie,de=s.state||{};return[de.idx,to({pathname:q,search:K,hash:te,state:de.usr||null,key:de.key||"default"})]}var i=null;function a(){if(i)f.call(i),i=null;else{var S=$t.Pop,j=o(),q=j[0],I=j[1];if(f.length){if(q!=null){var K=h-q;K&&(i={action:S,location:I,retry:function(){N(K*-1)}},N(K))}}else w(S)}}n.addEventListener(Ql,a),n.addEventListener(Yl,function(){var S=o(),j=S[1];an(j)!==an(d)&&a()});var l=$t.Pop,c=o(),h=c[0],d=c[1],p=so(),f=so();h==null&&(h=0,s.replaceState(xr({},s.state,{idx:h}),""));function _(){var S=document.querySelector("base"),j="";if(S&&S.getAttribute("href")){var q=n.location.href,I=q.indexOf("#");j=I===-1?q:q.slice(0,I)}return j}function g(S){return _()+"#"+(typeof S=="string"?S:an(S))}function v(S,j){return j===void 0&&(j=null),to(xr({pathname:d.pathname,hash:"",search:""},typeof S=="string"?oo(S):S,{state:j,key:Zl()}))}function y(S,j){return[{usr:S.state,key:S.key,idx:j},g(S)]}function b(S,j,q){return!f.length||(f.call({action:S,location:j,retry:q}),!1)}function w(S){l=S;var j=o();h=j[0],d=j[1],p.call({action:l,location:d})}function C(S,j){var q=$t.Push,I=v(S,j);function K(){C(S,j)}if(b(q,I,K)){var ie=y(I,h+1),te=ie[0],de=ie[1];try{s.pushState(te,"",de)}catch{n.location.assign(de)}w(q)}}function A(S,j){var q=$t.Replace,I=v(S,j);function K(){A(S,j)}if(b(q,I,K)){var ie=y(I,h),te=ie[0],de=ie[1];s.replaceState(te,"",de),w(q)}}function N(S){s.go(S)}var Z={get action(){return l},get location(){return d},createHref:g,push:C,replace:A,go:N,back:function(){N(-1)},forward:function(){N(1)},listen:function(j){return p.push(j)},block:function(j){var q=f.push(j);return f.length===1&&n.addEventListener(ro,no),function(){q(),f.length||n.removeEventListener(ro,no)}}};return Z}function no(r){r.preventDefault(),r.returnValue=""}function so(){var r=[];return{get length(){return r.length},push:function(t){return r.push(t),function(){r=r.filter(function(n){return n!==t})}},call:function(t){r.forEach(function(n){return n&&n(t)})}}}function Zl(){return Math.random().toString(36).substr(2,8)}function an(r){var e=r.pathname,t=e===void 0?"/":e,n=r.search,s=n===void 0?"":n,o=r.hash,i=o===void 0?"":o;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),i&&i!=="#"&&(t+=i.charAt(0)==="#"?i:"#"+i),t}function oo(r){var e={};if(r){var t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));var n=r.indexOf("?");n>=0&&(e.search=r.substr(n),r=r.substr(0,n)),r&&(e.pathname=r)}return e}const ec="modulepreload",tc=function(r){return"/"+r},io={},cr=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=tc(l),l in io)return;io[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":ec,c||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((p,f)=>{d.addEventListener("load",p),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return s.then(i=>{for(const a of i||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},rc=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>cr(async()=>{const{default:n}=await Promise.resolve().then(()=>Nt);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class is extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class nc extends is{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ao extends is{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class lo extends is{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Rn;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Rn||(Rn={}));var sc=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{c(n.next(h))}catch(d){i(d)}}function l(h){try{c(n.throw(h))}catch(d){i(d)}}function c(h){h.done?o(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class oc{constructor(e,{headers:t={},customFetch:n,region:s=Rn.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=rc(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return sc(this,void 0,void 0,function*(){try{const{headers:s,method:o,body:i}=t;let a={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let h;i&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",h=i):typeof i=="string"?(a["Content-Type"]="text/plain",h=i):typeof FormData<"u"&&i instanceof FormData?h=i:(a["Content-Type"]="application/json",h=JSON.stringify(i)));const d=yield this.fetch(c.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:h}).catch(g=>{throw new nc(g)}),p=d.headers.get("x-relay-error");if(p&&p==="true")throw new ao(d);if(!d.ok)throw new lo(d);let f=((n=d.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),_;return f==="application/json"?_=yield d.json():f==="application/octet-stream"?_=yield d.blob():f==="text/event-stream"?_=d:f==="multipart/form-data"?_=yield d.formData():_=yield d.text(),{data:_,error:null,response:d}}catch(s){return{data:null,error:s,response:s instanceof lo||s instanceof ao?s.context:void 0}}})}}var Oe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function as(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var we={},ls={},Hr={},ur={},qr={},Wr={},ic=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ot=ic();const ac=Ot.fetch,qi=Ot.fetch.bind(Ot),Wi=Ot.Headers,lc=Ot.Request,cc=Ot.Response,Nt=Object.freeze(Object.defineProperty({__proto__:null,Headers:Wi,Request:lc,Response:cc,default:qi,fetch:ac},Symbol.toStringTag,{value:"Module"})),uc=as(Nt);var Gr={};Object.defineProperty(Gr,"__esModule",{value:!0});let dc=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Gr.default=dc;var Gi=Oe&&Oe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wr,"__esModule",{value:!0});const hc=Gi(uc),fc=Gi(Gr);let pc=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=hc.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var i,a,l;let c=null,h=null,d=null,p=o.status,f=o.statusText;if(o.ok){if(this.method!=="HEAD"){const y=await o.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?h=y:h=JSON.parse(y))}const g=(i=this.headers.Prefer)===null||i===void 0?void 0:i.match(/count=(exact|planned|estimated)/),v=(a=o.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");g&&v&&v.length>1&&(d=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(c={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,d=null,p=406,f="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const g=await o.text();try{c=JSON.parse(g),Array.isArray(c)&&o.status===404&&(h=[],c=null,p=200,f="OK")}catch{o.status===404&&g===""?(p=204,f="No Content"):c={message:g}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,p=200,f="OK"),c&&this.shouldThrowOnError)throw new fc.default(c)}return{error:c,data:h,count:d,status:p,statusText:f}});return this.shouldThrowOnError||(s=s.catch(o=>{var i,a,l;return{error:{message:`${(i=o==null?void 0:o.name)!==null&&i!==void 0?i:"FetchError"}: ${o==null?void 0:o.message}`,details:`${(a=o==null?void 0:o.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=o==null?void 0:o.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};Wr.default=pc;var _c=Oe&&Oe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(qr,"__esModule",{value:!0});const gc=_c(Wr);let vc=class extends gc.default{select(e){let t=!1;const n=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:s,referencedTable:o=s}={}){const i=o?`${o}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:s=n}={}){const o=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:s=!1,wal:o=!1,format:i="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,n?"settings":null,s?"buffers":null,o?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${c}"; options=${l};`,i==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};qr.default=vc;var mc=Oe&&Oe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ur,"__esModule",{value:!0});const yc=mc(qr);let bc=class extends yc.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:s}={}){let o="";s==="plain"?o="pl":s==="phrase"?o="ph":s==="websearch"&&(o="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${o}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}};ur.default=bc;var wc=Oe&&Oe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Hr,"__esModule",{value:!0});const Ht=wc(ur);let Sc=class{constructor(e,{headers:t={},schema:n,fetch:s}){this.url=e,this.headers=t,this.schema=n,this.fetch=s}select(e,{head:t=!1,count:n}={}){const s=t?"HEAD":"GET";let o=!1;const i=(e??"*").split("").map(a=>/\s/.test(a)&&!o?"":(a==='"'&&(o=!o),a)).join("");return this.url.searchParams.set("select",i),n&&(this.headers.Prefer=`count=${n}`),new Ht.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:n=!0}={}){const s="POST",o=[];if(this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),n||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const i=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(i.length>0){const a=[...new Set(i)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Ht.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:s,defaultToNull:o=!0}={}){const i="POST",a=[`resolution=${n?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),o||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((c,h)=>c.concat(Object.keys(h)),[]);if(l.length>0){const c=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",c.join(","))}}return new Ht.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const n="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Ht.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new Ht.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Hr.default=Sc;var zr={},Vr={};Object.defineProperty(Vr,"__esModule",{value:!0});Vr.version=void 0;Vr.version="0.0.0-automated";Object.defineProperty(zr,"__esModule",{value:!0});zr.DEFAULT_HEADERS=void 0;const Ec=Vr;zr.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Ec.version}`};var zi=Oe&&Oe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ls,"__esModule",{value:!0});const $c=zi(Hr),Tc=zi(ur),Pc=zr;let kc=class Vi{constructor(e,{headers:t={},schema:n,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Pc.DEFAULT_HEADERS),t),this.schemaName=n,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new $c.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Vi(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:s=!1,count:o}={}){let i;const a=new URL(`${this.url}/rpc/${e}`);let l;n||s?(i=n?"HEAD":"GET",Object.entries(t).filter(([h,d])=>d!==void 0).map(([h,d])=>[h,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([h,d])=>{a.searchParams.append(h,d)})):(i="POST",l=t);const c=Object.assign({},this.headers);return o&&(c.Prefer=`count=${o}`),new Tc.default({method:i,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};ls.default=kc;var Lt=Oe&&Oe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(we,"__esModule",{value:!0});we.PostgrestError=we.PostgrestBuilder=we.PostgrestTransformBuilder=we.PostgrestFilterBuilder=we.PostgrestQueryBuilder=we.PostgrestClient=void 0;const Ki=Lt(ls);we.PostgrestClient=Ki.default;const Ji=Lt(Hr);we.PostgrestQueryBuilder=Ji.default;const Yi=Lt(ur);we.PostgrestFilterBuilder=Yi.default;const Qi=Lt(qr);we.PostgrestTransformBuilder=Qi.default;const Xi=Lt(Wr);we.PostgrestBuilder=Xi.default;const Zi=Lt(Gr);we.PostgrestError=Zi.default;var Ac=we.default={PostgrestClient:Ki.default,PostgrestQueryBuilder:Ji.default,PostgrestFilterBuilder:Yi.default,PostgrestTransformBuilder:Qi.default,PostgrestBuilder:Xi.default,PostgrestError:Zi.default};const{PostgrestClient:Oc,PostgrestQueryBuilder:O_,PostgrestFilterBuilder:R_,PostgrestTransformBuilder:C_,PostgrestBuilder:x_,PostgrestError:j_}=Ac;function Rc(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Cc=Rc(),xc="2.11.15",jc=`realtime-js/${xc}`,Ic="1.0.0",ea=1e4,Uc=1e3;var Vt;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Vt||(Vt={}));var me;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(me||(me={}));var je;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(je||(je={}));var Cn;(function(r){r.websocket="websocket"})(Cn||(Cn={}));var st;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(st||(st={}));class Nc{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),o=t.getUint8(2);let i=this.HEADER_LENGTH+2;const a=n.decode(e.slice(i,i+s));i=i+s;const l=n.decode(e.slice(i,i+o));i=i+o;const c=JSON.parse(n.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class ta{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var oe;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(oe||(oe={}));const co=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((o,i)=>(o[i]=Lc(i,r,e,s),o),{})},Lc=(r,e,t,n)=>{const s=e.find(a=>a.name===r),o=s==null?void 0:s.type,i=t[r];return o&&!n.includes(o)?ra(o,i):xn(i)},ra=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Bc(e,t)}switch(r){case oe.bool:return Dc(e);case oe.float4:case oe.float8:case oe.int2:case oe.int4:case oe.int8:case oe.numeric:case oe.oid:return Mc(e);case oe.json:case oe.jsonb:return Fc(e);case oe.timestamp:return Hc(e);case oe.abstime:case oe.date:case oe.daterange:case oe.int4range:case oe.int8range:case oe.money:case oe.reltime:case oe.text:case oe.time:case oe.timestamptz:case oe.timetz:case oe.tsrange:case oe.tstzrange:return xn(e);default:return xn(e)}},xn=r=>r,Dc=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Mc=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Fc=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Bc=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let o;const i=r.slice(1,t);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(a=>ra(e,a))}return r},Hc=r=>typeof r=="string"?r.replace(" ","T"):r,na=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class ln{constructor(e,t,n={},s=ea){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var uo;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(uo||(uo={}));class Kt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Kt.syncState(this.state,s,o,i),this.pendingDiffs.forEach(l=>{this.state=Kt.syncDiff(this.state,l,o,i)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Kt.syncDiff(this.state,s,o,i),a())}),this.onJoin((s,o,i)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:i})}),this.onLeave((s,o,i)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const o=this.cloneDeep(e),i=this.transformState(t),a={},l={};return this.map(o,(c,h)=>{i[c]||(l[c]=h)}),this.map(i,(c,h)=>{const d=o[c];if(d){const p=h.map(v=>v.presence_ref),f=d.map(v=>v.presence_ref),_=h.filter(v=>f.indexOf(v.presence_ref)<0),g=d.filter(v=>p.indexOf(v.presence_ref)<0);_.length>0&&(a[c]=_),g.length>0&&(l[c]=g)}else a[c]=h}),this.syncDiff(o,{joins:a,leaves:l},n,s)}static syncDiff(e,t,n,s){const{joins:o,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(a,l)=>{var c;const h=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),h.length>0){const d=e[a].map(f=>f.presence_ref),p=h.filter(f=>d.indexOf(f.presence_ref)<0);e[a].unshift(...p)}n(a,h,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;const h=l.map(d=>d.presence_ref);c=c.filter(d=>h.indexOf(d.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ho;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(ho||(ho={}));var fo;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(fo||(fo={}));var We;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(We||(We={}));class cs{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=me.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ln(this,je.join,this.params,this.timeout),this.rejoinTimer=new ta(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=me.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=me.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=me.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=me.errored,this.rejoinTimer.scheduleTimeout())}),this._on(je.reply,{},(s,o)=>{this._trigger(this._replyEventName(o),s)}),this.presence=new Kt(this),this.broadcastEndpointURL=na(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==me.closed){const{config:{broadcast:o,presence:i,private:a}}=this.params;this._onError(h=>e==null?void 0:e(We.CHANNEL_ERROR,h)),this._onClose(()=>e==null?void 0:e(We.CLOSED));const l={},c={broadcast:o,presence:i,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(h=>h.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var d;if(this.socket.setAuth(),h===void 0){e==null||e(We.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,f=(d=p==null?void 0:p.length)!==null&&d!==void 0?d:0,_=[];for(let g=0;g<f;g++){const v=p[g],{filter:{event:y,schema:b,table:w,filter:C}}=v,A=h&&h[g];if(A&&A.event===y&&A.schema===b&&A.table===w&&A.filter===C)_.push(Object.assign(Object.assign({},v),{id:A.id}));else{this.unsubscribe(),this.state=me.errored,e==null||e(We.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=_,e&&e(We.SUBSCRIBED);return}}).receive("error",h=>{this.state=me.errored,e==null||e(We.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(We.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),c.receive("ok",()=>o("ok")),c.receive("error",()=>o("error")),c.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=me.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(je.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new ln(this,je.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(o),i}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new ln(this,e,t,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,o;const i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:h}=je;if(n&&[a,l,c,h].indexOf(i)>=0&&n!==this._joinRef())return;let p=this._onMessage(i,t,n);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var _,g,v;return((_=f.filter)===null||_===void 0?void 0:_.event)==="*"||((v=(g=f.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===i}).map(f=>f.callback(p,n)):(o=this.bindings[i])===null||o===void 0||o.filter(f=>{var _,g,v,y,b,w;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in f){const C=f.id,A=(_=f.filter)===null||_===void 0?void 0:_.event;return C&&((g=t.ids)===null||g===void 0?void 0:g.includes(C))&&(A==="*"||(A==null?void 0:A.toLocaleLowerCase())===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const C=(b=(y=f==null?void 0:f.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return C==="*"||C===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===i}).map(f=>{if(typeof p=="object"&&"ids"in p){const _=p.data,{schema:g,table:v,commit_timestamp:y,type:b,errors:w}=_;p=Object.assign(Object.assign({},{schema:g,table:v,commit_timestamp:y,eventType:b,new:{},old:{},errors:w}),this._getPayloadRecords(_))}f.callback(p,n)})}_isClosed(){return this.state===me.closed}_isJoined(){return this.state===me.joined}_isJoining(){return this.state===me.joining}_isLeaving(){return this.state===me.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),o={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&cs.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(je.close,{},e)}_onError(e){this._on(je.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=me.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=co(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=co(e.columns,e.old_record)),t}}const po=()=>{},qc=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Wc{constructor(e,t){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ea,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=po,this.ref=0,this.logger=po,this.conn=null,this.sendBuffer=[],this.serializer=new Nc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=o=>{let i;return o?i=o:typeof fetch>"u"?i=(...a)=>cr(async()=>{const{default:l}=await Promise.resolve().then(()=>Nt);return{default:l}},void 0).then(({default:l})=>l(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${Cn.websocket}`,this.httpEndpoint=na(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(n=t==null?void 0:t.params)===null||n===void 0?void 0:n.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(o,i)=>i(JSON.stringify(o)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ta(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Cc),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ic}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Vt.connecting:return st.Connecting;case Vt.open:return st.Open;case Vt.closing:return st.Closing;default:return st.Closed}}isConnected(){return this.connectionState()===st.Open}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new cs(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:n,payload:s,ref:o}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${n} (${o})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:jc};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(je.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Uc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:n,event:s,payload:o,ref:i}=t;n==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${o.status||""} ${n} ${s} ${i&&"("+i+")"||""}`,o),Array.from(this.channels).filter(a=>a._isMember(n)).forEach(a=>a._trigger(s,o,i)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(je.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([qc],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}}class us extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function fe(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Gc extends us{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class jn extends us{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var zc=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{c(n.next(h))}catch(d){i(d)}}function l(h){try{c(n.throw(h))}catch(d){i(d)}}function c(h){h.done?o(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const sa=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>cr(async()=>{const{default:n}=await Promise.resolve().then(()=>Nt);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Vc=()=>zc(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield cr(()=>Promise.resolve().then(()=>Nt),void 0)).Response:Response}),In=r=>{if(Array.isArray(r))return r.map(t=>In(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[s]=In(n)}),e};var ct=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{c(n.next(h))}catch(d){i(d)}}function l(h){try{c(n.throw(h))}catch(d){i(d)}}function c(h){h.done?o(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const cn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Kc=(r,e,t)=>ct(void 0,void 0,void 0,function*(){const n=yield Vc();r instanceof n&&!(t!=null&&t.noResolveJson)?r.json().then(s=>{e(new Gc(cn(s),r.status||500))}).catch(s=>{e(new jn(cn(s),s))}):e(new jn(cn(r),r))}),Jc=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n&&(s.body=JSON.stringify(n)),Object.assign(Object.assign({},s),t))};function dr(r,e,t,n,s,o){return ct(this,void 0,void 0,function*(){return new Promise((i,a)=>{r(t,Jc(e,n,s,o)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>Kc(l,a,n))})})}function jr(r,e,t,n){return ct(this,void 0,void 0,function*(){return dr(r,"GET",e,t,n)})}function Ye(r,e,t,n,s){return ct(this,void 0,void 0,function*(){return dr(r,"POST",e,n,s,t)})}function Yc(r,e,t,n,s){return ct(this,void 0,void 0,function*(){return dr(r,"PUT",e,n,s,t)})}function Qc(r,e,t,n){return ct(this,void 0,void 0,function*(){return dr(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function oa(r,e,t,n,s){return ct(this,void 0,void 0,function*(){return dr(r,"DELETE",e,n,s,t)})}var be=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{c(n.next(h))}catch(d){i(d)}}function l(h){try{c(n.throw(h))}catch(d){i(d)}}function c(h){h.done?o(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const Xc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_o={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Zc{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=sa(s)}uploadOrUpdate(e,t,n,s){return be(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},_o),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)});const l=i.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),l&&o.append("metadata",this.encodeMetadata(l)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.append("cacheControl",i.cacheControl),l&&o.append("metadata",this.encodeMetadata(l))):(o=n,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s!=null&&s.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(t),h=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:o,headers:a},i!=null&&i.duplex?{duplex:i.duplex}:{})),p=yield d.json();return d.ok?{data:{path:c,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(o){if(fe(o))return{data:null,error:o};throw o}})}upload(e,t,n){return be(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return be(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),i=this._getFinalPath(o),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:_o.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,h["cache-control"]=`max-age=${c.cacheControl}`,h["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:h}),p=yield d.json();return d.ok?{data:{path:o,fullPath:p.Key},error:null}:{data:null,error:p}}catch(l){if(fe(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return be(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const o=yield Ye(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),i=new URL(this.url+o.url),a=i.searchParams.get("token");if(!a)throw new us("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(n){if(fe(n))return{data:null,error:n};throw n}})}update(e,t,n){return be(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return be(this,void 0,void 0,function*(){try{return{data:yield Ye(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}copy(e,t,n){return be(this,void 0,void 0,function*(){try{return{data:{path:(yield Ye(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return be(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),o=yield Ye(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return be(this,void 0,void 0,function*(){try{const s=yield Ye(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}download(e,t){return be(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),i=o?`?${o}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield jr(this.fetch,`${this.url}/${s}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(fe(a))return{data:null,error:a};throw a}})}info(e){return be(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield jr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:In(n),error:null}}catch(n){if(fe(n))return{data:null,error:n};throw n}})}exists(e){return be(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Qc(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(fe(n)&&n instanceof jn){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],o=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&s.push(o);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return be(this,void 0,void 0,function*(){try{return{data:yield oa(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(fe(t))return{data:null,error:t};throw t}})}list(e,t,n){return be(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Xc),t),{prefix:e||""});return{data:yield Ye(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(fe(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const eu="2.7.1",tu={"X-Client-Info":`storage-js/${eu}`};var gt=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{c(n.next(h))}catch(d){i(d)}}function l(h){try{c(n.throw(h))}catch(d){i(d)}}function c(h){h.done?o(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class ru{constructor(e,t={},n){this.url=e,this.headers=Object.assign(Object.assign({},tu),t),this.fetch=sa(n)}listBuckets(){return gt(this,void 0,void 0,function*(){try{return{data:yield jr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(fe(e))return{data:null,error:e};throw e}})}getBucket(e){return gt(this,void 0,void 0,function*(){try{return{data:yield jr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(fe(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return gt(this,void 0,void 0,function*(){try{return{data:yield Ye(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(fe(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return gt(this,void 0,void 0,function*(){try{return{data:yield Yc(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(fe(n))return{data:null,error:n};throw n}})}emptyBucket(e){return gt(this,void 0,void 0,function*(){try{return{data:yield Ye(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(fe(t))return{data:null,error:t};throw t}})}deleteBucket(e){return gt(this,void 0,void 0,function*(){try{return{data:yield oa(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(fe(t))return{data:null,error:t};throw t}})}}class nu extends ru{constructor(e,t={},n){super(e,t,n)}from(e){return new Zc(this.url,this.headers,e,this.fetch)}}const su="2.50.5";let Wt="";typeof Deno<"u"?Wt="deno":typeof document<"u"?Wt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Wt="react-native":Wt="node";const ou={"X-Client-Info":`supabase-js-${Wt}/${su}`},iu={headers:ou},au={schema:"public"},lu={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},cu={};var uu=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{c(n.next(h))}catch(d){i(d)}}function l(h){try{c(n.throw(h))}catch(d){i(d)}}function c(h){h.done?o(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const du=r=>{let e;return r?e=r:typeof fetch>"u"?e=qi:e=fetch,(...t)=>e(...t)},hu=()=>typeof Headers>"u"?Wi:Headers,fu=(r,e,t)=>{const n=du(t),s=hu();return(o,i)=>uu(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:r;let c=new s(i==null?void 0:i.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(o,Object.assign(Object.assign({},i),{headers:c}))})};var pu=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{c(n.next(h))}catch(d){i(d)}}function l(h){try{c(n.throw(h))}catch(d){i(d)}}function c(h){h.done?o(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};function _u(r){return r.endsWith("/")?r:r+"/"}function gu(r,e){var t,n;const{db:s,auth:o,realtime:i,global:a}=r,{db:l,auth:c,realtime:h,global:d}=e,p={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),o),realtime:Object.assign(Object.assign({},h),i),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(n=a==null?void 0:a.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>pu(this,void 0,void 0,function*(){return""})};return r.accessToken?p.accessToken=r.accessToken:delete p.accessToken,p}const ia="2.70.0",St=30*1e3,Un=3,un=Un*St,vu="http://localhost:9999",mu="supabase.auth.token",yu={"X-Client-Info":`gotrue-js/${ia}`},Nn="X-Supabase-Api-Version",aa={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},bu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,wu=6e5;class ds extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function B(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Su extends ds{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Eu(r){return B(r)&&r.name==="AuthApiError"}class la extends ds{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Xe extends ds{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Ke extends Xe{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function $u(r){return B(r)&&r.name==="AuthSessionMissingError"}class wr extends Xe{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Sr extends Xe{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Er extends Xe{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Tu(r){return B(r)&&r.name==="AuthImplicitGrantRedirectError"}class go extends Xe{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ln extends Xe{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function dn(r){return B(r)&&r.name==="AuthRetryableFetchError"}class vo extends Xe{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Jt extends Xe{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ir="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),mo=` 	
\r=`.split(""),Pu=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<mo.length;e+=1)r[mo[e].charCodeAt(0)]=-2;for(let e=0;e<Ir.length;e+=1)r[Ir[e].charCodeAt(0)]=e;return r})();function yo(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Ir[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Ir[n]),e.queuedBits-=6}}function ca(r,e,t){const n=Pu[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function bo(r){const e=[],t=i=>{e.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=i=>{Ou(i,n,t)};for(let i=0;i<r.length;i+=1)ca(r.charCodeAt(i),s,o);return e.join("")}function ku(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Au(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}ku(n,e)}}function Ou(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if(!(r>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Ru(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)ca(r.charCodeAt(s),t,n);return new Uint8Array(e)}function Cu(r){const e=[];return Au(r,t=>e.push(t)),new Uint8Array(e)}function xu(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>yo(s,t,n)),yo(null,t,n),e.join("")}function ju(r){return Math.round(Date.now()/1e3)+r}function Iu(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const xe=()=>typeof window<"u"&&typeof document<"u",et={tested:!1,writable:!1},Yt=()=>{if(!xe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(et.tested)return et.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),et.tested=!0,et.writable=!0}catch{et.tested=!0,et.writable=!1}return et.writable};function Uu(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,o)=>{e[o]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const ua=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>cr(async()=>{const{default:n}=await Promise.resolve().then(()=>Nt);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Nu=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",da=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},$r=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Tr=async(r,e)=>{await r.removeItem(e)};class Kr{constructor(){this.promise=new Kr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Kr.promiseConstructor=Promise;function hn(r){const e=r.split(".");if(e.length!==3)throw new Jt("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!bu.test(e[n]))throw new Jt("JWT not in base64url format");return{header:JSON.parse(bo(e[0])),payload:JSON.parse(bo(e[1])),signature:Ru(e[2]),raw:{header:e[0],payload:e[1]}}}async function Lu(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Du(r,e){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await r(o);if(!e(o,null,i)){n(i);return}}catch(i){if(!e(o,i)){s(i);return}}})()})}function Mu(r){return("0"+r.toString(16)).substr(-2)}function Fu(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let o=0;o<56;o++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Mu).join("")}async function Bu(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function Hu(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Bu(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function vt(r,e,t=!1){const n=Fu();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await da(r,`${e}-code-verifier`,s);const o=await Hu(n);return[o,n===o?"plain":"s256"]}const qu=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Wu(r){const e=r.headers.get(Nn);if(!e||!e.match(qu))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Gu(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function zu(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Vu=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function mt(r){if(!Vu.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var Ku=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};const rt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Ju=[502,503,504];async function wo(r){var e;if(!Nu(r))throw new Ln(rt(r),0);if(Ju.includes(r.status))throw new Ln(rt(r),r.status);let t;try{t=await r.json()}catch(o){throw new la(rt(o),o)}let n;const s=Wu(r);if(s&&s.getTime()>=aa["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new vo(rt(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Ke}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new vo(rt(t),r.status,t.weak_password.reasons);throw new Su(rt(t),r.status||500,n)}const Yu=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function z(r,e,t,n){var s;const o=Object.assign({},n==null?void 0:n.headers);o[Nn]||(o[Nn]=aa["2024-01-01"].name),n!=null&&n.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const i=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(i.redirect_to=n.redirectTo);const a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await Qu(r,e,t+a,{headers:o,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function Qu(r,e,t,n,s,o){const i=Yu(e,n,s,o);let a;try{a=await r(t,Object.assign({},i))}catch(l){throw console.error(l),new Ln(rt(l),0)}if(a.ok||await wo(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(l){await wo(l)}}function qe(r){var e;let t=null;td(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=ju(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function So(r){const e=qe(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function Qe(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Xu(r){return{data:r,error:null}}function Zu(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:o}=r,i=Ku(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:o},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function ed(r){return r}function td(r){return r.access_token&&r.refresh_token&&r.expires_in}const fn=["global","local","others"];var rd=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};class nd{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=ua(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=fn[0]){if(fn.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fn.join(", ")}`);try{return await z(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await z(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Qe})}catch(n){if(B(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=rd(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await z(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Zu,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(B(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await z(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Qe})}catch(t){if(B(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,o,i,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await z(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:ed});if(h.error)throw h.error;const d=await h.json(),p=(i=h.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(_=>{const g=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(_.split(";")[1].split("=")[1]);c[`${v}Page`]=g}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(B(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){mt(e);try{return await z(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Qe})}catch(t){if(B(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){mt(e);try{return await z(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Qe})}catch(n){if(B(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){mt(e);try{return await z(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Qe})}catch(n){if(B(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){mt(e.userId);try{const{data:t,error:n}=await z(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(B(t))return{data:null,error:t};throw t}}async _deleteFactor(e){mt(e.userId),mt(e.id);try{return{data:await z(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}}}const sd={getItem:r=>Yt()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{Yt()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{Yt()&&globalThis.localStorage.removeItem(r)}};function Eo(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function od(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const yt={debug:!!(globalThis&&Yt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ha extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class id extends ha{}async function ad(r,e,t){yt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),yt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){yt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{yt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw yt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new id(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(yt.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}od();const ld={url:vu,storageKey:mu,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:yu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function $o(r,e,t){return await t()}class er{constructor(e){var t,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=er.nextInstanceID,er.nextInstanceID+=1,this.instanceID>0&&xe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},ld),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new nd({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=ua(s.fetch),this.lock=s.lock||$o,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:xe()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ad:this.lock=$o,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Yt()?this.storage=sd:(this.memoryStorage={},this.storage=Eo(this.memoryStorage)):(this.memoryStorage={},this.storage=Eo(this.memoryStorage)),xe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ia}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Uu(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),xe()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(t,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),Tu(o)){const l=(e=o.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return B(t)?{error:t}:{error:new la("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const o=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:qe}),{data:i,error:a}=o;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(B(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,n,s;try{let o;if("email"in e){const{email:h,password:d,options:p}=e;let f=null,_=null;this.flowType==="pkce"&&([f,_]=await vt(this.storage,this.storageKey)),o=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:h,password:d,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:f,code_challenge_method:_},xform:qe})}else if("phone"in e){const{phone:h,password:d,options:p}=e;o=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:d,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},channel:(s=p==null?void 0:p.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:qe})}else throw new Sr("You must provide either an email or phone number and a password");const{data:i,error:a}=o;if(a||!i)return{data:{user:null,session:null},error:a};const l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(B(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:i,options:a}=e;t=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:So})}else if("phone"in e){const{phone:o,password:i,options:a}=e;t=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:So})}else throw new Sr("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new wr}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(B(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,o,i,a,l,c,h,d,p,f;let _,g;if("message"in e)_=e.message,g=e.signature;else{const{chain:v,wallet:y,statement:b,options:w}=e;let C;if(xe())if(typeof y=="object")C=y;else{const N=window;if("solana"in N&&typeof N.solana=="object"&&("signIn"in N.solana&&typeof N.solana.signIn=="function"||"signMessage"in N.solana&&typeof N.solana.signMessage=="function"))C=N.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");C=y}const A=new URL((t=w==null?void 0:w.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in C&&C.signIn){const N=await C.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:A.host,uri:A.href}),b?{statement:b}:null));let Z;if(Array.isArray(N)&&N[0]&&typeof N[0]=="object")Z=N[0];else if(N&&typeof N=="object"&&"signedMessage"in N&&"signature"in N)Z=N;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Z&&"signature"in Z&&(typeof Z.signedMessage=="string"||Z.signedMessage instanceof Uint8Array)&&Z.signature instanceof Uint8Array)_=typeof Z.signedMessage=="string"?Z.signedMessage:new TextDecoder().decode(Z.signedMessage),g=Z.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in C)||typeof C.signMessage!="function"||!("publicKey"in C)||typeof C!="object"||!C.publicKey||!("toBase58"in C.publicKey)||typeof C.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${A.host} wants you to sign in with your Solana account:`,C.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${A.href}`,`Issued At: ${(s=(n=w==null?void 0:w.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((d=(h=w==null?void 0:w.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||d===void 0)&&d.length?["Resources",...w.signInWithSolana.resources.map(Z=>`- ${Z}`)]:[]].join(`
`);const N=await C.signMessage(new TextEncoder().encode(_),"utf8");if(!N||!(N instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=N}}try{const{data:v,error:y}=await z(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:xu(g)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:qe});if(y)throw y;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new wr}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:y})}catch(v){if(B(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const t=await $r(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:o,error:i}=await z(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:qe});if(await Tr(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new wr}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:i})}catch(o){if(B(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:o,nonce:i}=e,a=await z(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:qe}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new wr}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(B(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,o,i;try{if("email"in e){const{email:a,options:l}=e;let c=null,h=null;this.flowType==="pkce"&&([c,h]=await vt(this.storage,this.storageKey));const{error:d}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:h},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:h}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(o=l==null?void 0:l.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(i=l==null?void 0:l.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:h}}throw new Sr("You must provide either an email or phone number.")}catch(a){if(B(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,n;try{let s,o;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:a}=await z(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:qe});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");const l=i.session,c=i.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(B(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let o=null,i=null;return this.flowType==="pkce"&&([o,i]=await vt(this.storage,this.storageKey)),await z(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:i}),headers:this.headers,xform:Xu})}catch(o){if(B(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Ke;const{error:s}=await z(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(B(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:o}=e,{error:i}=await z(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){const{phone:n,type:s,options:o}=e,{data:i,error:a}=await z(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:a}}throw new Sr("You must provide either an email or phone number and a type")}catch(t){if(B(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await $r(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<un:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,h)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,h))})}return{data:{session:e},error:null}}const{session:s,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Qe}):await this._useSession(async t=>{var n,s,o;const{data:i,error:a}=t;if(a)throw a;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ke}:await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:Qe})})}catch(t){if(B(t))return $u(t)&&(await this._removeSession(),await Tr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new Ke;const i=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await vt(this.storage,this.storageKey));const{data:c,error:h}=await z(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:Qe});if(h)throw h;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(B(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ke;const t=Date.now()/1e3;let n=t,s=!0,o=null;const{payload:i}=hn(e.access_token);if(i.exp&&(n=i.exp,s=n<=t),s){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};o=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;o={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(B(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:i,error:a}=t;if(a)throw a;e=(n=i.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Ke;const{session:s,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(B(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!xe())throw new Er("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Er(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new go("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Er("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new go("No code detected.");const{data:b,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const C=new URL(window.location.href);return C.searchParams.delete("code"),window.history.replaceState(window.history.state,"",C.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!o||!a||!i||!c)throw new Er("No session defined in URL");const h=Math.round(Date.now()/1e3),d=parseInt(a);let p=h+d;l&&(p=parseInt(l));const f=p-h;f*1e3<=St&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const _=p-d;h-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,p,h):h-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,p,h);const{data:g,error:v}=await this._getUser(o);if(v)throw v;const y={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:d,expires_at:p,refresh_token:i,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(n){if(B(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await $r(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:o}=t;if(o)return{error:o};const i=(n=s.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:a}=await this.admin.signOut(i,e);if(a&&!(Eu(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Tr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Iu(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:o},error:i}=t;if(i)throw i;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await vt(this.storage,this.storageKey,!0));try{return await z(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(B(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(B(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async o=>{var i,a,l,c,h;const{data:d,error:p}=o;if(p)throw p;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await z(this.fetch,"GET",f,{headers:this.headers,jwt:(h=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return xe()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(B(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:o,error:i}=t;if(i)throw i;return await z(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(B(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await Du(async s=>(s>0&&await Lu(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await z(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:qe})),(s,o)=>{const i=200*Math.pow(2,s);return o&&dn(o)&&Date.now()+i-n<St})}catch(n){if(this._debug(t,"error",n),B(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),xe()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const n=await $r(this.storage,this.storageKey);if(this._debug(t,"session from storage",n),!this._isValidSession(n)){this._debug(t,"session is not valid"),n!==null&&await this._removeSession();return}const s=((e=n.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<un;if(this._debug(t,`session has${s?"":" not"} expired with margin of ${un}s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),dn(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(t,"error",n),console.error(n);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Ke;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Kr;const{data:o,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!o.session)throw new Ke;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const a={session:o.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(o){if(this._debug(s,"error",o),B(o)){const i={session:null,error:o};return dn(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){o.push(l)}});if(await Promise.all(i),o.length>0){for(let a=0;a<o.length;a+=1)console.error(o[a]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await da(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Tr(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&xe()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),St);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/St);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${St}ms, refresh threshold is ${Un} ticks`),s<=Un&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ha)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!xe()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,i]=await vt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});s.push(a.toString())}if(n!=null&&n.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;return o?{data:null,error:o}:await z(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(B(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:o,error:i}=t;if(i)return{data:null,error:i};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await z(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(B(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;if(o)return{data:null,error:o};const{data:i,error:a}=await z(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(t){if(B(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;return o?{data:null,error:o}:await z(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(B(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(e==null?void 0:e.factors)||[],s=n.filter(i=>i.factor_type==="totp"&&i.status==="verified"),o=n.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:n,totp:s,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:o}=e;if(o)return{data:null,error:o};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=hn(s.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const h=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(i=>i.kid===e);if(n||(n=this.jwks.keys.find(i=>i.kid===e),n&&this.jwks_cached_at+wu>Date.now()))return n;const{data:s,error:o}=await z(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;if(!s.keys||s.keys.length===0)throw new Jt("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),n=s.keys.find(i=>i.kid===e),!n)throw new Jt("No matching signing key found in JWKS");return n}async getClaims(e,t={keys:[]}){try{let n=e;if(!n){const{data:f,error:_}=await this.getSession();if(_||!f.session)return{data:null,error:_};n=f.session.access_token}const{header:s,payload:o,signature:i,raw:{header:a,payload:l}}=hn(n);if(Gu(o.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:f}=await this.getUser(n);if(f)throw f;return{data:{claims:o,header:s,signature:i},error:null}}const c=zu(s.alg),h=await this.fetchJwk(s.kid,t),d=await crypto.subtle.importKey("jwk",h,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,i,Cu(`${a}.${l}`)))throw new Jt("Invalid JWT signature");return{data:{claims:o,header:s,signature:i},error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}}}er.nextInstanceID=0;const cd=er;class ud extends cd{constructor(e){super(e)}}var dd=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{c(n.next(h))}catch(d){i(d)}}function l(h){try{c(n.throw(h))}catch(d){i(d)}}function c(h){h.done?o(h.value):s(h.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class hd{constructor(e,t,n){var s,o,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=_u(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,h={db:au,realtime:cu,auth:Object.assign(Object.assign({},lu),{storageKey:c}),global:iu},d=gu(n??{},h);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=d.global.headers)!==null&&o!==void 0?o:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(p,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=fu(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Oc(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new oc(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new nu(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return dd(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:o,flowType:i,lock:a,debug:l},c,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ud({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:i,lock:a,debug:l,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Wc(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const fd=(r,e,t)=>new hd(r,e,t),pd=void 0,_d=void 0;console.error("Supabase URL or Anon Key is missing. Make sure to set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your .env file.");const ee=fd(pd,_d,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1,storageKey:"sb-auth-token",flowType:"pkce"},db:{schema:"public"},global:{headers:{"Content-Type":"application/json"},fetch:(r,e={})=>fetch(r,{...e,signal:AbortSignal.timeout(1e4)})}}),fa=async()=>{try{console.log("Testing Supabase connection...");const{data:r,error:e}=await ee.from("watch_history").select("count").limit(1);return e?(console.error("Supabase connection test failed:",e),!1):(console.log("Supabase connection test successful"),!0)}catch(r){return console.error("Supabase connection test error:",r),!1}};typeof window<"u"&&(window.supabase=ee,window.testSupabaseConnection=fa);const pa=ar();function gd({children:r}){const[e,t]=R(null),[n,s]=R(null),[o,i]=R(!0);re(()=>{(async()=>{const{data:{session:h}}=await ee.auth.getSession();t(h),s((h==null?void 0:h.user)??null),i(!1)})();const{data:c}=ee.auth.onAuthStateChange((h,d)=>{t(d),s((d==null?void 0:d.user)??null)});return()=>{c.subscription.unsubscribe()}},[]);const a={session:e,user:n,signOut:()=>ee.auth.signOut()};return u(pa.Provider,{value:a,children:!o&&r})}function ut(){return lr(pa)}let vd=0,Rt=null;const Ur={success:(r,e={})=>Pr(r,"success",e),error:(r,e={})=>Pr(r,"error",e),info:(r,e={})=>Pr(r,"info",e),warning:(r,e={})=>Pr(r,"warning",e)},Pr=(r,e="info",t={})=>{if(!Rt)return;const n=vd++,s=t.duration||(e==="error"?6e3:4e3),o={id:n,message:r,type:e,duration:s,timestamp:Date.now()};return Rt(i=>[...i,o]),setTimeout(()=>{Dn(n)},s),n},Dn=r=>{Rt&&Rt(e=>e.filter(t=>t.id!==r))},md=({position:r="top-center"})=>{const[e,t]=R([]);return re(()=>(Rt=t,()=>{Rt=null}),[]),e.length===0?null:u("div",{class:`toast-container toast-container--${r}`,children:e.map(n=>u("div",{class:`toast toast--${n.type}`,onClick:()=>Dn(n.id),children:[u("div",{class:"toast__content",children:[n.type==="success"&&u("span",{class:"toast__icon",children:""}),n.type==="error"&&u("span",{class:"toast__icon",children:""}),n.type==="warning"&&u("span",{class:"toast__icon",children:""}),n.type==="info"&&u("span",{class:"toast__icon",children:""}),u("span",{class:"toast__message",children:n.message})]}),u("button",{class:"toast__close",onClick:s=>{s.stopPropagation(),Dn(n.id)},children:""})]},n.id))})},Se={DARK:"dark",LIGHT:"light"},hs=()=>{const r=localStorage.getItem("theme");return r&&Object.values(Se).includes(r)?r:window.matchMedia("(prefers-color-scheme: dark)").matches?Se.DARK:Se.LIGHT},Mn=r=>{Object.values(Se).includes(r)||(console.warn(`Invalid theme: ${r}. Using default dark theme.`),r=Se.DARK),r===Se.LIGHT?document.documentElement.setAttribute("data-theme","light"):document.documentElement.removeAttribute("data-theme"),localStorage.setItem("theme",r),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:r}}))},yd=()=>{const e=hs()===Se.LIGHT?Se.DARK:Se.LIGHT;return Mn(e),e},bd=()=>{const r=hs();Mn(r),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||Mn(e.matches?Se.DARK:Se.LIGHT)})},wd=()=>{const[r,e]=R(!0);return re(()=>{const n=hs();e(n===Se.DARK);const s=o=>{e(o.detail.theme===Se.DARK)};return window.addEventListener("themeChanged",s),()=>{window.removeEventListener("themeChanged",s)}},[]),u("button",{class:`theme-toggle ${r?"dark":"light"}`,onClick:()=>{const n=yd();e(n===Se.DARK)},"aria-label":`Switch to ${r?"light":"dark"} mode`,title:`Switch to ${r?"light":"dark"} mode`,children:u("div",{class:"toggle-track",children:u("div",{class:"toggle-thumb",children:u("div",{class:"icon",children:r?u("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:u("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):u("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[u("circle",{cx:"12",cy:"12",r:"5"}),u("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),u("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),u("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),u("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),u("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),u("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),u("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),u("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})})})})},Sd=()=>{const[r,e]=R(""),[t,n]=R(!1),[s,o]=R(!1),{user:i,signOut:a}=ut(),l=p=>{p.preventDefault(),r.trim()&&(Ie(`/search?q=${encodeURIComponent(r.trim())}`),e(""),o(!1))},c=async()=>{await a(),Ie("/")},h=()=>{n(!t),o(!1)};return u("header",{children:u("div",{class:"container",children:[u("div",{class:"header-left",children:[u(Ne,{href:"/",class:"logo",children:"FreeStream"}),u("nav",{class:t?"active":"",children:u("ul",{onClick:()=>n(!1),children:[u("li",{children:u(Ne,{activeClassName:"active",href:"/movies",children:"Movies"})}),u("li",{children:u(Ne,{activeClassName:"active",href:"/tv",children:"TV"})}),i?u(ve,{children:[u("li",{children:u(Ne,{activeClassName:"active",href:"/favorites",children:"Favorites"})}),u("li",{children:u(Ne,{activeClassName:"active",href:"/history",children:"History"})})]}):u(ve,{children:[u("li",{children:u("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"Favorites (Login Required)"})}),u("li",{children:u("a",{href:"/login",style:{color:"#999",fontSize:"0.9em"},children:"History (Login Required)"})})]})]})})]}),s&&u("div",{class:"mobile-search-overlay",children:u("form",{class:"mobile-search-form",onSubmit:l,children:[u("input",{type:"text",placeholder:"Search movies & TV shows...",value:r,onInput:p=>e(p.target.value),class:"mobile-search-input",autoFocus:!0}),u("button",{type:"submit",class:"mobile-search-submit",children:u("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[u("circle",{cx:"11",cy:"11",r:"8"}),u("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]})}),u("div",{class:"header-right",children:[u("form",{class:"search-container desktop-only",onSubmit:l,children:u("input",{type:"text",placeholder:"Search...",value:r,onInput:p=>e(p.target.value),class:"glass-light"})}),u("button",{class:"search-toggle mobile-only",onClick:()=>{o(!s),n(!1)},"aria-label":"Toggle search",children:u("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[u("circle",{cx:"11",cy:"11",r:"8"}),u("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}),u(wd,{}),u("div",{class:"auth-links",children:i?u(ve,{children:[u("span",{class:"user-email",children:i.email}),u("button",{onClick:c,class:"auth-button",children:"Logout"})]}):u(ve,{children:[u(Ne,{href:"/login",class:"auth-link",children:"Login"}),u(Ne,{href:"/signup",class:"auth-link",children:"Sign Up"})]})})]}),u("button",{class:"hamburger",onClick:h,"aria-label":"Toggle menu",children:[u("span",{class:"bar"}),u("span",{class:"bar"}),u("span",{class:"bar"})]})]})})};var Ed=["className","activeClass","activeClassName","path"];function Je(r){var e=r.className,t=r.activeClass,n=r.activeClassName,s=r.path,o=function(h,d){if(h==null)return{};var p,f,_={},g=Object.keys(h);for(f=0;f<g.length;f++)d.indexOf(p=g[f])>=0||(_[p]=h[p]);return _}(r,Ed),i=Vl()[0],a=s&&i.path&&An(i.path,s,{})||An(i.url,o.href,{}),l=o.class||e||"",c=a&&(t||n)||"";return o.class=l+(l&&c&&" ")+c,ye(Ne,o)}const $d=()=>u("footer",{class:"app-footer",children:[u("div",{class:"footer-content",children:[u("div",{class:"footer-brand",children:[u(Je,{href:"/",class:"logo",children:"FreeStream"}),u("p",{children:"Your gateway to unlimited entertainment. Built with passion."})]}),u("div",{class:"footer-links",children:[u("div",{class:"footer-section",children:[u("h4",{children:"Platform"}),u("ul",{children:[u("li",{children:u(Je,{href:"/",children:"Home"})}),u("li",{children:u(Je,{href:"/movies",children:"Movies"})}),u("li",{children:u(Je,{href:"/tv",children:"TV Shows"})})]})]}),u("div",{class:"footer-section",children:[u("h4",{children:"Account"}),u("ul",{children:[u("li",{children:u(Je,{href:"/login",children:"Login"})}),u("li",{children:u(Je,{href:"/signup",children:"Sign Up"})}),u("li",{children:u(Je,{href:"/favorites",children:"Favorites"})})]})]}),u("div",{class:"footer-section",children:[u("h4",{children:"Legal"}),u("ul",{children:[u("li",{children:u("a",{href:"#",children:"Terms of Service"})}),u("li",{children:u("a",{href:"#",children:"Privacy Policy"})})]})]})]})]}),u("div",{class:"footer-bottom",children:[u("p",{children:" 2024 FreeStream. All Rights Reserved. Not a real streaming service."}),u("div",{class:"footer-socials",children:[u("a",{href:"#","aria-label":"Github",children:u("i",{class:"fab fa-github"})}),u("a",{href:"#","aria-label":"Twitter",children:u("i",{class:"fab fa-twitter"})})]})]})]}),Td={},To=r=>{let e;const t=new Set,n=(h,d)=>{const p=typeof h=="function"?h(e):h;if(!Object.is(p,e)){const f=e;e=d??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(_=>_(e,f))}},s=()=>e,l={setState:n,getState:s,getInitialState:()=>c,subscribe:h=>(t.add(h),()=>t.delete(h)),destroy:()=>{(Td?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},c=e=r(n,s,l);return l},Pd=r=>r?To(r):To;function _a(r,e){for(var t in e)r[t]=e[t];return r}function Fn(r,e){for(var t in r)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&r[n]!==e[n])return!0;return!1}function fs(r,e){var t=e(),n=R({t:{__:t,u:e}}),s=n[0].t,o=n[1];return It(function(){s.__=t,s.u=e,pn(s)&&o({t:s})},[r,t,e]),re(function(){return pn(s)&&o({t:s}),r(function(){pn(s)&&o({t:s})})},[r]),t}function pn(r){var e,t,n=r.u,s=r.__;try{var o=n();return!((e=s)===(t=o)&&(e!==0||1/e==1/t)||e!=e&&t!=t)}catch{return!0}}function ps(r){r()}function _s(r){return r}function gs(){return[!1,ps]}var vs=It;function Nr(r,e){this.props=r,this.context=e}function ga(r,e){function t(s){var o=this.props.ref,i=o==s.ref;return!i&&o&&(o.call?o(null):o.current=null),e?!e(this.props,s)||!i:Fn(this.props,s)}function n(s){return this.shouldComponentUpdate=t,ye(r,s)}return n.displayName="Memo("+(r.displayName||r.name)+")",n.prototype.isReactComponent=!0,n.__f=!0,n}(Nr.prototype=new Pe).isPureReactComponent=!0,Nr.prototype.shouldComponentUpdate=function(r,e){return Fn(this.props,r)||Fn(this.state,e)};var Po=H.__b;H.__b=function(r){r.type&&r.type.__f&&r.ref&&(r.props.ref=r.ref,r.ref=null),Po&&Po(r)};var kd=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function va(r){function e(t){var n=_a({},t);return delete n.ref,r(n,t.ref||null)}return e.$$typeof=kd,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(r.displayName||r.name)+")",e}var ko=function(r,e){return r==null?null:Ae(Ae(r).map(e))},ma={map:ko,forEach:ko,count:function(r){return r?Ae(r).length:0},only:function(r){var e=Ae(r);if(e.length!==1)throw"Children.only";return e[0]},toArray:Ae},Ad=H.__e;H.__e=function(r,e,t,n){if(r.then){for(var s,o=e;o=o.__;)if((s=o.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(r,e)}Ad(r,e,t,n)};var Ao=H.unmount;function ya(r,e,t){return r&&(r.__c&&r.__c.__H&&(r.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),r.__c.__H=null),(r=_a({},r)).__c!=null&&(r.__c.__P===t&&(r.__c.__P=e),r.__c.__e=!0,r.__c=null),r.__k=r.__k&&r.__k.map(function(n){return ya(n,e,t)})),r}function ba(r,e,t){return r&&t&&(r.__v=null,r.__k=r.__k&&r.__k.map(function(n){return ba(n,e,t)}),r.__c&&r.__c.__P===e&&(r.__e&&t.appendChild(r.__e),r.__c.__e=!0,r.__c.__P=t)),r}function Qt(){this.__u=0,this.o=null,this.__b=null}function wa(r){var e=r.__.__c;return e&&e.__a&&e.__a(r)}function Sa(r){var e,t,n;function s(o){if(e||(e=r()).then(function(i){t=i.default||i},function(i){n=i}),n)throw n;if(!t)throw e;return ye(t,o)}return s.displayName="Lazy",s.__f=!0,s}function Tt(){this.i=null,this.l=null}H.unmount=function(r){var e=r.__c;e&&e.__R&&e.__R(),e&&32&r.__u&&(r.type=null),Ao&&Ao(r)},(Qt.prototype=new Pe).__c=function(r,e){var t=e.__c,n=this;n.o==null&&(n.o=[]),n.o.push(t);var s=wa(n.__v),o=!1,i=function(){o||(o=!0,t.__R=null,s?s(a):a())};t.__R=i;var a=function(){if(!--n.__u){if(n.state.__a){var l=n.state.__a;n.__v.__k[0]=ba(l,l.__c.__P,l.__c.__O)}var c;for(n.setState({__a:n.__b=null});c=n.o.pop();)c.forceUpdate()}};n.__u++||32&e.__u||n.setState({__a:n.__b=n.__v.__k[0]}),r.then(i,i)},Qt.prototype.componentWillUnmount=function(){this.o=[]},Qt.prototype.render=function(r,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=ya(this.__b,t,n.__O=n.__P)}this.__b=null}var s=e.__a&&ye(ve,null,r.fallback);return s&&(s.__u&=-33),[ye(ve,null,e.__a?null:r.children),s]};var Oo=function(r,e,t){if(++t[1]===t[0]&&r.l.delete(e),r.props.revealOrder&&(r.props.revealOrder[0]!=="t"||!r.l.size))for(t=r.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;r.i=t=t[2]}};function Od(r){return this.getChildContext=function(){return r.context},r.children}function Rd(r){var e=this,t=r.h;if(e.componentWillUnmount=function(){at(null,e.v),e.v=null,e.h=null},e.h&&e.h!==t&&e.componentWillUnmount(),!e.v){for(var n=e.__v;n!==null&&!n.__m&&n.__!==null;)n=n.__;e.h=t,e.v={nodeType:1,parentNode:t,childNodes:[],__k:{__m:n.__m},contains:function(){return!0},insertBefore:function(s,o){this.childNodes.push(s),e.h.insertBefore(s,o)},removeChild:function(s){this.childNodes.splice(this.childNodes.indexOf(s)>>>1,1),e.h.removeChild(s)}}}at(ye(Od,{context:e.context},r.__v),e.v)}function Ea(r,e){var t=ye(Rd,{__v:r,h:e});return t.containerInfo=e,t}(Tt.prototype=new Pe).__a=function(r){var e=this,t=wa(e.__v),n=e.l.get(r);return n[0]++,function(s){var o=function(){e.props.revealOrder?(n.push(s),Oo(e,r,n)):s()};t?t(o):o()}},Tt.prototype.render=function(r){this.i=null,this.l=new Map;var e=Ae(r.children);r.revealOrder&&r.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return r.children},Tt.prototype.componentDidUpdate=Tt.prototype.componentDidMount=function(){var r=this;this.l.forEach(function(e,t){Oo(r,t,e)})};var $a=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Cd=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,xd=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,jd=/[A-Z0-9]/g,Id=typeof document<"u",Ud=function(r){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(r)};function Ta(r,e,t){return e.__k==null&&(e.textContent=""),at(r,e),typeof t=="function"&&t(),r?r.__c:null}function Pa(r,e,t){return Xn(r,e),typeof t=="function"&&t(),r?r.__c:null}Pe.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(r){Object.defineProperty(Pe.prototype,r,{configurable:!0,get:function(){return this["UNSAFE_"+r]},set:function(e){Object.defineProperty(this,r,{configurable:!0,writable:!0,value:e})}})});var Ro=H.event;function Nd(){}function Ld(){return this.cancelBubble}function Dd(){return this.defaultPrevented}H.event=function(r){return Ro&&(r=Ro(r)),r.persist=Nd,r.isPropagationStopped=Ld,r.isDefaultPrevented=Dd,r.nativeEvent=r};var ms,Md={enumerable:!1,configurable:!0,get:function(){return this.class}},Co=H.vnode;H.vnode=function(r){typeof r.type=="string"&&function(e){var t=e.props,n=e.type,s={},o=n.indexOf("-")===-1;for(var i in t){var a=t[i];if(!(i==="value"&&"defaultValue"in t&&a==null||Id&&i==="children"&&n==="noscript"||i==="class"||i==="className")){var l=i.toLowerCase();i==="defaultValue"&&"value"in t&&t.value==null?i="value":i==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?i="ondblclick":l!=="onchange"||n!=="input"&&n!=="textarea"||Ud(t.type)?l==="onfocus"?i="onfocusin":l==="onblur"?i="onfocusout":xd.test(i)&&(i=l):l=i="oninput":o&&Cd.test(i)?i=i.replace(jd,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&s[i=l]&&(i="oninputCapture"),s[i]=a}}n=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=Ae(t.children).forEach(function(c){c.props.selected=s.value.indexOf(c.props.value)!=-1})),n=="select"&&s.defaultValue!=null&&(s.value=Ae(t.children).forEach(function(c){c.props.selected=s.multiple?s.defaultValue.indexOf(c.props.value)!=-1:s.defaultValue==c.props.value})),t.class&&!t.className?(s.class=t.class,Object.defineProperty(s,"className",Md)):(t.className&&!t.class||t.class&&t.className)&&(s.class=s.className=t.className),e.props=s}(r),r.$$typeof=$a,Co&&Co(r)};var xo=H.__r;H.__r=function(r){xo&&xo(r),ms=r.__c};var jo=H.diffed;H.diffed=function(r){jo&&jo(r);var e=r.props,t=r.__e;t!=null&&r.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value),ms=null};var ka={ReactCurrentDispatcher:{current:{readContext:function(r){return ms.__n[r.__c].props.value},useCallback:Br,useContext:lr,useDebugValue:ts,useDeferredValue:_s,useEffect:re,useId:rs,useImperativeHandle:es,useInsertionEffect:vs,useLayoutEffect:It,useMemo:Ut,useReducer:Fr,useRef:ge,useState:R,useSyncExternalStore:fs,useTransition:gs}}},Fd="18.3.1";function Aa(r){return ye.bind(null,r)}function hr(r){return!!r&&r.$$typeof===$a}function Oa(r){return hr(r)&&r.type===ve}function Ra(r){return!!r&&!!r.displayName&&(typeof r.displayName=="string"||r.displayName instanceof String)&&r.displayName.startsWith("Memo(")}function Ca(r){return hr(r)?Zn.apply(null,arguments):r}function xa(r){return!!r.__k&&(at(null,r),!0)}function ja(r){return r&&(r.base||r.nodeType===1&&r)||null}var Ia=function(r,e){return r(e)},Ua=function(r,e){return r(e)},Na=ve,La=hr,Da={useState:R,useId:rs,useReducer:Fr,useEffect:re,useLayoutEffect:It,useInsertionEffect:vs,useTransition:gs,useDeferredValue:_s,useSyncExternalStore:fs,startTransition:ps,useRef:ge,useImperativeHandle:es,useMemo:Ut,useCallback:Br,useContext:lr,useDebugValue:ts,version:"18.3.1",Children:ma,render:Ta,hydrate:Pa,unmountComponentAtNode:xa,createPortal:Ea,createElement:ye,createContext:ar,createFactory:Aa,cloneElement:Ca,createRef:Jn,Fragment:ve,isValidElement:hr,isElement:La,isFragment:Oa,isMemo:Ra,findDOMNode:ja,Component:Pe,PureComponent:Nr,memo:ga,forwardRef:va,flushSync:Ua,unstable_batchedUpdates:Ia,StrictMode:Na,Suspense:Qt,SuspenseList:Tt,lazy:Sa,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ka};const Bd=Object.freeze(Object.defineProperty({__proto__:null,Children:ma,Component:Pe,Fragment:ve,PureComponent:Nr,StrictMode:Na,Suspense:Qt,SuspenseList:Tt,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ka,cloneElement:Ca,createContext:ar,createElement:ye,createFactory:Aa,createPortal:Ea,createRef:Jn,default:Da,findDOMNode:ja,flushSync:Ua,forwardRef:va,hydrate:Pa,isElement:La,isFragment:Oa,isMemo:Ra,isValidElement:hr,lazy:Sa,memo:ga,render:Ta,startTransition:ps,unmountComponentAtNode:xa,unstable_batchedUpdates:Ia,useCallback:Br,useContext:lr,useDebugValue:ts,useDeferredValue:_s,useEffect:re,useErrorBoundary:Ml,useId:rs,useImperativeHandle:es,useInsertionEffect:vs,useLayoutEffect:It,useMemo:Ut,useReducer:Fr,useRef:ge,useState:R,useSyncExternalStore:fs,useTransition:gs,version:Fd},Symbol.toStringTag,{value:"Module"}));var Ma={exports:{}},Fa={};const Ba=as(Bd);var Ha={exports:{}},qa={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct=Ba;function Hd(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var qd=typeof Object.is=="function"?Object.is:Hd,Wd=Ct.useState,Gd=Ct.useEffect,zd=Ct.useLayoutEffect,Vd=Ct.useDebugValue;function Kd(r,e){var t=e(),n=Wd({inst:{value:t,getSnapshot:e}}),s=n[0].inst,o=n[1];return zd(function(){s.value=t,s.getSnapshot=e,_n(s)&&o({inst:s})},[r,t,e]),Gd(function(){return _n(s)&&o({inst:s}),r(function(){_n(s)&&o({inst:s})})},[r]),Vd(t),t}function _n(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!qd(r,t)}catch{return!0}}function Jd(r,e){return e()}var Yd=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Jd:Kd;qa.useSyncExternalStore=Ct.useSyncExternalStore!==void 0?Ct.useSyncExternalStore:Yd;Ha.exports=qa;var Qd=Ha.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jr=Ba,Xd=Qd;function Zd(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var eh=typeof Object.is=="function"?Object.is:Zd,th=Xd.useSyncExternalStore,rh=Jr.useRef,nh=Jr.useEffect,sh=Jr.useMemo,oh=Jr.useDebugValue;Fa.useSyncExternalStoreWithSelector=function(r,e,t,n,s){var o=rh(null);if(o.current===null){var i={hasValue:!1,value:null};o.current=i}else i=o.current;o=sh(function(){function l(f){if(!c){if(c=!0,h=f,f=n(f),s!==void 0&&i.hasValue){var _=i.value;if(s(_,f))return d=_}return d=f}if(_=d,eh(h,f))return _;var g=n(f);return s!==void 0&&s(_,g)?(h=f,_):(h=f,d=g)}var c=!1,h,d,p=t===void 0?null:t;return[function(){return l(e())},p===null?void 0:function(){return l(p())}]},[e,t,n,s]);var a=th(r,o[0],o[1]);return nh(function(){i.hasValue=!0,i.value=a},[a]),oh(a),a};Ma.exports=Fa;var ih=Ma.exports;const ah=Hi(ih),Wa={},{useDebugValue:lh}=Da,{useSyncExternalStoreWithSelector:ch}=ah;let Io=!1;const uh=r=>r;function dh(r,e=uh,t){(Wa?"production":void 0)!=="production"&&t&&!Io&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Io=!0);const n=ch(r.subscribe,r.getState,r.getServerState||r.getInitialState,e,t);return lh(n),n}const Uo=r=>{(Wa?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof r=="function"?Pd(r):r,t=(n,s)=>dh(e,n,s);return Object.assign(t,e),t},hh=r=>r?Uo(r):Uo,fh={};function ph(r,e){let t;try{t=r()}catch{return}return{getItem:s=>{var o;const i=l=>l===null?null:JSON.parse(l,void 0),a=(o=t.getItem(s))!=null?o:null;return a instanceof Promise?a.then(i):i(a)},setItem:(s,o)=>t.setItem(s,JSON.stringify(o,void 0)),removeItem:s=>t.removeItem(s)}}const tr=r=>e=>{try{const t=r(e);return t instanceof Promise?t:{then(n){return tr(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return tr(n)(t)}}}},_h=(r,e)=>(t,n,s)=>{let o={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:v=>v,version:0,merge:(v,y)=>({...y,...v}),...e},i=!1;const a=new Set,l=new Set;let c;try{c=o.getStorage()}catch{}if(!c)return r((...v)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),t(...v)},n,s);const h=tr(o.serialize),d=()=>{const v=o.partialize({...n()});let y;const b=h({state:v,version:o.version}).then(w=>c.setItem(o.name,w)).catch(w=>{y=w});if(y)throw y;return b},p=s.setState;s.setState=(v,y)=>{p(v,y),d()};const f=r((...v)=>{t(...v),d()},n,s);let _;const g=()=>{var v;if(!c)return;i=!1,a.forEach(b=>b(n()));const y=((v=o.onRehydrateStorage)==null?void 0:v.call(o,n()))||void 0;return tr(c.getItem.bind(c))(o.name).then(b=>{if(b)return o.deserialize(b)}).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==o.version){if(o.migrate)return o.migrate(b.state,b.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return b.state}).then(b=>{var w;return _=o.merge(b,(w=n())!=null?w:f),t(_,!0),d()}).then(()=>{y==null||y(_,void 0),i=!0,l.forEach(b=>b(_))}).catch(b=>{y==null||y(void 0,b)})};return s.persist={setOptions:v=>{o={...o,...v},v.getStorage&&(c=v.getStorage())},clearStorage:()=>{c==null||c.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>g(),hasHydrated:()=>i,onHydrate:v=>(a.add(v),()=>{a.delete(v)}),onFinishHydration:v=>(l.add(v),()=>{l.delete(v)})},g(),_||f},gh=(r,e)=>(t,n,s)=>{let o={storage:ph(()=>localStorage),partialize:g=>g,version:0,merge:(g,v)=>({...v,...g}),...e},i=!1;const a=new Set,l=new Set;let c=o.storage;if(!c)return r((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),t(...g)},n,s);const h=()=>{const g=o.partialize({...n()});return c.setItem(o.name,{state:g,version:o.version})},d=s.setState;s.setState=(g,v)=>{d(g,v),h()};const p=r((...g)=>{t(...g),h()},n,s);s.getInitialState=()=>p;let f;const _=()=>{var g,v;if(!c)return;i=!1,a.forEach(b=>{var w;return b((w=n())!=null?w:p)});const y=((v=o.onRehydrateStorage)==null?void 0:v.call(o,(g=n())!=null?g:p))||void 0;return tr(c.getItem.bind(c))(o.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==o.version){if(o.migrate)return[!0,o.migrate(b.state,b.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var w;const[C,A]=b;if(f=o.merge(A,(w=n())!=null?w:p),t(f,!0),C)return h()}).then(()=>{y==null||y(f,void 0),f=n(),i=!0,l.forEach(b=>b(f))}).catch(b=>{y==null||y(void 0,b)})};return s.persist={setOptions:g=>{o={...o,...g},g.storage&&(c=g.storage)},clearStorage:()=>{c==null||c.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>_(),hasHydrated:()=>i,onHydrate:g=>(a.add(g),()=>{a.delete(g)}),onFinishHydration:g=>(l.add(g),()=>{l.delete(g)})},o.skipHydration||_(),f||p},vh=(r,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((fh?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),_h(r,e)):gh(r,e),mh=vh,tt=async(r,e=3)=>{let t=[];for(let n=1;n<=e;n++)try{const s=await fetch(`${r}?page=${n}`);if(s.ok){const o=await s.json();t=[...t,...o.results||[]]}}catch(s){console.error(`Error fetching page ${n} from ${r}:`,s)}return t},rr=hh(mh((r,e)=>({trending:[],popularMovies:[],popularTv:[],topRatedMovies:[],topRatedTv:[],upcomingMovies:[],nowPlayingMovies:[],airingTodayTv:[],favorites:[],favoritesFetched:!1,currentMediaItem:null,setCurrentMediaItem:t=>r({currentMediaItem:t}),fetchTrending:async()=>{if(!(e().trending.length>0))try{const t=await fetch("/api/tmdb/trending/all/week");if(t.ok){const n=await t.json();r({trending:n.results||[]})}}catch(t){console.error("Error fetching trending:",t)}},fetchPopularMovies:async()=>{if(e().popularMovies.length>0)return;const t=await tt("/api/tmdb/movie/popular");r({popularMovies:t})},fetchPopularTv:async()=>{if(e().popularTv.length>0)return;const t=await tt("/api/tmdb/tv/popular");r({popularTv:t})},fetchTopRatedMovies:async()=>{if(e().topRatedMovies.length>0)return;const t=await tt("/api/tmdb/movie/top_rated");r({topRatedMovies:t})},fetchTopRatedTv:async()=>{if(e().topRatedTv.length>0)return;const t=await tt("/api/tmdb/tv/top_rated");r({topRatedTv:t})},fetchUpcomingMovies:async()=>{if(e().upcomingMovies.length>0)return;const t=await tt("/api/tmdb/movie/upcoming");r({upcomingMovies:t})},fetchNowPlayingMovies:async()=>{if(e().nowPlayingMovies.length>0)return;const t=await tt("/api/tmdb/movie/now_playing");r({nowPlayingMovies:t})},fetchAiringTodayTv:async()=>{if(e().airingTodayTv.length>0)return;const t=await tt("/api/tmdb/tv/airing_today");r({airingTodayTv:t})},fetchFavorites:async()=>{const{data:{user:t}}=await ee.auth.getUser();if(!t){r({favorites:[],favoritesFetched:!0});return}const{data:n,error:s}=await ee.from("favorites").select("media_id, media_type, season_number, episode_number, episode_name").eq("user_id",t.id);if(s){console.error("Error fetching favorites:",s),r({favoritesFetched:!0});return}const o=await Promise.all(n.map(async i=>{const a=await fetch(`/api/tmdb/${i.media_type}/${i.media_id}`);if(a.ok){const l=await a.json();if(i.media_type==="tv"&&i.season_number&&i.episode_number){try{const c=await fetch(`/api/tmdb/tv/${i.media_id}/season/${i.season_number}/episode/${i.episode_number}`);if(c.ok){const h=await c.json();return{...l,type:i.media_type,season_number:i.season_number,episode_number:i.episode_number,episode_name:h.name||i.episode_name,still_path:h.still_path,vote_average:h.vote_average||l.vote_average,overview:h.overview||l.overview}}}catch(c){console.error("Error fetching episode details:",c)}return{...l,type:i.media_type,season_number:i.season_number,episode_number:i.episode_number,episode_name:i.episode_name}}return{...l,type:i.media_type}}return null}));r({favorites:o.filter(Boolean),favoritesFetched:!0})},addFavorite:async t=>{const{data:{user:n}}=await ee.auth.getUser();if(!n)return;r(i=>({favorites:[t,...i.favorites]}));const s={user_id:n.id,media_id:t.id,media_type:t.type};t.type==="tv"&&t.season_number&&t.episode_number&&(s.season_number=t.season_number,s.episode_number=t.episode_number,s.episode_name=t.episode_name);const{error:o}=await ee.from("favorites").insert(s);o&&(console.error("Error adding favorite:",o),r(i=>({favorites:i.favorites.filter(a=>a.id!==t.id||a.season_number!==t.season_number||a.episode_number!==t.episode_number)})))},removeFavorite:async(t,n=null,s=null)=>{const{data:{user:o}}=await ee.auth.getUser();if(!o)return;const i=e().favorites;r(c=>({favorites:c.favorites.filter(h=>!(h.id===t&&h.season_number===n&&h.episode_number===s))}));const a=ee.from("favorites").delete().match({user_id:o.id,media_id:t});n!==null&&s!==null?a.match({season_number:n,episode_number:s}):a.is("season_number",null).is("episode_number",null);const{error:l}=await a;l&&(console.error("Error removing favorite:",l),r({favorites:i}))},isFavorited:(t,n=null,s=null)=>{const{favorites:o,favoritesFetched:i}=e();return i?o.some(a=>a.id===t&&a.season_number===n&&a.episode_number===s):!1}}),{name:"freestream-storage",storage:localStorage,partialize:r=>({favorites:r.favorites,trending:r.trending,popularMovies:r.popularMovies,popularTv:r.popularTv,topRatedMovies:r.topRatedMovies,topRatedTv:r.topRatedTv,upcomingMovies:r.upcomingMovies,nowPlayingMovies:r.nowPlayingMovies,airingTodayTv:r.airingTodayTv})})),Bn="https://image.tmdb.org/t/p/w500",yh=()=>window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.port==="5173"?"http://localhost:3001/api":"/api",Te=yh();function Hn(r){return r?`/image-proxy?url=${encodeURIComponent(r)}`:""}console.log(` API Base URL: ${Te}`);console.log(" Environment: production");const xt=({item:r,type:e,progress:t,duration:n,showDeleteButton:s,onDelete:o})=>{const{id:i,title:a,name:l,poster_path:c,still_path:h,vote_average:d,episode_name:p,season_number:f,episode_number:_,first_air_date:g,release_date:v,number_of_seasons:y}=r,b=h||c,w=l||a,C=t&&n>0?t/n*100:0,A=v||g?new Date(v||g).getFullYear():null,{addFavorite:N,removeFavorite:Z,isFavorited:S}=rr(),j=S(r.id,r.season_number,r.episode_number),q=te=>{te.preventDefault(),te.stopPropagation(),j?Z(r.id,r.season_number,r.episode_number):N({...r,type:e})};let I=`/watch/${e}/${r.id}`;e==="tv"&&r.season_number&&r.episode_number&&(I+=`/season/${r.season_number}/episode/${r.episode_number}`);const ie=e==="tv"&&f&&_?`S${f} E${_}${p?`: ${p}`:""}`:e==="tv"&&y?`${A||"Unknown"}  ${y} Season${y!==1?"s":""}`:e==="movie"&&A?A.toString():null;return u("div",{className:"movie-card-container",children:u(Je,{href:I,className:"movie-card",children:u("div",{className:"poster-wrapper",children:[u("img",{src:Hn(b?`${Bn}${b}`:"https://via.placeholder.com/500x750/1a1a1a/ffffff?text=No+Image"),alt:w,loading:"lazy"}),u("div",{className:"scrim"}),C>.01&&u("div",{className:"progress-bar-container",children:u("div",{className:"progress-bar",style:{width:`${Math.min(C,100)}%`}})}),u("div",{className:"card-info",children:[u("div",{className:"title-row",children:[u("h3",{className:"card-title",children:w}),u("button",{className:`favorite-btn ${j?"favorited":""}`,onClick:q,children:j?"":""})]}),ie&&u("p",{className:"card-subtitle",children:ie}),u("span",{className:"rating",children:[" ",d?d.toFixed(1):"N/A"]})]}),s&&u("button",{className:"delete-btn",onClick:te=>{te.preventDefault(),te.stopPropagation(),o&&o(r)},children:""})]})})})},De=async()=>{var t;let e=0;for(;e<2;)try{const n=new Promise((a,l)=>setTimeout(()=>l(new Error("Auth timeout")),5e3)),s=ee.auth.getSession(),{data:{session:o},error:i}=await Promise.race([s,n]);if(i){if(console.error("Error getting current session:",i),i.message&&i.message.includes("NetworkError")&&e<1){e++,console.log(`Retrying auth session (attempt ${e+1}/2)`),await new Promise(a=>setTimeout(a,500*e));continue}return null}return((t=o==null?void 0:o.user)==null?void 0:t.id)||null}catch(n){if(console.error("Error in getCurrentUserId:",n),n.message&&(n.message.includes("NetworkError")||n.message.includes("timeout"))&&e<1){e++,console.log(`Retrying auth due to network error (attempt ${e+1}/2)`),await new Promise(s=>setTimeout(s,500*e));continue}return null}return console.error("Failed to get user session after all retry attempts"),null},bh=async()=>{let e=0;for(;e<3;)try{const t=await De();if(!t)return console.log("No authenticated user, returning empty watch history"),[];const n=new Promise((a,l)=>setTimeout(()=>l(new Error("Request timeout")),1e4)),s=ee.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),{data:o,error:i}=await Promise.race([s,n]);if(i){if(console.error("Error fetching watch history:",i),i.message&&i.message.includes("NetworkError")&&e<2){e++,console.log(`Retrying watch history fetch (attempt ${e+1}/3)`),await new Promise(a=>setTimeout(a,1e3*e));continue}return[]}return o||[]}catch(t){if(console.error("Error in getWatchHistory:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying watch history fetch due to network error (attempt ${e+1}/3)`),await new Promise(n=>setTimeout(n,1e3*e));continue}return[]}return console.error("Failed to fetch watch history after all retry attempts"),[]},gn=async(r,e,t,n)=>{try{const s=await De();if(!s)return console.log("No authenticated user, returning null progress"),null;let o=ee.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",s).eq("media_id",r).eq("media_type",e);e!=="movie"&&(o=o.eq("season_number",t).eq("episode_number",n));const{data:i,error:a}=await o;return a?(console.error("Error fetching watch progress:",a),null):i&&i.length>0?i[0]:null}catch(s){return console.error("Error in getWatchProgressForMedia:",s),null}},wh=async()=>{try{const r=await De();if(!r)return console.log("No authenticated user, returning empty continue watching list"),[];console.log(" Fetching continue watching from watch_history...");const{data:e,error:t}=await ee.from("watch_history").select("media_id, media_type, season_number, episode_number, watched_at").eq("user_id",r).order("watched_at",{ascending:!1});if(t)return console.error("Error fetching watch history for continue watching:",t),[];if(!e||e.length===0)return console.log(" No watch history found"),[];console.log(` Found ${e.length} watch history entries`);const n=new Map;e.forEach(c=>{const h=c.media_id;n.has(h)||n.set(h,[]),n.get(h).push(c)});const s=[];for(const[c,h]of n){const p=h.sort((f,_)=>f.media_type==="movie"?new Date(_.watched_at)-new Date(f.watched_at):f.season_number!==_.season_number?(_.season_number||0)-(f.season_number||0):(_.episode_number||0)-(f.episode_number||0))[0];console.log(` Most advanced for media ${c}: S${p.season_number}E${p.episode_number} (${p.media_type})`),s.push(p)}const i=(await Promise.all(s.map(async c=>{try{let h=ee.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",r).eq("media_id",c.media_id).eq("media_type",c.media_type);c.media_type!=="movie"&&(h=h.eq("season_number",c.season_number).eq("episode_number",c.episode_number));const{data:d,error:p}=await h;if(p)return console.error(`Error fetching progress for ${c.media_id}:`,p),null;const f=d&&d.length>0?d[0]:null,_=f&&f.progress_seconds>30,g=new Date(c.watched_at)>new Date(Date.now()-7*24*60*60*1e3);if(_||g){if(f&&f.duration_seconds>0&&f.progress_seconds/f.duration_seconds>=.9){if(c.media_type!=="movie"){const y=await Ga(c.media_id,c.season_number,c.episode_number,c.media_type);if(y)return console.log(` Episode completed, suggesting next: S${y.season}E${y.episode}`),{...c,season_number:y.season,episode_number:y.episode,progress_seconds:0,duration_seconds:null,updated_at:f.updated_at}}return null}return{...c,progress_seconds:(f==null?void 0:f.progress_seconds)||0,duration_seconds:(f==null?void 0:f.duration_seconds)||null,updated_at:(f==null?void 0:f.updated_at)||c.watched_at}}return null}catch(h){return console.error(`Error processing continue watching entry for ${c.media_id}:`,h),null}}))).filter(Boolean).sort((c,h)=>new Date(h.updated_at)-new Date(c.updated_at));console.log(` Found ${i.length} valid continue watching entries`);const l=(await Promise.all(i.map(async c=>{try{const h=await fetch(`${Te}/tmdb/${c.media_type}/${c.media_id}`);return h.ok?{...await h.json(),type:c.media_type,progress_seconds:c.progress_seconds,duration_seconds:c.duration_seconds,season_number:c.season_number,episode_number:c.episode_number,updated_at:c.updated_at,media_id:c.media_id}:null}catch(h){return console.error("Error fetching TMDB details for continue watching item:",h),null}}))).filter(Boolean);return console.log(` Returning ${l.length} continue watching items`),l}catch(r){return console.error("Error in getContinueWatching:",r),[]}},No=async(r,e,t,n=!1)=>{const s=await De();if(!s)return console.error(" Cannot save watch progress: No authenticated user"),!1;if(!r||typeof e>"u"||e<0)return console.error(" Invalid progress data:",{item:r,progress:e,durationInMinutes:t}),!1;const o={p_media_id:r.id,p_media_type:r.type,p_season_number:r.season||null,p_episode_number:r.episode||null,p_progress_seconds:Math.round(e),p_duration_seconds:t?Math.round(t*60):null,p_force_history_entry:n};console.log(" Saving watch progress (v2)...",o);const{error:i}=await ee.rpc("save_watch_progress",o);if(!i)return console.log(" Watch progress saved successfully via RPC (v2)"),!0;console.warn(` RPC (v2) failed, trying legacy (v1). Error: ${i.message}`);const{p_force_history_entry:a,...l}=o,{error:c}=await ee.rpc("save_watch_progress",l);if(!c)return console.log(" Watch progress saved successfully via RPC (v1)"),!0;console.warn(` RPC (v1) also failed, attempting direct DB write. Error: ${c.message}`);try{if(await Sh(s,r,e,t,n))return!0}catch(h){console.error(" Direct DB write fallback threw an exception:",h)}return console.error(" All methods to save progress failed."),!1},Sh=async(r,e,t,n,s)=>{try{console.log(" Using direct database fallback for watch progress");const{error:o}=await ee.from("watch_progress").upsert({user_id:r,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,progress_seconds:Math.round(t),duration_seconds:n?Math.round(n*60):null,updated_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});if(o)return console.error(" Direct progress insert error:",o),!1;if(s||t>60){const{error:i}=await ee.from("watch_history").upsert({user_id:r,media_id:e.id,media_type:e.type,season_number:e.season||null,episode_number:e.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});i&&console.error(" Direct history insert error:",i)}return console.log(" Watch progress saved via direct database fallback"),!0}catch(o){return console.error(" Direct database fallback failed:",o),!1}},Lo=async r=>{try{const e=await De();if(!e){console.log("Cannot add watch history entry: No authenticated user");return}if(!r)return;const{error:t}=await ee.from("watch_history").upsert({user_id:e,media_id:r.id,media_type:r.type,season_number:r.season||null,episode_number:r.episode||null,watched_at:new Date().toISOString()},{onConflict:"user_id,media_id,media_type,season_number,episode_number"});t&&console.error("Error adding watch history entry:",t)}catch(e){console.error("Unexpected error adding watch history entry:",e)}},Eh=async r=>{try{if(!r)return;if(!await De()){console.log("Cannot delete watch item: No authenticated user");return}const{error:t}=await ee.rpc("delete_watch_item",{p_media_id:r.media_id,p_media_type:r.media_type,p_season_number:r.season_number,p_episode_number:r.episode_number});t&&console.error("Error deleting watch item:",t)}catch(e){console.error("Error in deleteWatchItem:",e)}},$h=async r=>{try{const e=await De();if(!e)return[];const{data:t,error:n}=await ee.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",r);return n?(console.error("Error fetching series history:",n),[]):t||[]}catch(e){return console.error("Error in getSeriesHistory:",e),[]}},Ga=async(r,e,t,n="tv")=>{try{const s=n==="anime"?"tv":n,o=await fetch(`${Te}/tmdb/${s}/${r}`);if(!o.ok)return console.error(`Failed to fetch series details: ${o.status}`),null;const i=await o.json();if(!i.seasons||i.seasons.length===0)return console.error("No seasons found in series details"),null;const a=await fetch(`${Te}/tmdb/${s}/${r}/season/${e}`);if(!a.ok)return console.error(`Failed to fetch season ${e} details: ${a.status}`),null;const l=await a.json();if(!l.episodes||l.episodes.length===0)return console.error(`No episodes found in season ${e}`),null;const c=l.episodes.length;if(console.log(`Current season ${e} has ${c} episodes, current episode: ${t}`),t<c)return console.log(`Next episode: S${e}E${t+1}`),{season:e,episode:t+1};const d=i.seasons.filter(p=>p.season_number>0).find(p=>p.season_number===e+1);return d&&d.episode_count>0?(console.log(`Next season found: S${d.season_number}E1`),{season:d.season_number,episode:1}):(console.log("No next episode available - series may be completed"),null)}catch(s){return console.error("Error getting next episode:",s),null}},Th=async r=>{try{const e=await De();if(!e)return console.log("No authenticated user, returning null for last watched episode with progress"),null;console.log(` Looking for last watched episode for series ${r} from watch_history`);const{data:t,error:n}=await ee.from("watch_history").select("season_number, episode_number, watched_at, media_type").eq("user_id",e).eq("media_id",r).order("watched_at",{ascending:!1});if(n)return console.error("Error fetching watch history:",n),null;if(!t||t.length===0)return console.log(" No episodes found in watch history"),null;console.log(` Found ${t.length} episodes in watch history for series ${r}`);const o=t.sort((c,h)=>c.season_number!==h.season_number?h.season_number-c.season_number:h.episode_number-c.episode_number)[0];console.log(` Most advanced episode from history: S${o.season_number}E${o.episode_number} (watched: ${o.watched_at})`);const{data:i,error:a}=await ee.from("watch_progress").select("progress_seconds, duration_seconds, updated_at").eq("user_id",e).eq("media_id",r).eq("season_number",o.season_number).eq("episode_number",o.episode_number);if(a)return console.error("Error fetching progress data:",a),{season:o.season_number,episode:o.episode_number};const l=i&&i.length>0?i[0]:null;if(l){console.log(` Progress data found: ${l.progress_seconds}/${l.duration_seconds}s`);let c=!1;if(l.duration_seconds>0){const h=l.progress_seconds/l.duration_seconds;c=h>=.9,console.log(` Completion: ${(h*100).toFixed(1)}% - ${c?"COMPLETED":"INCOMPLETE"}`)}if(c){console.log(` Most advanced episode S${o.season_number}E${o.episode_number} was completed, finding next episode`);const h=await Ga(r,o.season_number,o.episode_number,o.media_type);return h?(console.log(` Next episode found: S${h.season}E${h.episode}`),h):(console.log(' No next episode available, series may be completed. No "continue watching" will be triggered.'),null)}else return console.log(` Resuming incomplete episode S${o.season_number}E${o.episode_number}`),{season:o.season_number,episode:o.episode_number}}else return console.log(` No progress data, but episode is in watch history: S${o.season_number}E${o.episode_number}`),{season:o.season_number,episode:o.episode_number}}catch(e){return console.error("Error in getLastWatchedEpisodeWithProgress:",e),null}},za=async r=>{try{const e=await De();if(!e||!r||r.length===0)return{};const t={};return await Promise.all(r.map(async n=>{try{let s=ee.from("watch_progress").select("progress_seconds, duration_seconds").eq("user_id",e).eq("media_id",n.media_id).eq("media_type",n.media_type);n.media_type==="tv"&&(n.season_number!=null&&(s=s.eq("season_number",n.season_number)),n.episode_number!=null&&(s=s.eq("episode_number",n.episode_number)));const{data:o,error:i}=await s;if(i)console.error(`Error fetching progress for ${n.media_type} ${n.media_id}:`,i);else if(o&&o.length>0){const a=o[0],l=`${n.media_id}-${n.media_type}-${n.season_number||0}-${n.episode_number||0}`;a.progress_seconds>=0&&a.duration_seconds>0&&(t[l]={progress_seconds:a.progress_seconds,duration_seconds:a.duration_seconds})}}catch(s){console.error(`Error fetching progress for item ${n.media_id}:`,s)}})),t}catch(e){return console.error("Error in getProgressForHistoryItems:",e),{}}},Ph=async()=>{let e=0;for(;e<3;)try{const t=await De();if(!t)return console.log("No authenticated user, returning empty watch history with progress"),[];console.log(" Fetching combined watch history and progress data...");const[n,s]=await Promise.all([ee.from("watch_history").select("*").eq("user_id",t).order("watched_at",{ascending:!1}),ee.from("watch_progress").select("media_id, media_type, season_number, episode_number, progress_seconds, duration_seconds").eq("user_id",t)]);if(n.error)throw n.error;s.error&&console.warn("Error fetching progress data, continuing without progress:",s.error);const o=n.data||[],i=s.data||[],a={};i.forEach(c=>{const h=`${c.media_id}-${c.media_type}-${c.season_number||0}-${c.episode_number||0}`;a[h]=c});const l=o.map(c=>{const h=`${c.media_id}-${c.media_type}-${c.season_number||0}-${c.episode_number||0}`,d=a[h];return{...c,progress_seconds:(d==null?void 0:d.progress_seconds)||null,duration_seconds:(d==null?void 0:d.duration_seconds)||null}});return console.log(" Successfully fetched combined data:",{totalItems:l.length,itemsWithProgress:l.filter(c=>c.progress_seconds>0).length}),l}catch(t){if(console.error("Error in getWatchHistoryWithProgress:",t),t.message&&(t.message.includes("NetworkError")||t.message.includes("timeout"))&&e<2){e++,console.log(`Retrying combined fetch due to network error (attempt ${e+1}/3)`),await new Promise(n=>setTimeout(n,1e3*e));continue}try{console.log(" All retries failed, trying fallback approach...");const n=await bh(),s=await za(n);return n.map(o=>{const i=`${o.media_id}-${o.media_type}-${o.season_number||0}-${o.episode_number||0}`,a=s[i];return{...o,progress_seconds:(a==null?void 0:a.progress_seconds)||null,duration_seconds:(a==null?void 0:a.duration_seconds)||null}})}catch(n){return console.error("Fallback approach also failed:",n),[]}}return console.error("Failed to fetch combined watch history and progress after all retry attempts"),[]},kh=()=>u("div",{class:"features-showcase",children:[u("div",{class:"features-hero",children:u("div",{class:"features-hero-content",children:[u("h2",{class:"features-title",children:u("span",{class:"gradient-text",children:"Sign in for the full experience"})}),u("p",{class:"features-subtitle",children:"Get personalized recommendations, track your progress, and never lose your place"})]})}),u("div",{class:"features-grid",children:[{icon:"",title:"Continue Watching",description:"Pick up exactly where you left off across all your devices. Never lose your place again.",highlight:!0},{icon:"",title:"Favorites Collection",description:"Save your favorite movies and TV shows in one place for quick access anytime.",highlight:!1},{icon:"",title:"Watch History",description:"Keep track of everything you've watched and easily find content you enjoyed.",highlight:!1},{icon:"",title:"Personal Progress",description:"Sync your watch progress across devices and resume on any screen seamlessly.",highlight:!1},{icon:"",title:"Smart Recommendations",description:"Get personalized suggestions based on your viewing history and preferences.",highlight:!1},{icon:"",title:"Enhanced Experience",description:"Unlock the full potential of FreeStream with user-specific features and settings.",highlight:!1}].map((e,t)=>u("div",{class:`feature-card ${e.highlight?"featured":""}`,children:[u("div",{class:"feature-icon",children:e.icon}),u("h3",{class:"feature-title",children:e.title}),u("p",{class:"feature-description",children:e.description})]},t))}),u("div",{class:"features-footer",children:[u("div",{class:"features-stats",children:[u("div",{class:"stat",children:[u("span",{class:"stat-number",children:"10K+"}),u("span",{class:"stat-label",children:"Movies & Shows"})]}),u("div",{class:"stat",children:[u("span",{class:"stat-number",children:"4K"}),u("span",{class:"stat-label",children:"Ultra HD Quality"})]}),u("div",{class:"stat",children:[u("span",{class:"stat-number",children:""}),u("span",{class:"stat-label",children:"Unlimited Access"})]})]}),u("p",{class:"features-note",children:[u(Ne,{href:"/login",class:"subtle-link",children:"Sign in"})," or ",u(Ne,{href:"/signup",class:"subtle-link",children:"create an account"})," to unlock these features"]})]})]}),Va=({size:r="medium",text:e="Loading..."})=>{const t={small:"spinner-small",medium:"spinner-medium",large:"spinner-large"}[r];return u("div",{class:"loading-container",children:[u("div",{class:`loading-spinner ${t}`,children:[u("div",{class:"spinner-ring"}),u("div",{class:"spinner-ring"}),u("div",{class:"spinner-ring"}),u("div",{class:"spinner-ring"})]}),e&&u("p",{class:"loading-text",children:e})]})},Ah=()=>{const{user:r}=ut();if(!r)return null;const e=()=>{const n=new Date().getHours();return n<12?"Good morning":n<17?"Good afternoon":"Good evening"},t=()=>{var n;return(n=r.user_metadata)!=null&&n.full_name?r.user_metadata.full_name.split(" ")[0]:r.email.split("@")[0]};return u("div",{class:"welcome-message",children:[u("div",{class:"welcome-content",children:[u("h2",{class:"welcome-title",children:[e(),", ",u("span",{class:"user-name",children:t()}),"!"]}),u("p",{class:"welcome-subtitle",children:"What would you like to watch today?"})]}),u("div",{class:"welcome-stats",children:[u("div",{class:"stat-item",children:[u("span",{class:"stat-icon",children:""}),u("span",{class:"stat-text",children:"Unlimited Movies"})]}),u("div",{class:"stat-item",children:[u("span",{class:"stat-icon",children:""}),u("span",{class:"stat-text",children:"TV Shows"})]}),u("div",{class:"stat-item",children:[u("span",{class:"stat-icon",children:""}),u("span",{class:"stat-text",children:"HD Streaming"})]})]})]})},vn=r=>{const{trending:e,popularMovies:t,popularTv:n,topRatedMovies:s,topRatedTv:o,upcomingMovies:i,nowPlayingMovies:a,airingTodayTv:l,fetchTrending:c,fetchPopularMovies:h,fetchPopularTv:d,fetchTopRatedMovies:p,fetchTopRatedTv:f,fetchUpcomingMovies:_,fetchNowPlayingMovies:g,fetchAiringTodayTv:v}=rr(),{user:y}=ut(),[b,w]=R({}),[C,A]=R([]),[N,Z]=R(!0),[S,j]=R("all");re(()=>{r.path==="/movies"?j("movie"):r.path==="/tv"?j("tv"):j("all")},[r.path]),re(()=>{c(),h(),d(),p(),f(),_(),g(),v()},[c,h,d,p,f,_,g,v]),re(()=>{(async()=>{if(Z(!0),!y){A([]),Z(!1);return}const K=await wh();if(!K||K.length===0){A([]),Z(!1);return}const ie=K.reduce((te,de)=>(te.some(Ue=>Ue.media_id===de.media_id)||te.push(de),te),[]);A(ie),Z(!1)})()},[y]);const q=(I,K,ie)=>!K||K.length===0?null:u("section",{class:"home-section",children:[u("h2",{children:I}),u("div",{class:"scrolling-row",children:K.map(te=>u(xt,{item:te,type:ie||te.media_type},te.id))})]});return u("div",{class:"container home-page",children:[u("h1",{class:"main-title",children:[S==="movie"&&"Movies",S==="tv"&&"TV Shows",S==="all"&&"Discover"]}),!y&&S==="all"&&u(ve,{children:[u("div",{class:"guest-info-banner",style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"16px",marginBottom:"24px",textAlign:"center"},children:[u("h3",{style:{margin:"0 0 8px 0",color:"var(--text-primary)"},children:" Start Streaming Instantly"}),u("p",{style:{margin:"0",color:"var(--text-secondary)"},children:["No account required! Click any movie or TV show to start watching immediately.",u("a",{href:"/login",style:{color:"var(--accent-color)",textDecoration:"none",marginLeft:"4px"},children:"Sign up"})," to save favorites, track progress, and continue watching across devices."]})]}),u(kh,{})]}),y&&S==="all"&&u(Ah,{}),N?u(Va,{text:"Loading your continue watching..."}):C.length>0&&u("section",{class:"home-section",children:[u("h2",{children:"Continue Watching"}),u("div",{class:"scrolling-row scrolling-row--compact",children:C.map(I=>u(xt,{item:I,type:I.type,progress:I.progress_seconds,duration:I.duration_seconds},`${I.type}-${I.id}`))})]}),S==="all"&&q("Trending This Week",e,"movie"),S!=="tv"&&q("Popular Movies",t,"movie"),S!=="tv"&&q("Now Playing Movies",a,"movie"),S!=="movie"&&q("Popular TV Shows",n,"tv"),(S==="all"||S==="movie")&&q("Top Rated Movies",s,"movie"),(S==="all"||S==="movie")&&q("Upcoming Movies",i,"movie"),(S==="all"||S==="tv")&&q("Top Rated TV Shows",o,"tv"),(S==="all"||S==="tv")&&q("Airing Today",l,"tv")]})};var qn={exports:{}};const Ka=as(Ll);var Do=Ka;function Oh(r,e){var t={};for(var n in r)e.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);return t}function Rh(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Ch(r,e){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:r}function xh(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(r,e):r.__proto__=e)}var jh=function(e,t,n){if(typeof e!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof t!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof n<"u"&&typeof n!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function s(i){return i.displayName||i.name||"Component"}return function(a){if(typeof a!="function")throw new Error("Expected WrappedComponent to be a React component.");var l=[],c=void 0;function h(){c=e(l.map(function(p){return p.props})),d.canUseDOM?t(c):n&&(c=n(c))}var d=function(p){xh(f,p);function f(){return Rh(this,f),Ch(this,p.apply(this,arguments))}return f.peek=function(){return c},f.rewind=function(){if(f.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var g=c;return c=void 0,l=[],g},f.prototype.shouldComponentUpdate=function(g){var v=g.children,y=Oh(g,["children"]);return v&&v.length&&(y.children=v),o(y,this.props)},f.prototype.componentWillMount=function(){l.push(this),h()},f.prototype.componentDidUpdate=function(){h()},f.prototype.componentWillUnmount=function(){var g=l.indexOf(this);l.splice(g,1),h()},f.prototype.render=function(){return(0,Do.h)(a,this.props)},f}(Do.Component);return d.displayName="SideEffect("+s(a)+")",d.canUseDOM=!!(typeof window<"u"&&window.document&&window.document.createElement),d};function o(i,a){for(var l in i)if(!(l in a))return!0;for(var c in a)if(i[c]!==a[c])return!0;return!1}},Mo=Object.prototype.toString,Ja=function(e){var t=Mo.call(e),n=t==="[object Arguments]";return n||(n=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Mo.call(e.callee)==="[object Function]"),n},mn,Fo;function Ih(){if(Fo)return mn;Fo=1;var r;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=Ja,s=Object.prototype.propertyIsEnumerable,o=!s.call({toString:null},"toString"),i=s.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(p){var f=p.constructor;return f&&f.prototype===p},c={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},h=function(){if(typeof window>"u")return!1;for(var p in window)try{if(!c["$"+p]&&e.call(window,p)&&window[p]!==null&&typeof window[p]=="object")try{l(window[p])}catch{return!0}}catch{return!0}return!1}(),d=function(p){if(typeof window>"u"||!h)return l(p);try{return l(p)}catch{return!1}};r=function(f){var _=f!==null&&typeof f=="object",g=t.call(f)==="[object Function]",v=n(f),y=_&&t.call(f)==="[object String]",b=[];if(!_&&!g&&!v)throw new TypeError("Object.keys called on a non-object");var w=i&&g;if(y&&f.length>0&&!e.call(f,0))for(var C=0;C<f.length;++C)b.push(String(C));if(v&&f.length>0)for(var A=0;A<f.length;++A)b.push(String(A));else for(var N in f)!(w&&N==="prototype")&&e.call(f,N)&&b.push(String(N));if(o)for(var Z=d(f),S=0;S<a.length;++S)!(Z&&a[S]==="constructor")&&e.call(f,a[S])&&b.push(a[S]);return b}}return mn=r,mn}var Uh=Array.prototype.slice,Nh=Ja,Bo=Object.keys,Ar=Bo?function(e){return Bo(e)}:Ih(),Ho=Object.keys;Ar.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(n){return Nh(n)?Ho(Uh.call(n)):Ho(n)})}else Object.keys=Ar;return Object.keys||Ar};var Ya=Ar,Qa=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var s=42;e[t]=s;for(var o in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==s||a.enumerable!==!0)return!1}return!0},Lh=Qa,ys=function(){return Lh()&&!!Symbol.toStringTag},Xa=Object,Za=Error,Dh=EvalError,Mh=RangeError,Fh=ReferenceError,el=SyntaxError,Dt=TypeError,Bh=URIError,Hh=Math.abs,qh=Math.floor,Wh=Math.max,Gh=Math.min,zh=Math.pow,Vh=Math.round,Kh=Number.isNaN||function(e){return e!==e},Jh=Kh,Yh=function(e){return Jh(e)||e===0?e:e<0?-1:1},Qh=Object.getOwnPropertyDescriptor,Or=Qh;if(Or)try{Or([],"length")}catch{Or=null}var Mt=Or,Rr=Object.defineProperty||!1;if(Rr)try{Rr({},"a",{value:1})}catch{Rr=!1}var Yr=Rr,yn,qo;function Xh(){if(qo)return yn;qo=1;var r=typeof Symbol<"u"&&Symbol,e=Qa;return yn=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},yn}var tl=typeof Reflect<"u"&&Reflect.getPrototypeOf||null,Zh=Xa,rl=Zh.getPrototypeOf||null,ef="Function.prototype.bind called on incompatible ",tf=Object.prototype.toString,rf=Math.max,nf="[object Function]",Wo=function(e,t){for(var n=[],s=0;s<e.length;s+=1)n[s]=e[s];for(var o=0;o<t.length;o+=1)n[o+e.length]=t[o];return n},sf=function(e,t){for(var n=[],s=t,o=0;s<e.length;s+=1,o+=1)n[o]=e[s];return n},of=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t},af=function(e){var t=this;if(typeof t!="function"||tf.apply(t)!==nf)throw new TypeError(ef+t);for(var n=sf(arguments,1),s,o=function(){if(this instanceof s){var h=t.apply(this,Wo(n,arguments));return Object(h)===h?h:this}return t.apply(e,Wo(n,arguments))},i=rf(0,t.length-n.length),a=[],l=0;l<i;l++)a[l]="$"+l;if(s=Function("binder","return function ("+of(a,",")+"){ return binder.apply(this,arguments); }")(o),t.prototype){var c=function(){};c.prototype=t.prototype,s.prototype=new c,c.prototype=null}return s},lf=af,fr=Function.prototype.bind||lf,bs=Function.prototype.call,ws=Function.prototype.apply,cf=typeof Reflect<"u"&&Reflect&&Reflect.apply,uf=fr,df=ws,hf=bs,ff=cf,nl=ff||uf.call(hf,df),pf=fr,_f=Dt,gf=bs,vf=nl,Ss=function(e){if(e.length<1||typeof e[0]!="function")throw new _f("a function is required");return vf(pf,gf,e)},mf=Ss,Go=Mt,sl;try{sl=[].__proto__===Array.prototype}catch(r){if(!r||typeof r!="object"||!("code"in r)||r.code!=="ERR_PROTO_ACCESS")throw r}var bn=!!sl&&Go&&Go(Object.prototype,"__proto__"),ol=Object,zo=ol.getPrototypeOf,yf=bn&&typeof bn.get=="function"?mf([bn.get]):typeof zo=="function"?function(e){return zo(e==null?e:ol(e))}:!1,Vo=tl,Ko=rl,Jo=yf,il=Vo?function(e){return Vo(e)}:Ko?function(e){if(!e||typeof e!="object"&&typeof e!="function")throw new TypeError("getProto: not an object");return Ko(e)}:Jo?function(e){return Jo(e)}:null,bf=Function.prototype.call,wf=Object.prototype.hasOwnProperty,Sf=fr,al=Sf.call(bf,wf),G,Ef=Xa,$f=Za,Tf=Dh,Pf=Mh,kf=Fh,jt=el,Pt=Dt,Af=Bh,Of=Hh,Rf=qh,Cf=Wh,xf=Gh,jf=zh,If=Vh,Uf=Yh,ll=Function,wn=function(r){try{return ll('"use strict"; return ('+r+").constructor;")()}catch{}},nr=Mt,Nf=Yr,Sn=function(){throw new Pt},Lf=nr?function(){try{return arguments.callee,Sn}catch{try{return nr(arguments,"callee").get}catch{return Sn}}}():Sn,bt=Xh()(),pe=il,Df=rl,Mf=tl,cl=ws,pr=bs,Et={},Ff=typeof Uint8Array>"u"||!pe?G:pe(Uint8Array),it={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?G:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?G:ArrayBuffer,"%ArrayIteratorPrototype%":bt&&pe?pe([][Symbol.iterator]()):G,"%AsyncFromSyncIteratorPrototype%":G,"%AsyncFunction%":Et,"%AsyncGenerator%":Et,"%AsyncGeneratorFunction%":Et,"%AsyncIteratorPrototype%":Et,"%Atomics%":typeof Atomics>"u"?G:Atomics,"%BigInt%":typeof BigInt>"u"?G:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?G:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?G:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?G:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":$f,"%eval%":eval,"%EvalError%":Tf,"%Float16Array%":typeof Float16Array>"u"?G:Float16Array,"%Float32Array%":typeof Float32Array>"u"?G:Float32Array,"%Float64Array%":typeof Float64Array>"u"?G:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?G:FinalizationRegistry,"%Function%":ll,"%GeneratorFunction%":Et,"%Int8Array%":typeof Int8Array>"u"?G:Int8Array,"%Int16Array%":typeof Int16Array>"u"?G:Int16Array,"%Int32Array%":typeof Int32Array>"u"?G:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":bt&&pe?pe(pe([][Symbol.iterator]())):G,"%JSON%":typeof JSON=="object"?JSON:G,"%Map%":typeof Map>"u"?G:Map,"%MapIteratorPrototype%":typeof Map>"u"||!bt||!pe?G:pe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Ef,"%Object.getOwnPropertyDescriptor%":nr,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?G:Promise,"%Proxy%":typeof Proxy>"u"?G:Proxy,"%RangeError%":Pf,"%ReferenceError%":kf,"%Reflect%":typeof Reflect>"u"?G:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?G:Set,"%SetIteratorPrototype%":typeof Set>"u"||!bt||!pe?G:pe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?G:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":bt&&pe?pe(""[Symbol.iterator]()):G,"%Symbol%":bt?Symbol:G,"%SyntaxError%":jt,"%ThrowTypeError%":Lf,"%TypedArray%":Ff,"%TypeError%":Pt,"%Uint8Array%":typeof Uint8Array>"u"?G:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?G:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?G:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?G:Uint32Array,"%URIError%":Af,"%WeakMap%":typeof WeakMap>"u"?G:WeakMap,"%WeakRef%":typeof WeakRef>"u"?G:WeakRef,"%WeakSet%":typeof WeakSet>"u"?G:WeakSet,"%Function.prototype.call%":pr,"%Function.prototype.apply%":cl,"%Object.defineProperty%":Nf,"%Object.getPrototypeOf%":Df,"%Math.abs%":Of,"%Math.floor%":Rf,"%Math.max%":Cf,"%Math.min%":xf,"%Math.pow%":jf,"%Math.round%":If,"%Math.sign%":Uf,"%Reflect.getPrototypeOf%":Mf};if(pe)try{null.error}catch(r){var Bf=pe(pe(r));it["%Error.prototype%"]=Bf}var Hf=function r(e){var t;if(e==="%AsyncFunction%")t=wn("async function () {}");else if(e==="%GeneratorFunction%")t=wn("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=wn("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var s=r("%AsyncGenerator%");s&&pe&&(t=pe(s.prototype))}return it[e]=t,t},Yo={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_r=fr,Lr=al,qf=_r.call(pr,Array.prototype.concat),Wf=_r.call(cl,Array.prototype.splice),Qo=_r.call(pr,String.prototype.replace),Dr=_r.call(pr,String.prototype.slice),Gf=_r.call(pr,RegExp.prototype.exec),zf=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Vf=/\\(\\)?/g,Kf=function(e){var t=Dr(e,0,1),n=Dr(e,-1);if(t==="%"&&n!=="%")throw new jt("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new jt("invalid intrinsic syntax, expected opening `%`");var s=[];return Qo(e,zf,function(o,i,a,l){s[s.length]=a?Qo(l,Vf,"$1"):i||o}),s},Jf=function(e,t){var n=e,s;if(Lr(Yo,n)&&(s=Yo[n],n="%"+s[0]+"%"),Lr(it,n)){var o=it[n];if(o===Et&&(o=Hf(n)),typeof o>"u"&&!t)throw new Pt("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:s,name:n,value:o}}throw new jt("intrinsic "+e+" does not exist!")},ul=function(e,t){if(typeof e!="string"||e.length===0)throw new Pt("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Pt('"allowMissing" argument must be a boolean');if(Gf(/^%?[^%]*%?$/,e)===null)throw new jt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Kf(e),s=n.length>0?n[0]:"",o=Jf("%"+s+"%",t),i=o.name,a=o.value,l=!1,c=o.alias;c&&(s=c[0],Wf(n,qf([0,1],c)));for(var h=1,d=!0;h<n.length;h+=1){var p=n[h],f=Dr(p,0,1),_=Dr(p,-1);if((f==='"'||f==="'"||f==="`"||_==='"'||_==="'"||_==="`")&&f!==_)throw new jt("property names with quotes must have matching quotes");if((p==="constructor"||!d)&&(l=!0),s+="."+p,i="%"+s+"%",Lr(it,i))a=it[i];else if(a!=null){if(!(p in a)){if(!t)throw new Pt("base intrinsic for "+e+" exists, but the property is not available.");return}if(nr&&h+1>=n.length){var g=nr(a,p);d=!!g,d&&"get"in g&&!("originalValue"in g.get)?a=g.get:a=a[p]}else d=Lr(a,p),a=a[p];d&&!l&&(it[i]=a)}}return a},dl=ul,hl=Ss,Yf=hl([dl("%String.prototype.indexOf%")]),Es=function(e,t){var n=dl(e,!!t);return typeof n=="function"&&Yf(e,".prototype.")>-1?hl([n]):n},Qf=ys(),Xf=Es,Wn=Xf("Object.prototype.toString"),Qr=function(e){return Qf&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:Wn(e)==="[object Arguments]"},fl=function(e){return Qr(e)?!0:e!==null&&typeof e=="object"&&"length"in e&&typeof e.length=="number"&&e.length>=0&&Wn(e)!=="[object Array]"&&"callee"in e&&Wn(e.callee)==="[object Function]"},Zf=function(){return Qr(arguments)}();Qr.isLegacyArguments=fl;var ep=Zf?Qr:fl,Xo=Yr,tp=el,wt=Dt,Zo=Mt,$s=function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new wt("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new wt("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new wt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new wt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new wt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new wt("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,l=!!Zo&&Zo(e,t);if(Xo)Xo(e,t,{configurable:i===null&&l?l.configurable:!i,enumerable:s===null&&l?l.enumerable:!s,value:n,writable:o===null&&l?l.writable:!o});else if(a||!s&&!o&&!i)e[t]=n;else throw new tp("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Gn=Yr,pl=function(){return!!Gn};pl.hasArrayLengthDefineBug=function(){if(!Gn)return null;try{return Gn([],"length",{value:1}).length!==1}catch{return!0}};var Ts=pl,rp=Ya,np=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",sp=Object.prototype.toString,op=Array.prototype.concat,ei=$s,ip=function(r){return typeof r=="function"&&sp.call(r)==="[object Function]"},_l=Ts(),ap=function(r,e,t,n){if(e in r){if(n===!0){if(r[e]===t)return}else if(!ip(n)||!n())return}_l?ei(r,e,t,!0):ei(r,e,t)},gl=function(r,e){var t=arguments.length>2?arguments[2]:{},n=rp(e);np&&(n=op.call(n,Object.getOwnPropertySymbols(e)));for(var s=0;s<n.length;s+=1)ap(r,n[s],e[n[s]],t[n[s]])};gl.supportsDescriptors=!!_l;var gr=gl,vl={exports:{}},lp=ul,ti=$s,cp=Ts(),ri=Mt,ni=Dt,up=lp("%Math.floor%"),dp=function(e,t){if(typeof e!="function")throw new ni("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||up(t)!==t)throw new ni("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],s=!0,o=!0;if("length"in e&&ri){var i=ri(e,"length");i&&!i.configurable&&(s=!1),i&&!i.writable&&(o=!1)}return(s||o||!n)&&(cp?ti(e,"length",t,!0,!0):ti(e,"length",t)),e},hp=fr,fp=ws,pp=nl,_p=function(){return pp(hp,fp,arguments)};(function(r){var e=dp,t=Yr,n=Ss,s=_p;r.exports=function(i){var a=n(arguments),l=i.length-(arguments.length-1);return e(a,1+(l>0?l:0),!0)},t?t(r.exports,"apply",{value:s}):r.exports.apply=s})(vl);var ml=vl.exports,si=function(r){return r!==r},yl=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||si(e)&&si(t))},gp=yl,bl=function(){return typeof Object.is=="function"?Object.is:gp},vp=bl,mp=gr,yp=function(){var e=vp();return mp(Object,{is:e},{is:function(){return Object.is!==e}}),e},bp=gr,wp=ml,Sp=yl,wl=bl,Ep=yp,Sl=wp(wl(),Object);bp(Sl,{getPolyfill:wl,implementation:Sp,shim:Ep});var $p=Sl,oi=Es,Tp=ys(),Pp=al,kp=Mt,zn;if(Tp){var Ap=oi("RegExp.prototype.exec"),ii={},En=function(){throw ii},ai={toString:En,valueOf:En};typeof Symbol.toPrimitive=="symbol"&&(ai[Symbol.toPrimitive]=En),zn=function(e){if(!e||typeof e!="object")return!1;var t=kp(e,"lastIndex"),n=t&&Pp(t,"value");if(!n)return!1;try{Ap(e,ai)}catch(s){return s===ii}}}else{var Op=oi("Object.prototype.toString"),Rp="[object RegExp]";zn=function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:Op(e)===Rp}}var Cp=zn,sr=function(){return typeof(function(){}).name=="string"},Xt=Object.getOwnPropertyDescriptor;if(Xt)try{Xt([],"length")}catch{Xt=null}sr.functionsHaveConfigurableNames=function(){if(!sr()||!Xt)return!1;var e=Xt(function(){},"name");return!!e&&!!e.configurable};var xp=Function.prototype.bind;sr.boundFunctionsHaveNames=function(){return sr()&&typeof xp=="function"&&(function(){}).bind().name!==""};var jp=sr,li=$s,Ip=Ts(),Up=jp.functionsHaveConfigurableNames(),Np=Dt,Lp=function(e,t){if(typeof e!="function")throw new Np("`fn` is not a function");var n=arguments.length>2&&!!arguments[2];return(!n||Up)&&(Ip?li(e,"name",t,!0,!0):li(e,"name",t)),e},Dp=Lp,Mp=Dt,Fp=Object,El=Dp(function(){if(this==null||this!==Fp(this))throw new Mp("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),Bp=El,Hp=gr.supportsDescriptors,qp=Object.getOwnPropertyDescriptor,$l=function(){if(Hp&&/a/mig.flags==="gim"){var e=qp(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&"dotAll"in RegExp.prototype&&"hasIndices"in RegExp.prototype){var t="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(n,"sticky",{get:function(){t+="y"}}),e.get.call(n),t==="dy")return e.get}}return Bp},Wp=gr.supportsDescriptors,Gp=$l,zp=Mt,Vp=Object.defineProperty,Kp=Za,ci=il,Jp=/a/,Yp=function(){if(!Wp||!ci)throw new Kp("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=Gp(),t=ci(Jp),n=zp(t,"flags");return(!n||n.get!==e)&&Vp(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},Qp=gr,Xp=ml,Zp=El,Tl=$l,e_=Yp,Pl=Xp(Tl());Qp(Pl,{getPolyfill:Tl,implementation:Zp,shim:e_});var t_=Pl,kl=Es,r_=kl("Date.prototype.getDay"),n_=function(e){try{return r_(e),!0}catch{return!1}},s_=kl("Object.prototype.toString"),o_="[object Date]",i_=ys(),a_=function(e){return typeof e!="object"||e===null?!1:i_?n_(e):s_(e)===o_},ui=Ya,di=ep,hi=$p,fi=Cp,pi=t_,_i=a_,gi=Date.prototype.getTime;function Al(r,e,t){var n=t||{};return(n.strict?hi(r,e):r===e)?!0:!r||!e||typeof r!="object"&&typeof e!="object"?n.strict?hi(r,e):r==e:l_(r,e,n)}function vi(r){return r==null}function mi(r){return!(!r||typeof r!="object"||typeof r.length!="number"||typeof r.copy!="function"||typeof r.slice!="function"||r.length>0&&typeof r[0]!="number")}function l_(r,e,t){var n,s;if(typeof r!=typeof e||vi(r)||vi(e)||r.prototype!==e.prototype||di(r)!==di(e))return!1;var o=fi(r),i=fi(e);if(o!==i)return!1;if(o||i)return r.source===e.source&&pi(r)===pi(e);if(_i(r)&&_i(e))return gi.call(r)===gi.call(e);var a=mi(r),l=mi(e);if(a!==l)return!1;if(a||l){if(r.length!==e.length)return!1;for(n=0;n<r.length;n++)if(r[n]!==e[n])return!1;return!0}if(typeof r!=typeof e)return!1;try{var c=ui(r),h=ui(e)}catch{return!1}if(c.length!==h.length)return!1;for(c.sort(),h.sort(),n=c.length-1;n>=0;n--)if(c[n]!=h[n])return!1;for(n=c.length-1;n>=0;n--)if(s=c[n],!Al(r[s],e[s],t))return!1;return!0}var c_=Al;/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var yi=Object.getOwnPropertySymbols,u_=Object.prototype.hasOwnProperty,d_=Object.prototype.propertyIsEnumerable;function h_(r){if(r==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function f_(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de",Object.getOwnPropertyNames(r)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var n=Object.getOwnPropertyNames(e).map(function(o){return e[o]});if(n.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(o){s[o]=o}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var p_=f_()?Object.assign:function(r,e){for(var t,n=h_(r),s,o=1;o<arguments.length;o++){t=Object(arguments[o]);for(var i in t)u_.call(t,i)&&(n[i]=t[i]);if(yi){s=yi(t);for(var a=0;a<s.length;a++)d_.call(t,s[a])&&(n[s[a]]=t[s[a]])}}return n},vr={};vr.__esModule=!0;vr.TAG_NAMES={HTML:"htmlAttributes",TITLE:"title",BASE:"base",META:"meta",LINK:"link",SCRIPT:"script",NOSCRIPT:"noscript",STYLE:"style"};vr.TAG_PROPERTIES={NAME:"name",CHARSET:"charset",HTTPEQUIV:"http-equiv",REL:"rel",HREF:"href",PROPERTY:"property",SRC:"src",INNER_HTML:"innerHTML",CSS_TEXT:"cssText",ITEM_PROP:"itemprop"};vr.PREACT_TAG_MAP={charset:"charSet","http-equiv":"httpEquiv",itemprop:"itemProp",class:"className"};(function(r,e){e.__esModule=!0;var t=function(){function L(m,E){for(var $=0;$<E.length;$++){var O=E[$];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(m,O.key,O)}}return function(m,E,$){return E&&L(m.prototype,E),$&&L(m,$),m}}(),n=Object.assign||function(L){for(var m=1;m<arguments.length;m++){var E=arguments[m];for(var $ in E)Object.prototype.hasOwnProperty.call(E,$)&&(L[$]=E[$])}return L},s=Ka,o=jh,i=p(o),a=c_,l=p(a),c=p_,h=p(c),d=vr;function p(L){return L&&L.__esModule?L:{default:L}}function f(L,m){if(!(L instanceof m))throw new TypeError("Cannot call a class as a function")}function _(L,m){if(!L)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:L}function g(L,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);L.prototype=Object.create(m&&m.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(L,m):L.__proto__=m)}function v(L,m,E){return m in L?Object.defineProperty(L,m,{value:E,enumerable:!0,configurable:!0,writable:!0}):L[m]=E,L}var y="data-preact-helmet",b=function(m){return String(m).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},w=function(m,E){for(var $=m.length-1;$>=0;$--){var O=m[$];if(O[E])return O[E]}return null},C=function(m){var E=w(m,"title"),$=w(m,"titleTemplate");if($&&E)return $.replace(/%s/g,function(){return E});var O=w(m,"defaultTitle");return E||O||""},A=function(m){return w(m,"onChangeClientState")||function(){}},N=function(m,E){return E.filter(function($){return typeof $[m]<"u"}).map(function($){return $[m]}).reduce(function($,O){return n({},$,O)},{})},Z=function(m,E){return E.filter(function($){return typeof $[d.TAG_NAMES.BASE]<"u"}).map(function($){return $[d.TAG_NAMES.BASE]}).reverse().reduce(function($,O){if(!$.length)for(var F=Object.keys(O),J=0;J<F.length;J++){var V=F[J],M=V.toLowerCase();if(m.indexOf(M)!==-1&&O[M])return $.concat(O)}return $},[])},S=function(m,E,$){var O={};return $.filter(function(F){return typeof F[m]<"u"}).map(function(F){return F[m]}).reverse().reduce(function(F,J){var V={};J.filter(function(ue){for(var le=void 0,Me=Object.keys(ue),ke=0;ke<Me.length;ke++){var Ce=Me[ke],Fe=Ce.toLowerCase();E.indexOf(Fe)!==-1&&!(le===d.TAG_PROPERTIES.REL&&ue[le].toLowerCase()==="canonical")&&!(Fe===d.TAG_PROPERTIES.REL&&ue[Fe].toLowerCase()==="stylesheet")&&(le=Fe),E.indexOf(Ce)!==-1&&(Ce===d.TAG_PROPERTIES.INNER_HTML||Ce===d.TAG_PROPERTIES.CSS_TEXT||Ce===d.TAG_PROPERTIES.ITEM_PROP)&&(le=Ce)}if(!le||!ue[le])return!1;var Be=ue[le].toLowerCase();return O[le]||(O[le]={}),V[le]||(V[le]={}),O[le][Be]?!1:(V[le][Be]=!0,!0)}).reverse().forEach(function(ue){return F.push(ue)});for(var M=Object.keys(V),Q=0;Q<M.length;Q++){var ne=M[Q],Ee=(0,h.default)({},O[ne],V[ne]);O[ne]=Ee}return F},[]).reverse()},j=function(m,E){document.title=m||document.title,q(d.TAG_NAMES.TITLE,E)},q=function(m,E){for(var $=document.getElementsByTagName(m)[0],O=$.getAttribute(y),F=O?O.split(","):[],J=[].concat(F),V=Object.keys(E),M=0;M<V.length;M++){var Q=V[M],ne=E[Q]||"";$.setAttribute(Q,ne),F.indexOf(Q)===-1&&F.push(Q);var Ee=J.indexOf(Q);Ee!==-1&&J.splice(Ee,1)}for(var ue=J.length-1;ue>=0;ue--)$.removeAttribute(J[ue]);F.length===J.length?$.removeAttribute(y):$.setAttribute(y,F.join(","))},I=function(m,E){var $=document.head||document.querySelector("head"),O=$.querySelectorAll(m+"["+y+"]"),F=Array.prototype.slice.call(O),J=[],V=void 0;return E&&E.length&&E.forEach(function(M){var Q=document.createElement(m);for(var ne in M)if(M.hasOwnProperty(ne))if(ne==="innerHTML")Q.innerHTML=M.innerHTML;else if(ne==="cssText")Q.styleSheet?Q.styleSheet.cssText=M.cssText:Q.appendChild(document.createTextNode(M.cssText));else{var Ee=typeof M[ne]>"u"?"":M[ne];Q.setAttribute(ne,Ee)}Q.setAttribute(y,"true"),F.some(function(ue,le){return V=le,Q.isEqualNode(ue)})?F.splice(V,1):J.push(Q)}),F.forEach(function(M){return M.parentNode.removeChild(M)}),J.forEach(function(M){return $.appendChild(M)}),{oldTags:F,newTags:J}},K=function(m){return Object.keys(m).reduce(function(E,$){var O=typeof m[$]<"u"?$+'="'+m[$]+'"':""+$;return E?E+" "+O:O},"")},ie=function(m,E,$){var O=K($);return O?"<"+m+" "+y+" "+O+">"+b(E)+"</"+m+">":"<"+m+" "+y+">"+b(E)+"</"+m+">"},te=function(m,E){return E.reduce(function($,O){var F=Object.keys(O).filter(function(M){return!(M==="innerHTML"||M==="cssText")}).reduce(function(M,Q){var ne=typeof O[Q]>"u"?Q:Q+'="'+b(O[Q])+'"';return M?M+" "+ne:ne},""),J=O.innerHTML||O.cssText||"",V=[d.TAG_NAMES.NOSCRIPT,d.TAG_NAMES.SCRIPT,d.TAG_NAMES.STYLE].indexOf(m)===-1;return $+"<"+m+" "+y+" "+F+(V?">":">"+J+"</"+m+">")},"")},de=function(m,E,$){var O=v({key:E},y,!0),F=Object.keys($).reduce(function(J,V){return J[V]=$[V],J},O);return[(0,s.h)(d.TAG_NAMES.TITLE,F,E)]},Ue=function(m,E){return E.map(function($,O){var F=v({key:O},y,!0);return Object.keys($).forEach(function(J){var V=J;if(V==="innerHTML"||V==="cssText"){var M=$.innerHTML||$.cssText;F.dangerouslySetInnerHTML={__html:M}}else F[V]=$[J]}),(0,s.h)(m,F)})},Re=function(m,E){switch(m){case d.TAG_NAMES.TITLE:return{toComponent:function(){return de(m,E.title,E.titleAttributes)},toString:function(){return ie(m,E.title,E.titleAttributes)}};case d.TAG_NAMES.HTML:return{toComponent:function(){return E},toString:function(){return K(E)}};default:return{toComponent:function(){return Ue(m,E)},toString:function(){return te(m,E)}}}},dt=function(m){var E=m.htmlAttributes,$=m.title,O=m.titleAttributes,F=m.baseTag,J=m.metaTags,V=m.linkTags,M=m.scriptTags,Q=m.noscriptTags,ne=m.styleTags;return{htmlAttributes:Re(d.TAG_NAMES.HTML,E),title:Re(d.TAG_NAMES.TITLE,{title:$,titleAttributes:O}),base:Re(d.TAG_NAMES.BASE,F),meta:Re(d.TAG_NAMES.META,J),link:Re(d.TAG_NAMES.LINK,V),script:Re(d.TAG_NAMES.SCRIPT,M),noscript:Re(d.TAG_NAMES.NOSCRIPT,Q),style:Re(d.TAG_NAMES.STYLE,ne)}},Ft=function(m){var E,$;return $=E=function(O){g(F,O);function F(){return f(this,F),_(this,(F.__proto__||Object.getPrototypeOf(F)).apply(this,arguments))}return t(F,[{key:"shouldComponentUpdate",value:function(V){var M=n({},V);return(!M.children||!M.children.length)&&delete M.children,!(0,l.default)(this.props,M)}},{key:"render",value:function(){return(0,s.h)(m,this.props)}}],[{key:"canUseDOM",set:function(V){m.canUseDOM=V}}]),F}(s.Component),E.peek=m.peek,E.rewind=function(){var O=m.rewind();return O||(O=dt({htmlAttributes:{},title:"",titleAttributes:{},baseTag:[],metaTags:[],linkTags:[],scriptTags:[],noscriptTags:[],styleTags:[]})),O},$},Ze=function(m){return{htmlAttributes:N(d.TAG_NAMES.HTML,m),title:C(m),titleAttributes:N("titleAttributes",m),baseTag:Z([d.TAG_PROPERTIES.HREF],m),metaTags:S(d.TAG_NAMES.META,[d.TAG_PROPERTIES.NAME,d.TAG_PROPERTIES.CHARSET,d.TAG_PROPERTIES.HTTPEQUIV,d.TAG_PROPERTIES.PROPERTY,d.TAG_PROPERTIES.ITEM_PROP],m),linkTags:S(d.TAG_NAMES.LINK,[d.TAG_PROPERTIES.REL,d.TAG_PROPERTIES.HREF],m),scriptTags:S(d.TAG_NAMES.SCRIPT,[d.TAG_PROPERTIES.SRC,d.TAG_PROPERTIES.INNER_HTML],m),noscriptTags:S(d.TAG_NAMES.NOSCRIPT,[d.TAG_PROPERTIES.INNER_HTML],m),styleTags:S(d.TAG_NAMES.STYLE,[d.TAG_PROPERTIES.CSS_TEXT],m),onChangeClientState:A(m)}},mr=function(m){var E=m.htmlAttributes,$=m.title,O=m.titleAttributes,F=m.baseTag,J=m.metaTags,V=m.linkTags,M=m.scriptTags,Q=m.noscriptTags,ne=m.styleTags,Ee=m.onChangeClientState;q("html",E),j($,O);var ue={baseTag:I(d.TAG_NAMES.BASE,F),metaTags:I(d.TAG_NAMES.META,J),linkTags:I(d.TAG_NAMES.LINK,V),scriptTags:I(d.TAG_NAMES.SCRIPT,M),noscriptTags:I(d.TAG_NAMES.NOSCRIPT,Q),styleTags:I(d.TAG_NAMES.STYLE,ne)},le={},Me={};Object.keys(ue).forEach(function(ke){var Ce=ue[ke],Fe=Ce.newTags,Be=Ce.oldTags;Fe.length&&(le[ke]=Fe),Be.length&&(Me[ke]=ue[ke].oldTags)}),Ee(m,le,Me)},ht=function(){return null},yr=(0,i.default)(Ze,mr,dt)(ht);e.default=Ft(yr),r.exports=e.default})(qn,qn.exports);var __=qn.exports;const Mr=Hi(__),g_=()=>{const{user:r}=ut(),e=rr(o=>o.favorites),t=rr(o=>o.fetchFavorites),[n,s]=R({});return re(()=>{document.title="My Favorites - FreeStream",r&&t()},[r,t]),re(()=>{(async()=>{if(r&&e.length>0){const i=e.map(a=>({media_id:a.id,media_type:a.type,season_number:a.season_number||null,episode_number:a.episode_number||null}));try{const a=await za(i);s(a)}catch(a){console.error("Error fetching progress data for favorites:",a),s({})}}else s({})})()},[r,e]),u("div",{class:"container",children:[u(Mr,{children:u("title",{children:"My Favorites - FreeStream"})}),u("h1",{children:"My Favorites"}),e.length>0?u("div",{class:"movie-grid",children:e.map(o=>{const i=`${o.id}-${o.type}-${o.season_number||0}-${o.episode_number||0}`,a=n[i];return u(xt,{item:o,type:o.type,progress:a==null?void 0:a.progress_seconds,duration:a==null?void 0:a.duration_seconds},`${o.type}-${o.id}-${o.season_number||0}-${o.episode_number||0}`)})}):u("p",{children:"You haven't added any favorites yet."})]})},bi=async(r,e=3,t=1e3)=>{for(let n=0;n<e;n++)try{const s=new Promise((a,l)=>{setTimeout(()=>l(new Error("Request timeout")),1e4)}),o=fetch(r,{headers:{Accept:"application/json","Content-Type":"application/json"}}),i=await Promise.race([o,s]);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return i}catch(s){if(console.warn(`Fetch attempt ${n+1} failed for ${r}:`,s.message),n===e-1)throw s;await new Promise(o=>setTimeout(o,t*(n+1)))}},v_=()=>{const{user:r}=ut(),[e,t]=R([]),[n,s]=R(!0),[o,i]=R(null),a=Br(async()=>{if(!r){s(!1);return}s(!0),i(null);try{if(!await fa())throw new Error("Supabase connection test failed. Please check your internet connection and try again.");const d=await Ph();if(!d||d.length===0){t([]),s(!1);return}console.log(" Combined history data received:",{totalItems:d.length,itemsWithProgress:d.filter(_=>_.progress_seconds>0).length});const f=(await Promise.allSettled(d.map(async _=>{try{const v=await(await bi(`${Te}/tmdb/${_.media_type}/${_.media_id}`)).json(),y={...v,id:v.id,watch_id:`${_.user_id}-${_.media_id}-${_.media_type}-${_.season_number||0}-${_.episode_number||0}`,type:_.media_type,media_id:_.media_id,season_number:_.season_number,episode_number:_.episode_number,watched_at:_.watched_at,progress_seconds:_.progress_seconds,duration_seconds:_.duration_seconds};if(_.media_type==="tv"&&_.season_number&&_.episode_number)try{const w=await(await bi(`${Te}/tmdb/tv/${_.media_id}/season/${_.season_number}/episode/${_.episode_number}`)).json();return{...y,episode_name:w.name,still_path:w.still_path,episode_overview:w.overview}}catch(b){console.error("Error fetching episode details:",b)}return y}catch(g){return console.error(`Error fetching details for ${_.media_type} ${_.media_id}:`,g),{id:_.media_id,watch_id:`${_.user_id}-${_.media_id}-${_.media_type}-${_.season_number||0}-${_.episode_number||0}`,type:_.media_type,media_id:_.media_id,season_number:_.season_number,episode_number:_.episode_number,watched_at:_.watched_at,title:_.media_type==="tv"?"Unknown TV Show":"Unknown Movie",name:_.media_type==="tv"?"Unknown TV Show":void 0,poster_path:null,overview:"Details could not be loaded",_failed_to_load:!0,progress_seconds:_.progress_seconds,duration_seconds:_.duration_seconds}}}))).filter(_=>_.status==="fulfilled"&&_.value).map(_=>_.value);t(f)}catch(h){console.error("Error fetching watch history:",h),i("Failed to load watch history. Please try again."),t([])}finally{s(!1)}},[r]);re(()=>{a()},[a]);const l=async h=>{t(e.filter(d=>d.watch_id!==h.watch_id)),await Eh(h)},c=()=>{a()};return n?u("div",{class:"container",children:u("p",{children:"Loading watch history..."})}):o?u("div",{class:"container",children:[u(Mr,{children:u("title",{children:"Watch History - FreeStream"})}),u("h1",{children:"Watch History"}),u("div",{class:"error-message",children:[u("p",{children:o}),u("button",{onClick:c,class:"retry-button",children:"Retry"})]})]}):u("div",{class:"container",children:[u(Mr,{children:u("title",{children:"Watch History - FreeStream"})}),u("h1",{children:"Watch History"}),e.length>0?u("div",{class:"movie-grid",children:e.map(h=>u(xt,{item:h,type:h.type,progress:h.progress_seconds,duration:h.duration_seconds,showDeleteButton:!0,onDelete:l},h.watch_id))}):u("p",{children:"Your watch history is empty."})]})},wi=r=>{var Ms,Fs;const[e,t]=R(null),[n,s]=R([]),[o,i]=R([]),[a,l]=R(""),[c,h]=R(!0),[d,p]=R(!1),[f,_]=R(1),[g,v]=R(1),[y,b]=R("videasy"),[w,C]=R(["videasy","vidsrc","embedsu"]),[A,N]=R(null),[Z,S]=R(!1),[j,q]=R(!1),[I,K]=R(!1),[ie,te]=R(null),[de,Ue]=R(null),[Re,dt]=R(!1),[Ft,Ze]=R(!1),[mr,ht]=R([]),yr=ge(null),[L,m]=R([]),[E,$]=R(null),[O,F]=R(!1),[J,V]=R(0),[M,Q]=R(1),ne=6,Ee=ge(!1),ue=ge(null),le=ge(!1),Me=ge(!1),ke=ge(!1),Ce=ge(null),Fe=ge(!1),Be=ge(new Set),Ol=ge(0);ge(0);const Xr=ge(null),{id:X,type:T,season:ft,episode:pt}=r.matches,{user:_e}=ut(),{addFavorite:Ps,removeFavorite:ks,isFavorited:As,setCurrentMediaItem:Zr}=rr(),Os=Ut(()=>T!=="movie"||!E||!E.progress_seconds||E.progress_seconds<=0?0:E.duration_seconds>0?Math.min(100,E.progress_seconds/E.duration_seconds*100):E.progress_seconds>30?5:2,[T,E]),en=_e==null?void 0:_e.id,Rs=ge(en);ge(0),re(()=>{Rs.current=en},[en]),re(()=>()=>{Be.current.forEach(P=>clearTimeout(P)),Be.current.clear()},[f,g]),re(()=>(e&&Zr({...e,type:T}),()=>{Zr(null)}),[e,T,Zr]),re(()=>{if(!X||!T){Ie("/");return}l(""),Ze(!1),ht([]),t(null),h(!0),K(!1),te(null),m([]),le.current=!1,Me.current=!1,ke.current=!1,Ce.current=null,Fe.current=!1,Be.current.forEach(x=>clearTimeout(x)),Be.current.clear(),Ol.current=0,Xr.current=null,(async()=>{h(!0);try{const x=new AbortController,k=setTimeout(()=>x.abort(),15e3),[Y,he,W]=await Promise.all([fetch(`${Te}/tmdb/${T}/${X}`,{signal:x.signal}).then(D=>{if(!D.ok)throw new Error(`HTTP ${D.status}: ${D.statusText}`);return D.json()}).catch(D=>{throw console.error("Error fetching media details:",D),D}),fetch(`${Te}/tmdb/${T}/${X}/videos`,{signal:x.signal}).then(D=>{if(!D.ok)throw new Error(`HTTP ${D.status}: ${D.statusText}`);return D.json()}).catch(D=>(console.error("Error fetching videos:",D),{results:[]})),fetch(`${Te}/tmdb/${T}/${X}/recommendations`,{signal:x.signal}).then(D=>{if(!D.ok)throw new Error(`HTTP ${D.status}: ${D.statusText}`);return D.json()}).catch(D=>(console.error("Error fetching recommendations:",D),{results:[]}))]);if(clearTimeout(k),t(Y),s(he.results||[]),i(W.results||[]),(T==="tv"||T==="anime")&&Y.seasons&&Y.seasons.length>0)if(ft&&pt&&!isNaN(parseInt(ft))&&!isNaN(parseInt(pt))){ke.current?ke.current=!1:le.current=!0;const ae=parseInt(ft,10),U=parseInt(pt,10);(ae!==f||U!==g)&&(_(ae),v(U))}else{const ae=Y.seasons.find(U=>U.season_number>0)||Y.seasons[0];(ae.season_number!==f||g!==1)&&(_(ae.season_number),v(1))}}catch{t(null),s([]),i([])}finally{h(!1)}})()},[X,T,ft,pt]),re(()=>{(async()=>{if(!_e||!e||!X||!T){T==="movie"?$(null):(T==="tv"||T==="anime")&&m([]);return}try{if((T==="tv"||T==="anime")&&e.seasons&&e.seasons.length>0&&!(ft&&pt&&!isNaN(parseInt(ft))&&!isNaN(parseInt(pt)))&&!Me.current){console.log(" Checking for continue watching episode...");const k=await Th(X);k&&k.season&&k.episode?(console.log(` Continue watching: S${k.season}E${k.episode}`),setTimeout(()=>{_(k.season),v(k.episode);const Y=`/watch/${T}/${X}/season/${k.season}/episode/${k.episode}`;Ie(Y,!0)},100)):console.log(" No continue watching data found, starting from beginning"),Me.current=!0}if(T==="tv"||T==="anime"){const x=await $h(X);m(x)}else if(T==="movie"){const x=await gn(X,T);console.log("Movie progress data loaded:",x),$(x)}}catch(x){console.error("Error loading user-specific data:",x)}})()},[_e,e,X,T]),re(()=>{Q(1)},[f]),re(()=>{(async()=>{if(!(T!=="tv"&&T!=="anime"||!X||!f)){S(!0);try{const x=new AbortController,k=setTimeout(()=>x.abort(),1e4),Y=await fetch(`${Te}/tmdb/${T}/${X}/season/${f}`,{signal:x.signal});if(clearTimeout(k),Y.ok){const he=await Y.json();N(he)}else N(null)}catch{N(null)}finally{S(!1)}}})()},[X,T,f]),re(()=>{const P=`${f}-${g}`,x=ue.current&&ue.current!==P;if(ue.current=P,Ee.current&&!x){Ee.current=!1;return}x&&(Ee.current=!1),(async()=>{if(!X||!T)return;K(!1),te(null),Ue(null),dt(!1);let Y=0;if(Rs.current)try{const W=await gn(X,T,f,g);W&&W.progress_seconds>30?(Y=W.progress_seconds,V(W.progress_seconds)):V(0)}catch(W){console.error("Error fetching progress for stream URL:",W),V(0)}else V(0);let he=`${Te}/stream-url?type=${T}&id=${X}&source=${y}`;(T==="tv"||T==="anime")&&(he+=`&season=${f}&episode=${g}`,T==="anime"&&(he+=`&dub=${j}`)),y==="videasy"&&Y>30&&(he+=`&progress=${Math.floor(Y)}`);try{const W=new AbortController,D=setTimeout(()=>W.abort(),2e4),ae=await fetch(he,{signal:W.signal});clearTimeout(D);const U=await ae.json();if(!ae.ok)throw new Error(U.message||`HTTP ${ae.status}`);let He=U.url;U.isDirectSource?(l(He),ht(U.qualities||[]),Ze(!0)):(l(He),Ze(!1),ht([])),U.currentSource&&U.currentSource!==y&&(Ee.current=!0,b(U.currentSource)),U.availableSources&&C(U.availableSources),Ue(null)}catch(W){let D="Could not load the video stream.",ae=!0;W.name==="AbortError"?D="Stream request timed out. Please try again.":W.message.includes("unavailable")?D="All streaming sources are currently unavailable. This is usually temporary.":W.message.includes("503")?D="Streaming service is temporarily down. Please try again in a few minutes.":W.message.includes("404")?D="This content is not available from the current source.":W.message.includes("NetworkError")||W.message.includes("fetch")?D="Network connection issue. Please check your internet and try again.":D="Unable to load video stream. This might be due to leaving and returning to the browser.",Ue({message:D,canRetry:ae}),l(""),Ze(!1)}})()},[X,T,f,g,y,j]);const Cs=()=>{if(!A||!A.episodes)return;const P=A.episodes.findIndex(x=>x.episode_number===g);if(P!==-1&&P<A.episodes.length-1){const x=A.episodes[P+1];v(x.episode_number)}K(!1),te(null)};if(re(()=>{if(I&&ie===null&&te(15),ie>0){const P=setTimeout(()=>{te(ie-1)},1e3);return()=>clearTimeout(P)}else ie===0&&Cs()},[I,ie]),re(()=>{if(_e&&e){const P=`${X}-${T}-${f}-${g}`,x=Date.now(),k=window.lastHistoryUpdate||{};(!k[P]||x-k[P]>5e3)&&(console.log(" Adding immediate watch history entry:",{mediaId:X,type:T,season:f,episode:g,title:e.title||e.name}),Lo({...e,id:e.id,type:T,season:f,episode:g}).then(()=>{console.log(" Watch history entry added successfully")}).catch(Y=>{console.error(" Failed to add watch history entry:",Y)}),window.lastHistoryUpdate={...k,[P]:x})}else console.log(" Skipping watch history entry:",{hasUser:!!_e,hasMediaDetails:!!e})},[_e,e,T,f,g,X]),re(()=>{if(console.log(" Progress tracking setup:",{hasUser:!!_e,userId:_e==null?void 0:_e.id,hasMediaDetails:!!e}),!_e||!e){console.log(" Progress tracking disabled - missing user or media details");return}const P=async(k,Y)=>{if(console.log(` Progress update received via ${Y}:`,k),k&&k.progress>=0&&k.duration>0){const he=Date.now(),W=`${X}-${T}-${f}-${g}`,D=window.lastProgressSave||{};!D[W]||he-D[W]>5e3?(console.log(` Attempting to save progress for ${T} ${X}:`,{progress:k.progress,duration:k.duration,season:f,episode:g}),await No({...e,id:e.id,type:T,season:f,episode:g},k.progress,k.duration/60)?(console.log(" Progress saved successfully"),window.lastProgressSave={...D,[W]:he},T==="movie"?$({progress_seconds:k.progress,duration_seconds:k.duration}):(T==="tv"||T==="anime")&&m(He=>{const ze=[...He],Bt=ze.findIndex(_t=>_t.season_number===f&&_t.episode_number===g),Ve={media_id:parseInt(X,10),media_type:T,season_number:f,episode_number:g,progress_seconds:k.progress,duration_seconds:k.duration};return Bt>-1?ze[Bt]={...ze[Bt],...Ve}:ze.push(Ve),ze})):console.error(" Failed to save progress")):console.log(" Progress save skipped (too recent):",{timeSinceLastSave:he-D[W],threshold:5e3});const ae=k.duration-k.progress;ae<=15&&ae>0&&!I&&(T==="tv"||T==="anime")&&K(!0)}else console.log(" Progress update ignored (insufficient data):",{hasProgressData:!!k,progress:k==null?void 0:k.progress,duration:k==null?void 0:k.duration,meetsThreshold:(k==null?void 0:k.progress)>=0&&(k==null?void 0:k.duration)>0})};let x;if(Ft){const k=yr.current;if(!k)return;const Y=async()=>{const W=await gn(X,T,f,g);W&&W.progress_seconds&&(k.currentTime=W.progress_seconds)},he=async()=>{if(k.currentTime>0){const W=Date.now(),D=`${X}-${T}-${f}-${g}`,ae=window.lastProgressSave||{};if(!ae[D]||W-ae[D]>5e3){const U={progress:Math.round(k.currentTime),duration:Math.round(k.duration),percentage:k.duration>0?k.currentTime/k.duration*100:0};console.log(" Direct video - saving progress:",U),await No({...e,id:e.id,type:T,season:f,episode:g},U.progress,U.duration/60)?(console.log(" Direct video progress saved successfully"),window.lastProgressSave={...ae,[D]:W},T==="movie"?$({progress_seconds:U.progress,duration_seconds:U.duration}):(T==="tv"||T==="anime")&&m(Bt=>{const Ve=[...Bt],_t=Ve.findIndex(Hs=>Hs.season_number===f&&Hs.episode_number===g),Bs={media_id:parseInt(X,10),media_type:T,season_number:f,episode_number:g,progress_seconds:U.progress,duration_seconds:U.duration};return _t>-1?Ve[_t]={...Ve[_t],...Bs}:Ve.push(Bs),Ve})):console.error(" Failed to save direct video progress");const ze=U.duration-U.progress;ze<=15&&ze>0&&!I&&(T==="tv"||T==="anime")&&K(!0)}}};return k.addEventListener("loadedmetadata",Y),k.addEventListener("timeupdate",he),()=>{k.removeEventListener("loadedmetadata",Y),k.removeEventListener("timeupdate",he)}}else{x=W=>{const D=["player.videasy.net","vidsrc.to","embed.su","vidsrc.xyz","vidsrc.in","vidsrc.pm"],ae=new URL(W.origin);if(D.includes(ae.hostname))try{let U;if(typeof W.data=="string")try{U=JSON.parse(W.data)}catch(He){console.error("Error parsing player message:",He);return}else U=W.data;if(U.type==="PLAYER_EVENT"&&U.data)if(U.data.event==="timeupdate"){const He={progress:U.data.currentTime,duration:U.data.duration,mediaId:U.data.id,mediaType:U.data.mediaType,season:U.data.season,episode:U.data.episode};P(He,ae.hostname)}else U.data.event==="ended"?handleMediaEnded():U.data.event==="play"?p(!0):U.data.event==="pause"&&p(!1);else U.type==="MEDIA_DATA"||(U.type==="VIDEASY_EVENT"&&U.event==="player_ready"?(F(!0),console.log(" Videasy Player is ready!"),postPlayerMessage({action:"get_history"})):U.type==="request_seek"&&U.time&&(console.log(`Seeking to ${U.time}`),postPlayerMessage({action:"seek",time:U.time})))}catch(U){console.error("Error handling message from player:",U)}},window.addEventListener("message",x);let k;const Y=()=>{k&&clearInterval(k),k=setInterval(()=>{if(_e&&e&&a){const W=Date.now(),D=`${X}-${T}-${f}-${g}`,ae=window.lastHistoryUpdate||{};(!ae[D]||W-ae[D]>3e4)&&(Lo({...e,id:e.id,type:T,season:f,episode:g}),window.lastHistoryUpdate={...ae,[D]:W})}},6e4)},he=setTimeout(()=>{Y()},12e4);return()=>{window.removeEventListener("message",x),k&&clearInterval(k),he&&clearTimeout(he)}}},[a,Ft,X,T,f,g,e,I,_e]),c)return u("div",{class:"loading-state",children:[u("div",{class:"loading-spinner"}),u("p",{children:"Loading media details..."})]});if(!e)return u("div",{class:"container",children:u("div",{class:"error-state",children:[u("h2",{children:"Unable to Load Media"}),u("p",{children:"We couldn't load the details for this content. This could be due to:"}),u("ul",{children:[u("li",{children:"Network connectivity issues"}),u("li",{children:"The content may no longer be available"}),u("li",{children:"Server maintenance"})]}),u("button",{onClick:()=>window.location.reload(),class:"btn btn-primary",style:{marginTop:"20px"},children:"Try Again"})]})});const{title:tn,name:rn,overview:Rl,vote_average:E_,release_date:xs,first_air_date:js,runtime:Is,number_of_seasons:Us,genres:Ns,poster_path:Ls}=e,nn=(T==="tv"||T==="anime")&&f&&g,sn=nn?As(e.id,f,g):As(e.id),Ds=xs||js?new Date(xs||js).getFullYear():"",Cl=()=>{var P;if(!_e){window.confirm("You need to log in to save favorites. Would you like to go to the login page?")&&Ie("/login");return}if(sn)nn?ks(e.id,f,g):ks(e.id);else if(nn){const x=(P=A==null?void 0:A.episodes)==null?void 0:P.find(k=>k.episode_number===g);Ps({...e,type:T,season_number:f,episode_number:g,episode_name:(x==null?void 0:x.name)||`Episode ${g}`})}else Ps({...e,type:T})};return u("div",{children:[u(Mr,{children:u("title",{children:[tn||rn," - FreeStream"]})}),u("div",{class:"player-container",children:[!a&&de&&u("div",{class:"stream-error-message",children:[u("p",{children:de.message}),de.canRetry&&u("div",{class:"error-actions",children:[u("button",{onClick:async()=>{dt(!0),setTimeout(()=>{(async()=>{const x=`${Te}/stream-url?type=${T}&id=${X}&source=${y}${T==="tv"||T==="anime"?`&season=${f}&episode=${g}`:""}${T==="anime"?`&dub=${j}`:""}`;try{const k=await fetch(x),Y=await k.json();if(k.ok)l(Y.url),Ze(Y.isDirectSource),ht(Y.qualities||[]),Ue(null);else throw new Error(Y.message)}catch(k){console.error("Retry failed:",k),Ue({message:"Retry failed. Please try selecting a different source.",canRetry:!0})}dt(!1)})()},1e3)},disabled:Re,class:"btn retry-btn",children:Re?"Retrying...":"Retry"}),u("p",{children:"Or try selecting a different source from the list below."})]})]}),!a&&!de&&u("div",{class:"stream-loading",children:u("p",{children:"Loading video stream..."})}),Ft?u("video",{ref:yr,src:a,controls:!0,autoPlay:!0,width:"100%"}):a&&u("iframe",{src:a,width:"100%",height:"100%",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},frameBorder:"0",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen",title:"Video Player",loading:"eager",referrerPolicy:"no-referrer-when-downgrade",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms allow-pointer-lock allow-popups-to-escape-sandbox",importance:"high",onLoad:()=>{console.log(" Player iframe loaded"),F(!0),y!=="videasy"&&J>30?setTimeout(()=>{const P=document.querySelector("iframe");if(P&&P.contentWindow)try{P.contentWindow.postMessage({type:"SEEK_TO",time:J},"*"),console.log(` Sent seek command to restore progress: ${J}s`)}catch(x){console.log("Could not send seek command:",x)}},500):console.log(y==="videasy"?" Videasy native resume - no seeking needed":" No significant progress to resume, starting from beginning")}}),I&&u("div",{class:"next-episode-prompt",children:u("div",{class:"next-episode-content",children:[u("h3",{children:"Up Next"}),u("p",{children:["Playing next episode in ",ie,"s..."]}),u("div",{class:"next-episode-buttons",children:[u("button",{onClick:Cs,class:"btn btn-primary",children:"Play Next"}),u("button",{onClick:()=>{K(!1),te(null)},class:"btn",children:"Cancel"})]})]})})]}),u("div",{class:"container",children:[u("div",{class:"media-details-layout",children:[u("div",{class:"poster",children:[u("img",{src:Hn(Ls?`${Bn}${Ls}`:"https://via.placeholder.com/500x750.png?text=No+Image"),alt:tn||rn}),Os>0&&u("div",{class:"movie-progress-container",children:[u("div",{class:"movie-progress-bar",children:u("div",{class:"movie-progress",style:{width:`${Math.max(2,Os)}%`}})}),u("div",{class:"movie-progress-text",children:E.duration_seconds>0?`${Math.floor(E.progress_seconds/60)}m / ${Math.floor(E.duration_seconds/60)}m watched`:`${Math.floor(E.progress_seconds/60)}m watched`})]})]}),u("div",{class:"details",children:[u("div",{class:"title-container",children:[u("h1",{children:tn||rn}),u("button",{onClick:Cl,class:`favorite-btn ${sn?"favorited":""}`,children:sn?" Favorited":""}),!_e&&u("span",{class:"login-hint",children:u("small",{children:[u("a",{href:"/login",style:{color:"#007bff",textDecoration:"none"},children:"Log in"})," to save favorites, track progress & continue watching"]})})]}),u("div",{class:"meta",children:[u("span",{class:"rating",children:[" ",e.vote_average?e.vote_average.toFixed(1):"N/A"]}),Ds&&u("span",{children:Ds}),Is&&u("span",{children:[Is," min"]}),Us&&u("span",{children:[Us," Seasons"]})]}),u("div",{class:"genres",children:Ns&&Ns.map(P=>u("span",{class:"genre-tag",children:P.name}))}),u("p",{class:"overview",children:Rl}),mr.length>0&&u("div",{class:"quality-selector",children:[u("label",{children:"Quality:"}),mr.map(P=>u("button",{class:`quality-btn ${a===P.url?"active":""}`,onClick:()=>l(P.url),children:[P.quality,"p"]}))]})]})]}),T==="anime"&&u("div",{class:"select-container",children:[u("label",{for:"dub-select",children:"Audio:"}),u("select",{id:"dub-select",value:j,onChange:P=>q(P.target.value==="true"),children:[u("option",{value:"false",children:"Subbed"}),u("option",{value:"true",children:"Dubbed"})]})]}),u("div",{class:"selectors-container",children:[(T==="tv"||T==="anime")&&e&&e.seasons&&u("div",{class:"select-container",children:[u("label",{children:"Season:"}),u("div",{class:"selector-buttons",children:e.seasons.filter(P=>P.season_number>0).map(P=>u("button",{class:`selector-btn ${f===P.season_number?"active":""}`,onClick:()=>{console.log(` User manually selected season ${P.season_number}`),le.current=!0,Xr.current=null;const x=`/watch/${T}/${X}/season/${P.season_number}/episode/1`;Ie(x,!0)},children:P.name},P.id))})]}),w.length>1&&u("div",{class:"select-container",children:[u("label",{children:"Source:"}),u("div",{class:"selector-buttons",children:w.map(P=>u("button",{class:`selector-btn ${y===P?"active":""}`,onClick:()=>b(P),children:P},P))})]})]}),(T==="tv"||T==="anime")&&u("div",{class:"episodes-container",children:[u("h3",{children:"Episodes"}),Z?u("div",{class:"loading-spinner"}):u(ve,{children:[u("div",{class:"episode-list",children:(Fs=(Ms=A==null?void 0:A.episodes)==null?void 0:Ms.slice((M-1)*ne,M*ne))==null?void 0:Fs.map(P=>{const x=L.find(Y=>Y.season_number===f&&Y.episode_number===P.episode_number),k=x&&x.progress_seconds>0?x.duration_seconds&&x.duration_seconds>0?Math.min(100,x.progress_seconds/x.duration_seconds*100):x.progress_seconds>30?5:2:0;return u("div",{class:`episode-card ${P.episode_number===g?"active":""}`,onClick:()=>{console.log(` User manually selected episode ${P.episode_number}`),le.current=!0,Xr.current=null;const Y=`/watch/${T}/${X}/season/${f}/episode/${P.episode_number}`;Ie(Y,!0)},children:[u("div",{class:"episode-card-image",children:[u("img",{src:Hn(P.still_path?`${Bn}${P.still_path}`:`https://via.placeholder.com/300x169.png?text=${encodeURIComponent(P.name)}`),alt:P.name}),u("div",{class:"episode-number-badge",children:P.episode_number}),k>0&&u("div",{class:"episode-progress-bar",children:u("div",{class:"episode-progress",style:{width:`${Math.max(2,k)}%`}})})]}),u("div",{class:"episode-card-content",children:[u("h4",{children:P.name}),u("p",{class:"episode-overview",children:P.overview})]})]},P.id)})}),(A==null?void 0:A.episodes)&&A.episodes.length>ne&&u("div",{class:"pagination-controls",children:[u("button",{class:"pagination-btn",onClick:()=>Q(P=>Math.max(1,P-1)),disabled:M===1,children:" Previous"}),u("div",{class:"pagination-info",children:[u("span",{class:"page-numbers",children:Array.from({length:Math.ceil(A.episodes.length/ne)},(P,x)=>x+1).map(P=>u("button",{class:`page-number ${P===M?"active":""}`,onClick:()=>Q(P),children:P},P))}),u("span",{class:"page-text",children:["Page ",M," of ",Math.ceil(A.episodes.length/ne),"(",A.episodes.length," episodes)"]})]}),u("button",{class:"pagination-btn",onClick:()=>Q(P=>Math.min(Math.ceil(A.episodes.length/ne),P+1)),disabled:M===Math.ceil(A.episodes.length/ne),children:"Next "})]})]})]}),o.length>0&&u("div",{class:"recommendations",children:[u("h2",{children:"More Like This"}),u("div",{class:"movie-grid",children:o.map(P=>u(xt,{item:P,type:T,progress:null,duration:null},`${P.media_type||T}-${P.id}`))})]})]})]})},m_=r=>{const[e,t]=R([]),[n,s]=R(!1),[o,i]=R("");re(()=>{var h;const c=new URLSearchParams(((h=r.url)==null?void 0:h.split("?")[1])||"").get("q");i(c||""),c?a(c):t([])},[r.url]);const a=async l=>{s(!0);try{const h=await(await fetch(`${Te}/tmdb/search/multi?query=${encodeURIComponent(l)}`)).json();if(h&&h.results){const d=h.results.filter(p=>(p.media_type==="movie"||p.media_type==="tv")&&p.poster_path);t(d)}}catch(c){console.error("Error performing search:",c),t([])}finally{s(!1)}};return u("div",{class:"container home-page",children:[u("div",{class:"search-header",children:[u("h1",{class:"main-title",children:"Search Results"}),u("div",{class:"search-query-display",children:[u("span",{class:"search-label",children:"Showing results for:"}),u("span",{class:"search-query",children:['"',o,'"']})]})]}),n?u(Va,{text:"Searching for movies and TV shows..."}):e.length>0?u("section",{class:"home-section",children:[u("h2",{children:["Found ",e.length," result",e.length!==1?"s":""]}),u("div",{class:"movie-grid",children:e.map(l=>u(xt,{item:l,type:l.media_type,progress:null,duration:null},`${l.media_type}-${l.id}`))})]}):o?u("div",{class:"no-results",children:[u("div",{class:"no-results-icon",children:""}),u("h3",{children:"No results found"}),u("p",{children:[`We couldn't find anything for "`,o,'". Try searching with different keywords.']}),u("div",{class:"search-suggestions",children:[u("p",{children:"Try searching for:"}),u("ul",{children:[u("li",{children:"Movie or TV show titles"}),u("li",{children:"Actor or director names"}),u("li",{children:'Genre names (e.g., "action", "comedy")'}),u("li",{children:"Keywords from the plot"})]})]})]}):u("div",{class:"search-welcome",children:[u("div",{class:"search-welcome-icon",children:""}),u("h3",{children:"Start your search"}),u("p",{children:"Use the search bar above to find your favorite movies and TV shows."})]})]})};function y_(){const[r,e]=R(!1),[t,n]=R(""),[s,o]=R("");return u("div",{className:"auth-container",children:u("div",{className:"auth-form",children:[u("h1",{className:"header",children:"Login"}),u("p",{className:"description",children:"Sign in to your account."}),u("form",{onSubmit:async a=>{a.preventDefault();try{e(!0);const{error:l}=await ee.auth.signInWithPassword({email:t,password:s});if(l)throw l;Ur.success("Logged in successfully!"),Ie("/",!0)}catch(l){Ur.error(l.error_description||l.message)}finally{e(!1)}},children:[u("div",{className:"input-group",children:[u("label",{htmlFor:"email",children:"Email"}),u("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:a=>n(a.target.value)})]}),u("div",{className:"input-group",children:[u("label",{htmlFor:"password",children:"Password"}),u("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:a=>o(a.target.value)})]}),u("div",{children:u("button",{className:"button",disabled:r,children:r?u("span",{children:"Loading..."}):u("span",{children:"Login"})})})]})]})})}function b_(){const[r,e]=R(!1),[t,n]=R(""),[s,o]=R("");return u("div",{className:"auth-container",children:u("div",{className:"auth-form",children:[u("h1",{className:"header",children:"Create an account"}),u("p",{className:"description",children:"Sign up for a new account."}),u("form",{onSubmit:async a=>{a.preventDefault();try{e(!0);const{error:l}=await ee.auth.signUp({email:t,password:s});if(l)throw l;Ur.success("Check your email for the confirmation link!")}catch(l){Ur.error(l.error_description||l.message)}finally{e(!1)}},children:[u("div",{className:"input-group",children:[u("label",{htmlFor:"email",children:"Email"}),u("input",{id:"email",className:"input-field",type:"email",placeholder:"Your email",value:t,onChange:a=>n(a.target.value)})]}),u("div",{className:"input-group",children:[u("label",{htmlFor:"password",children:"Password"}),u("input",{id:"password",className:"input-field",type:"password",placeholder:"Your password",value:s,onChange:a=>o(a.target.value)})]}),u("div",{children:u("button",{className:"button",disabled:r,children:r?u("span",{children:"Loading..."}):u("span",{children:"Sign Up"})})})]})]})})}const Si=({component:r,...e})=>{const{user:t}=ut();return t?u(r,{...e}):(Ie("/login",!0),null)},w_=()=>{const[r,e]=R(!1);return re(()=>{const n=()=>{window.pageYOffset>300?e(!0):e(!1)};return window.addEventListener("scroll",n),()=>window.removeEventListener("scroll",n)},[]),u("button",{class:`scroll-to-top ${r?"visible":""}`,onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},"aria-label":"Scroll to top",children:u("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:u("path",{d:"M18 15l-6-6-6 6"})})})},S_=()=>(re(()=>{bd()},[]),u(gd,{children:u("div",{class:"app",children:[u(md,{position:"top-center"}),u(Sd,{}),u("main",{children:u(Bi,{history:Xl(),children:[u(vn,{path:"/"}),u(vn,{path:"/movies"}),u(vn,{path:"/tv"}),u(Si,{component:g_,path:"/favorites"}),u(Si,{component:v_,path:"/history"}),u(wi,{path:"/watch/:type/:id"}),u(wi,{path:"/watch/:type/:id/season/:season/episode/:episode"}),u(m_,{path:"/search"}),u(y_,{path:"/login"}),u(b_,{path:"/signup"})]})}),u($d,{}),u(w_,{})]})}));at(u(S_,{}),document.getElementById("app"));
